(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var rt,A,Cs,Ae,dr,Os,ks,Is,Tn,hn,fn,xs,Qe={},As=[],ao=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,st=Array.isArray;function le(t,e){for(var n in e)t[n]=e[n];return t}function Dn(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function be(t,e,n){var r,s,i,o={};for(i in e)i=="key"?r=e[i]:i=="ref"?s=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?rt.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)o[i]===void 0&&(o[i]=t.defaultProps[i]);return Ye(t,o,r,s,null)}function Ye(t,e,n,r,s){var i={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++Cs,__i:-1,__u:0};return s==null&&A.vnode!=null&&A.vnode(i),i}function co(){return{current:null}}function we(t){return t.children}function he(t,e){this.props=t,this.context=e}function Te(t,e){if(e==null)return t.__?Te(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Te(t):null}function Ns(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Ns(t)}}function dn(t){(!t.__d&&(t.__d=!0)&&Ae.push(t)&&!Pt.__r++||dr!=A.debounceRendering)&&((dr=A.debounceRendering)||Os)(Pt)}function Pt(){for(var t,e,n,r,s,i,o,a=1;Ae.length;)Ae.length>a&&Ae.sort(ks),t=Ae.shift(),a=Ae.length,t.__d&&(n=void 0,r=void 0,s=(r=(e=t).__v).__e,i=[],o=[],e.__P&&((n=le({},r)).__v=r.__v+1,A.vnode&&A.vnode(n),Rn(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[s]:null,i,s??Te(r),!!(32&r.__u),o),n.__v=r.__v,n.__.__k[n.__i]=n,Ds(i,n,o),r.__e=r.__=null,n.__e!=s&&Ns(n)));Pt.__r=0}function Ms(t,e,n,r,s,i,o,a,c,l,h){var u,d,_,v,E,b,m,f=r&&r.__k||As,g=e.length;for(c=uo(n,e,f,c,g),u=0;u<g;u++)(_=n.__k[u])!=null&&(d=_.__i==-1?Qe:f[_.__i]||Qe,_.__i=u,b=Rn(t,_,d,s,i,o,a,c,l,h),v=_.__e,_.ref&&d.ref!=_.ref&&(d.ref&&$n(d.ref,null,_),h.push(_.ref,_.__c||v,_)),E==null&&v!=null&&(E=v),(m=!!(4&_.__u))||d.__k===_.__k?c=Ts(_,c,t,m):typeof _.type=="function"&&b!==void 0?c=b:v&&(c=v.nextSibling),_.__u&=-7);return n.__e=E,c}function uo(t,e,n,r,s){var i,o,a,c,l,h=n.length,u=h,d=0;for(t.__k=new Array(s),i=0;i<s;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=t.__k[i]=Ye(null,o,null,null,null):st(o)?o=t.__k[i]=Ye(we,{children:o},null,null,null):o.constructor==null&&o.__b>0?o=t.__k[i]=Ye(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):t.__k[i]=o,c=i+d,o.__=t,o.__b=t.__b+1,(l=o.__i=lo(o,n,c,u))!=-1&&(u--,(a=n[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(s>h?d--:s<h&&d++),typeof o.type!="function"&&(o.__u|=4)):l!=c&&(l==c-1?d--:l==c+1?d++:(l>c?d--:d++,o.__u|=4))):t.__k[i]=null;if(u)for(i=0;i<h;i++)(a=n[i])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=Te(a)),$s(a,a));return r}function Ts(t,e,n,r){var s,i;if(typeof t.type=="function"){for(s=t.__k,i=0;s&&i<s.length;i++)s[i]&&(s[i].__=t,e=Ts(s[i],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=Te(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function ve(t,e){return e=e||[],t==null||typeof t=="boolean"||(st(t)?t.some(function(n){ve(n,e)}):e.push(t)),e}function lo(t,e,n,r){var s,i,o,a=t.key,c=t.type,l=e[n],h=l!=null&&(2&l.__u)==0;if(l===null&&a==null||h&&a==l.key&&c==l.type)return n;if(r>(h?1:0)){for(s=n-1,i=n+1;s>=0||i<e.length;)if((l=e[o=s>=0?s--:i++])!=null&&(2&l.__u)==0&&a==l.key&&c==l.type)return o}return-1}function pr(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||ao.test(e)?n:n+"px"}function ut(t,e,n,r,s){var i,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||pr(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||pr(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(Is,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?r?n.u=r.u:(n.u=Tn,t.addEventListener(e,i?fn:hn,i)):t.removeEventListener(e,i?fn:hn,i);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function _r(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=Tn++;else if(e.t<n.u)return;return n(A.event?A.event(e):e)}}}function Rn(t,e,n,r,s,i,o,a,c,l){var h,u,d,_,v,E,b,m,f,g,P,C,B,G,Y,re,se,F=e.type;if(e.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),i=[a=e.__e=n.__e]),(h=A.__b)&&h(e);e:if(typeof F=="function")try{if(m=e.props,f="prototype"in F&&F.prototype.render,g=(h=F.contextType)&&r[h.__c],P=h?g?g.props.value:h.__:r,n.__c?b=(u=e.__c=n.__c).__=u.__E:(f?e.__c=u=new F(m,P):(e.__c=u=new he(m,P),u.constructor=F,u.render=fo),g&&g.sub(u),u.state||(u.state={}),u.__n=r,d=u.__d=!0,u.__h=[],u._sb=[]),f&&u.__s==null&&(u.__s=u.state),f&&F.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=le({},u.__s)),le(u.__s,F.getDerivedStateFromProps(m,u.__s))),_=u.props,v=u.state,u.__v=e,d)f&&F.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),f&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(f&&F.getDerivedStateFromProps==null&&m!==_&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(m,P),e.__v==n.__v||!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(m,u.__s,P)===!1){for(e.__v!=n.__v&&(u.props=m,u.state=u.__s,u.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(q){q&&(q.__=e)}),C=0;C<u._sb.length;C++)u.__h.push(u._sb[C]);u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(m,u.__s,P),f&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(_,v,E)})}if(u.context=P,u.props=m,u.__P=t,u.__e=!1,B=A.__r,G=0,f){for(u.state=u.__s,u.__d=!1,B&&B(e),h=u.render(u.props,u.state,u.context),Y=0;Y<u._sb.length;Y++)u.__h.push(u._sb[Y]);u._sb=[]}else do u.__d=!1,B&&B(e),h=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++G<25);u.state=u.__s,u.getChildContext!=null&&(r=le(le({},r),u.getChildContext())),f&&!d&&u.getSnapshotBeforeUpdate!=null&&(E=u.getSnapshotBeforeUpdate(_,v)),re=h,h!=null&&h.type===we&&h.key==null&&(re=Rs(h.props.children)),a=Ms(t,st(re)?re:[re],e,n,r,s,i,o,a,c,l),u.base=e.__e,e.__u&=-161,u.__h.length&&o.push(u),b&&(u.__E=u.__=null)}catch(q){if(e.__v=null,c||i!=null)if(q.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,e.__e=a}else{for(se=i.length;se--;)Dn(i[se]);pn(e)}else e.__e=n.__e,e.__k=n.__k,q.then||pn(e);A.__e(q,e,n)}else i==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=ho(n.__e,e,n,r,s,i,o,c,l);return(h=A.diffed)&&h(e),128&e.__u?void 0:a}function pn(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(pn)}function Ds(t,e,n){for(var r=0;r<n.length;r++)$n(n[r],n[++r],n[++r]);A.__c&&A.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(i){i.call(s)})}catch(i){A.__e(i,s.__v)}})}function Rs(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:st(t)?t.map(Rs):le({},t)}function ho(t,e,n,r,s,i,o,a,c){var l,h,u,d,_,v,E,b=n.props||Qe,m=e.props,f=e.type;if(f=="svg"?s="http://www.w3.org/2000/svg":f=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),i!=null){for(l=0;l<i.length;l++)if((_=i[l])&&"setAttribute"in _==!!f&&(f?_.localName==f:_.nodeType==3)){t=_,i[l]=null;break}}if(t==null){if(f==null)return document.createTextNode(m);t=document.createElementNS(s,f,m.is&&m),a&&(A.__m&&A.__m(e,i),a=!1),i=null}if(f==null)b===m||a&&t.data==m||(t.data=m);else{if(i=i&&rt.call(t.childNodes),!a&&i!=null)for(b={},l=0;l<t.attributes.length;l++)b[(_=t.attributes[l]).name]=_.value;for(l in b)if(_=b[l],l!="children"){if(l=="dangerouslySetInnerHTML")u=_;else if(!(l in m)){if(l=="value"&&"defaultValue"in m||l=="checked"&&"defaultChecked"in m)continue;ut(t,l,null,_,s)}}for(l in m)_=m[l],l=="children"?d=_:l=="dangerouslySetInnerHTML"?h=_:l=="value"?v=_:l=="checked"?E=_:a&&typeof _!="function"||b[l]===_||ut(t,l,_,b[l],s);if(h)a||u&&(h.__html==u.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(u&&(t.innerHTML=""),Ms(e.type=="template"?t.content:t,st(d)?d:[d],e,n,r,f=="foreignObject"?"http://www.w3.org/1999/xhtml":s,i,o,i?i[0]:n.__k&&Te(n,0),a,c),i!=null)for(l=i.length;l--;)Dn(i[l]);a||(l="value",f=="progress"&&v==null?t.removeAttribute("value"):v!=null&&(v!==t[l]||f=="progress"&&!v||f=="option"&&v!=b[l])&&ut(t,l,v,b[l],s),l="checked",E!=null&&E!=t[l]&&ut(t,l,E,b[l],s))}return t}function $n(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(s){A.__e(s,n)}}function $s(t,e,n){var r,s;if(A.unmount&&A.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||$n(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){A.__e(i,e)}r.base=r.__P=null}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&$s(r[s],e,n||typeof t.type!="function");n||Dn(t.__e),t.__c=t.__=t.__e=void 0}function fo(t,e,n){return this.constructor(t,n)}function De(t,e,n){var r,s,i,o;e==document&&(e=document.documentElement),A.__&&A.__(t,e),s=(r=typeof n=="function")?null:n&&n.__k||e.__k,i=[],o=[],Rn(e,t=(!r&&n||e).__k=be(we,null,[t]),s||Qe,Qe,e.namespaceURI,!r&&n?[n]:s?null:e.firstChild?rt.call(e.childNodes):null,i,!r&&n?n:s?s.__e:e.firstChild,r,o),Ds(i,t,o)}function Ls(t,e){De(t,e,Ls)}function po(t,e,n){var r,s,i,o,a=le({},t.props);for(i in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)i=="key"?r=e[i]:i=="ref"?s=e[i]:a[i]=e[i]===void 0&&o!=null?o[i]:e[i];return arguments.length>2&&(a.children=arguments.length>3?rt.call(arguments,2):n),Ye(t.type,a,r||t.key,s||t.ref,null)}function Bs(t){function e(n){var r,s;return this.getChildContext||(r=new Set,(s={})[e.__c]=this,this.getChildContext=function(){return s},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&r.forEach(function(o){o.__e=!0,dn(o)})},this.sub=function(i){r.add(i);var o=i.componentWillUnmount;i.componentWillUnmount=function(){r&&r.delete(i),o&&o.call(i)}}),n.children}return e.__c="__cC"+xs++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,r){return n.children(r)}).contextType=e,e}rt=As.slice,A={__e:function(t,e,n,r){for(var s,i,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(t)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,r||{}),o=s.__d),o)return s.__E=s}catch(a){t=a}throw t}},Cs=0,he.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=le({},this.state),typeof t=="function"&&(t=t(le({},n),this.props)),t&&le(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),dn(this))},he.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),dn(this))},he.prototype.render=we,Ae=[],Os=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ks=function(t,e){return t.__v.__b-e.__v.__b},Pt.__r=0,Is=/(PointerCapture)$|Capture$/i,Tn=0,hn=_r(!1),fn=_r(!0),xs=0;var _o=0;function I(t,e,n,r,s,i){e||(e={});var o,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?o=e[a]:c[a]=e[a];var l={type:t,props:c,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--_o,__i:-1,__u:0,__source:s,__self:i};if(typeof t=="function"&&(o=t.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return A.vnode&&A.vnode(l),l}function ae(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map((function(s){return"'"+s+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Re(t){return!!t&&!!t[Z]}function Ne(t){var e;return!!t&&((function(n){if(!n||typeof n!="object")return!1;var r=Object.getPrototypeOf(n);if(r===null)return!0;var s=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===Po})(t)||Array.isArray(t)||!!t[Pr]||!!(!((e=t.constructor)===null||e===void 0)&&e[Pr])||Ln(t)||Bn(t))}function Ze(t,e,n){n===void 0&&(n=!1),Ue(t)===0?(n?Object.keys:qn)(t).forEach((function(r){n&&typeof r=="symbol"||e(r,t[r],t)})):t.forEach((function(r,s){return e(s,r,t)}))}function Ue(t){var e=t[Z];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:Ln(t)?2:Bn(t)?3:0}function _n(t,e){return Ue(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function yo(t,e){return Ue(t)===2?t.get(e):t[e]}function Us(t,e,n){var r=Ue(t);r===2?t.set(e,n):r===3?t.add(n):t[e]=n}function mo(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function Ln(t){return wo&&t instanceof Map}function Bn(t){return Eo&&t instanceof Set}function xe(t){return t.o||t.t}function Un(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=So(t);delete e[Z];for(var n=qn(e),r=0;r<n.length;r++){var s=n[r],i=e[s];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[s]={configurable:!0,writable:!0,enumerable:i.enumerable,value:t[s]})}return Object.create(Object.getPrototypeOf(t),e)}function jn(t,e){return e===void 0&&(e=!1),Gn(t)||Re(t)||!Ne(t)||(Ue(t)>1&&(t.set=t.add=t.clear=t.delete=go),Object.freeze(t),e&&Ze(t,(function(n,r){return jn(r,!0)}),!0)),t}function go(){ae(2)}function Gn(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function fe(t){var e=Co[t];return e||ae(18,t),e}function yr(){return et}function Vt(t,e){e&&(fe("Patches"),t.u=[],t.s=[],t.v=e)}function St(t){yn(t),t.p.forEach(vo),t.p=null}function yn(t){t===et&&(et=t.l)}function mr(t){return et={p:[],l:et,h:t,m:!0,_:0}}function vo(t){var e=t[Z];e.i===0||e.i===1?e.j():e.g=!0}function Ht(t,e){e._=e.p.length;var n=e.p[0],r=t!==void 0&&t!==n;return e.h.O||fe("ES5").S(e,t,r),r?(n[Z].P&&(St(e),ae(4)),Ne(t)&&(t=Ct(e,t),e.l||Ot(e,t)),e.u&&fe("Patches").M(n[Z].t,t,e.u,e.s)):t=Ct(e,n,[]),St(e),e.u&&e.v(e.u,e.s),t!==js?t:void 0}function Ct(t,e,n){if(Gn(e))return e;var r=e[Z];if(!r)return Ze(e,(function(a,c){return gr(t,r,e,a,c,n)}),!0),e;if(r.A!==t)return e;if(!r.P)return Ot(t,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var s=r.i===4||r.i===5?r.o=Un(r.k):r.o,i=s,o=!1;r.i===3&&(i=new Set(s),s.clear(),o=!0),Ze(i,(function(a,c){return gr(t,r,s,a,c,n,o)})),Ot(t,s,!1),n&&t.u&&fe("Patches").N(r,n,t.u,t.s)}return r.o}function gr(t,e,n,r,s,i,o){if(Re(s)){var a=Ct(t,s,i&&e&&e.i!==3&&!_n(e.R,r)?i.concat(r):void 0);if(Us(n,r,a),!Re(a))return;t.m=!1}else o&&n.add(s);if(Ne(s)&&!Gn(s)){if(!t.h.D&&t._<1)return;Ct(t,s),e&&e.A.l||Ot(t,s)}}function Ot(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&jn(e,n)}function Wt(t,e){var n=t[Z];return(n?xe(n):t)[e]}function vr(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Object.getPrototypeOf(n)}}function mn(t){t.P||(t.P=!0,t.l&&mn(t.l))}function zt(t){t.o||(t.o=Un(t.t))}function gn(t,e,n){var r=Ln(e)?fe("MapSet").F(e,n):Bn(e)?fe("MapSet").T(e,n):t.O?(function(s,i){var o=Array.isArray(s),a={i:o?1:0,A:i?i.A:yr(),P:!1,I:!1,R:{},l:i,t:s,k:null,o:null,j:null,C:!1},c=a,l=vn;o&&(c=[a],l=ze);var h=Proxy.revocable(c,l),u=h.revoke,d=h.proxy;return a.k=d,a.j=u,d})(e,n):fe("ES5").J(e,n);return(n?n.A:yr()).p.push(r),r}function bo(t){return Re(t)||ae(22,t),(function e(n){if(!Ne(n))return n;var r,s=n[Z],i=Ue(n);if(s){if(!s.P&&(s.i<4||!fe("ES5").K(s)))return s.t;s.I=!0,r=br(n,i),s.I=!1}else r=br(n,i);return Ze(r,(function(o,a){s&&yo(s.t,o)===a||Us(r,o,e(a))})),i===3?new Set(r):r})(t)}function br(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return Un(t)}var wr,et,Fn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",wo=typeof Map<"u",Eo=typeof Set<"u",Er=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",js=Fn?Symbol.for("immer-nothing"):((wr={})["immer-nothing"]=!0,wr),Pr=Fn?Symbol.for("immer-draftable"):"__$immer_draftable",Z=Fn?Symbol.for("immer-state"):"__$immer_state",Po=""+Object.prototype.constructor,qn=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,So=Object.getOwnPropertyDescriptors||function(t){var e={};return qn(t).forEach((function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)})),e},Co={},vn={get:function(t,e){if(e===Z)return t;var n=xe(t);if(!_n(n,e))return(function(s,i,o){var a,c=vr(i,o);return c?"value"in c?c.value:(a=c.get)===null||a===void 0?void 0:a.call(s.k):void 0})(t,n,e);var r=n[e];return t.I||!Ne(r)?r:r===Wt(t.t,e)?(zt(t),t.o[e]=gn(t.A.h,r,t)):r},has:function(t,e){return e in xe(t)},ownKeys:function(t){return Reflect.ownKeys(xe(t))},set:function(t,e,n){var r=vr(xe(t),e);if(r?.set)return r.set.call(t.k,n),!0;if(!t.P){var s=Wt(xe(t),e),i=s?.[Z];if(i&&i.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(mo(n,s)&&(n!==void 0||_n(t.t,e)))return!0;zt(t),mn(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return Wt(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,zt(t),mn(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=xe(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty:function(){ae(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){ae(12)}},ze={};Ze(vn,(function(t,e){ze[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),ze.deleteProperty=function(t,e){return ze.set.call(this,t,e,void 0)},ze.set=function(t,e,n){return vn.set.call(this,t[0],e,n,t[0])};var Oo=(function(){function t(n){var r=this;this.O=Er,this.D=!0,this.produce=function(s,i,o){if(typeof s=="function"&&typeof i!="function"){var a=i;i=s;var c=r;return function(E){var b=this;E===void 0&&(E=a);for(var m=arguments.length,f=Array(m>1?m-1:0),g=1;g<m;g++)f[g-1]=arguments[g];return c.produce(E,(function(P){var C;return(C=i).call.apply(C,[b,P].concat(f))}))}}var l;if(typeof i!="function"&&ae(6),o!==void 0&&typeof o!="function"&&ae(7),Ne(s)){var h=mr(r),u=gn(r,s,void 0),d=!0;try{l=i(u),d=!1}finally{d?St(h):yn(h)}return typeof Promise<"u"&&l instanceof Promise?l.then((function(E){return Vt(h,o),Ht(E,h)}),(function(E){throw St(h),E})):(Vt(h,o),Ht(l,h))}if(!s||typeof s!="object"){if((l=i(s))===void 0&&(l=s),l===js&&(l=void 0),r.D&&jn(l,!0),o){var _=[],v=[];fe("Patches").M(s,l,_,v),o(_,v)}return l}ae(21,s)},this.produceWithPatches=function(s,i){if(typeof s=="function")return function(l){for(var h=arguments.length,u=Array(h>1?h-1:0),d=1;d<h;d++)u[d-1]=arguments[d];return r.produceWithPatches(l,(function(_){return s.apply(void 0,[_].concat(u))}))};var o,a,c=r.produce(s,i,(function(l,h){o=l,a=h}));return typeof Promise<"u"&&c instanceof Promise?c.then((function(l){return[l,o,a]})):[c,o,a]},typeof n?.useProxies=="boolean"&&this.setUseProxies(n.useProxies),typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Ne(n)||ae(8),Re(n)&&(n=bo(n));var r=mr(this),s=gn(this,n,void 0);return s[Z].C=!0,yn(r),s},e.finishDraft=function(n,r){var s=n&&n[Z],i=s.A;return Vt(i,r),Ht(void 0,i)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!Er&&ae(20),this.O=n},e.applyPatches=function(n,r){var s;for(s=r.length-1;s>=0;s--){var i=r[s];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}s>-1&&(r=r.slice(s+1));var o=fe("Patches").$;return Re(n)?o(n,r):this.produce(n,(function(a){return o(a,r)}))},t})(),ee=new Oo,ko=ee.produce;ee.produceWithPatches.bind(ee);ee.setAutoFreeze.bind(ee);ee.setUseProxies.bind(ee);ee.applyPatches.bind(ee);ee.createDraft.bind(ee);ee.finishDraft.bind(ee);class Io{constructor(e){const n=xo();this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){const e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=Math.trunc(e))}}function xo(){let t=4022871197;return function(n){const r=n.toString();for(let s=0;s<r.length;s++){t+=r.charCodeAt(s);let i=.02519603282416938*t;t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=i*4294967296}return(t>>>0)*23283064365386963e-26}}function Sr(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function Gs(t,e){const n=new Io(t),r=n.next.bind(n);return e&&Sr(e,n),r.state=()=>Sr(n,{}),r}class Cr{constructor(e){this.state=e||{seed:"0"},this.used=!1}static seed(){return Date.now().toString(36).slice(-10)}isUsed(){return this.used}getState(){return this.state}_random(){this.used=!0;const e=this.state,n=e.prngstate?"":e.seed,r=Gs(n,e.prngstate),s=r();return this.state={...e,prngstate:r.state()},s}api(){const e=this._random.bind(this),n={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},r={};for(const i in n){const o=n[i];r[i]=a=>a===void 0?Math.floor(e()*o)+1:Array.from({length:a}).map(()=>Math.floor(e()*o)+1)}function s(i=6,o){return o===void 0?Math.floor(e()*i)+1:Array.from({length:o}).map(()=>Math.floor(e()*i)+1)}return{...r,Die:s,Number:()=>e(),Shuffle:i=>{const o=[...i];let a=i.length,c=0;const l=Array.from({length:a});for(;a;){const h=Math.trunc(a*e());l[c++]=o[h],o[h]=o[--a]}return l},_private:this}}}const Ao={name:"random",noClient:({api:t})=>t._private.isUsed(),flush:({api:t})=>t._private.getState(),api:({data:t})=>new Cr(t).api(),setup:({game:t})=>{let{seed:e}=t;return e===void 0&&(e=Cr.seed()),{seed:e}},playerView:()=>{}};var Or=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Jt,kr;function No(){if(kr)return Jt;kr=1;var t="[object Object]";function e(d){var _=!1;if(d!=null&&typeof d.toString!="function")try{_=!!(d+"")}catch{}return _}function n(d,_){return function(v){return d(_(v))}}var r=Function.prototype,s=Object.prototype,i=r.toString,o=s.hasOwnProperty,a=i.call(Object),c=s.toString,l=n(Object.getPrototypeOf,Object);function h(d){return!!d&&typeof d=="object"}function u(d){if(!h(d)||c.call(d)!=t||e(d))return!1;var _=l(d);if(_===null)return!0;var v=o.call(_,"constructor")&&_.constructor;return typeof v=="function"&&v instanceof v&&i.call(v)==a}return Jt=u,Jt}No();const tt="MAKE_MOVE",Mt="GAME_EVENT",Tt="REDO",Vn="RESET",Hn="SYNC",Dt="UNDO",Wn="UPDATE",zn="PATCH",qs="PLUGIN",Rt="STRIP_TRANSIENTS",Vs=(t,e,n,r)=>({type:tt,payload:{type:t,args:e,playerID:n,credentials:r}}),Xe=(t,e,n,r)=>({type:Mt,payload:{type:t,args:e,playerID:n,credentials:r}}),Hs=(t,e,n,r)=>({type:Mt,payload:{type:t,args:e,playerID:n,credentials:r},automatic:!0}),Ws=t=>({type:Hn,state:t.state,log:t.log,initialState:t.initialState,clientOnly:!0}),zs=(t,e,n,r)=>({type:zn,prevStateID:t,stateID:e,patch:n,deltalog:r,clientOnly:!0}),Js=(t,e)=>({type:Wn,state:t,deltalog:e,clientOnly:!0}),Ks=t=>({type:Vn,state:t,clientOnly:!0}),Ys=(t,e)=>({type:Dt,payload:{type:null,args:null,playerID:t,credentials:e}}),Xs=(t,e)=>({type:Tt,payload:{type:null,args:null,playerID:t,credentials:e}}),Mo=(t,e,n,r)=>({type:qs,payload:{type:t,args:e,playerID:n,credentials:r}}),Qs=()=>({type:Rt});var To=Object.freeze({__proto__:null,makeMove:Vs,gameEvent:Xe,automaticGameEvent:Hs,sync:Ws,patch:zs,update:Js,reset:Ks,undo:Ys,redo:Xs,plugin:Mo,stripTransients:Qs});const $e="INVALID_MOVE",Do={name:"plugin-immer",fnWrap:t=>(e,...n)=>{let r=!1;const s=ko(e.G,i=>{const o=t({...e,G:i},...n);if(o===$e){r=!0;return}return o});return r?$e:s}};var W;(function(t){t.MOVE="MOVE",t.GAME_ON_END="GAME_ON_END",t.PHASE_ON_BEGIN="PHASE_ON_BEGIN",t.PHASE_ON_END="PHASE_ON_END",t.TURN_ON_BEGIN="TURN_ON_BEGIN",t.TURN_ON_MOVE="TURN_ON_MOVE",t.TURN_ON_END="TURN_ON_END"})(W||(W={}));var ge;(function(t){t.CalledOutsideHook="Events must be called from moves or the `onBegin`, `onEnd`, and `onMove` hooks.\nThis error probably means you called an event from other game code, like an `endIf` trigger or one of the `turn.order` methods.",t.EndTurnInOnEnd="`endTurn` is disallowed in `onEnd` hooks — the turn is already ending.",t.MaxTurnEndings=`Maximum number of turn endings exceeded for this update.
This likely means game code is triggering an infinite loop.`,t.PhaseEventInOnEnd="`setPhase` & `endPhase` are disallowed in a phase’s `onEnd` hook — the phase is already ending.\nIf you’re trying to dynamically choose the next phase when a phase ends, use the phase’s `next` trigger.",t.StageEventInOnEnd="`setStage`, `endStage` & `setActivePlayers` are disallowed in `onEnd` hooks.",t.StageEventInPhaseBegin="`setStage`, `endStage` & `setActivePlayers` are disallowed in a phase’s `onBegin` hook.\nUse `setActivePlayers` in a `turn.onBegin` hook or declare stages with `turn.activePlayers` instead.",t.StageEventInTurnBegin="`setStage` & `endStage` are disallowed in `turn.onBegin`.\nUse `setActivePlayers` or declare stages with `turn.activePlayers` instead."})(ge||(ge={}));class Ro{constructor(e,n,r){this.flow=e,this.playerID=r,this.dispatch=[],this.initialTurn=n.turn,this.updateTurnContext(n,void 0),this.maxEndedTurnsPerAction=n.numPlayers*100}api(){const e={_private:this};for(const n of this.flow.eventNames)e[n]=(...r)=>{this.dispatch.push({type:n,args:r,phase:this.currentPhase,turn:this.currentTurn,calledFrom:this.currentMethod,error:new Error("Events Plugin Error")})};return e}isUsed(){return this.dispatch.length>0}updateTurnContext(e,n){this.currentPhase=e.phase,this.currentTurn=e.turn,this.currentMethod=n}unsetCurrentMethod(){this.currentMethod=void 0}update(e){const n=e,r=({stack:s},i)=>({...n,plugins:{...n.plugins,events:{...n.plugins.events,data:{error:i+`
`+s}}}});e:for(let s=0;s<this.dispatch.length;s++){const i=this.dispatch[s],o=i.turn!==e.ctx.turn;if(this.currentTurn-this.initialTurn>=this.maxEndedTurnsPerAction)return r(i.error,ge.MaxTurnEndings);if(i.calledFrom===void 0)return r(i.error,ge.CalledOutsideHook);if(e.ctx.gameover)break e;switch(i.type){case"endStage":case"setStage":case"setActivePlayers":{switch(i.calledFrom){case W.TURN_ON_END:case W.PHASE_ON_END:return r(i.error,ge.StageEventInOnEnd);case W.PHASE_ON_BEGIN:return r(i.error,ge.StageEventInPhaseBegin);case W.TURN_ON_BEGIN:if(i.type==="setActivePlayers")break;return r(i.error,ge.StageEventInTurnBegin)}if(o)continue e;break}case"endTurn":{if(i.calledFrom===W.TURN_ON_END||i.calledFrom===W.PHASE_ON_END)return r(i.error,ge.EndTurnInOnEnd);if(o)continue e;break}case"endPhase":case"setPhase":{if(i.calledFrom===W.PHASE_ON_END)return r(i.error,ge.PhaseEventInOnEnd);if(i.phase!==e.ctx.phase)continue e;break}}const c=Hs(i.type,i.args,this.playerID);e=this.flow.processEvent(e,c)}return e}}const Jn={name:"events",noClient:({api:t})=>t._private.isUsed(),isInvalid:({data:t})=>t.error||!1,fnWrap:(t,e)=>(n,...r)=>{const s=n.events;s&&s._private.updateTurnContext(n.ctx,e);const i=t(n,...r);return s&&s._private.unsetCurrentMethod(),i},dangerouslyFlushRawState:({state:t,api:e})=>e._private.update(t),api:({game:t,ctx:e,playerID:n})=>new Ro(t.flow,e,n).api()},$o={name:"log",flush:()=>({}),api:({data:t})=>({setMetadata:e=>{t.metadata=e}}),setup:()=>({})},Lo={name:"plugin-serializable",fnWrap:t=>(e,...n)=>t(e,...n)},Bo=(...t)=>console.error(...t);function M(t){Bo("ERROR:",t)}const Kn=[Do,Ao,$o,Lo],it=[...Kn,Jn],Uo=(t,e,n)=>(n.game.plugins.filter(r=>r.action!==void 0).filter(r=>r.name===e.payload.type).forEach(r=>{const s=r.name,i=t.plugins[s]||{data:{}},o=r.action(i.data,e.payload);t={...t,plugins:{...t.plugins,[s]:{...i,data:o}}}}),t),Le=({plugins:t})=>Object.entries(t||{}).reduce((e,[n,{api:r}])=>(e[n]=r,e),{}),Zs=(t,e,n)=>[...Kn,...n,Jn].filter(r=>r.fnWrap!==void 0).reduce((r,{fnWrap:s})=>s(r,e),t),jo=(t,e)=>([...it,...e.game.plugins].filter(n=>n.setup!==void 0).forEach(n=>{const r=n.name,s=n.setup({G:t.G,ctx:t.ctx,game:e.game});t={...t,plugins:{...t.plugins,[r]:{data:s}}}}),t),bn=(t,e)=>([...it,...e.game.plugins].filter(n=>n.api!==void 0).forEach(n=>{const r=n.name,s=t.plugins[r]||{data:{}},i=n.api({G:t.G,ctx:t.ctx,data:s.data,game:e.game,playerID:e.playerID});t={...t,plugins:{...t.plugins,[r]:{...s,api:i}}}}),t),Go=(t,e)=>([...Kn,...e.game.plugins,Jn].reverse().forEach(n=>{const r=n.name,s=t.plugins[r]||{data:{}};if(n.flush){const i=n.flush({G:t.G,ctx:t.ctx,game:e.game,api:s.api,data:s.data});t={...t,plugins:{...t.plugins,[n.name]:{data:i}}}}else if(n.dangerouslyFlushRawState){t=n.dangerouslyFlushRawState({state:t,game:e.game,api:s.api,data:s.data});const i=t.plugins[r].data;t={...t,plugins:{...t.plugins,[n.name]:{data:i}}}}}),t),Fo=(t,e)=>[...it,...e.game.plugins].filter(n=>n.noClient!==void 0).map(n=>{const r=n.name,s=t.plugins[r];return s?n.noClient({G:t.G,ctx:t.ctx,game:e.game,api:s.api,data:s.data}):!1}).includes(!0),qo=(t,e)=>[...it,...e.game.plugins].filter(r=>r.isInvalid!==void 0).map(r=>{const{name:s}=r,i=t.plugins[s],o=r.isInvalid({G:t.G,ctx:t.ctx,game:e.game,data:i&&i.data});return o?{plugin:s,message:o}:!1}).find(r=>r)||!1,ei=(t,e)=>{const n=Go(t,e),r=qo(n,e);if(!r)return[n];const{plugin:s,message:i}=r;return M(`${s} plugin declared action invalid:
${i}`),[t,r]},ti=({G:t,ctx:e,plugins:n={}},{game:r,playerID:s})=>([...it,...r.plugins].forEach(({name:i,playerView:o})=>{if(!o)return;const{data:a}=n[i]||{data:{}},c=o({G:t,ctx:e,game:r,data:a,playerID:s});n={...n,[i]:{data:c}}}),n);function kt(t,e=!1){t.moveLimit&&(e&&(t.minMoves=t.moveLimit),t.maxMoves=t.moveLimit,delete t.moveLimit)}function It(t,e){let n={},r=[],s=null,i={},o={};if(Array.isArray(e)){const c={};e.forEach(l=>c[l]=xt.NULL),n=c}else{if(kt(e),e.next&&(s=e.next),e.revert&&(r=[...t._prevActivePlayers,{activePlayers:t.activePlayers,_activePlayersMinMoves:t._activePlayersMinMoves,_activePlayersMaxMoves:t._activePlayersMaxMoves,_activePlayersNumMoves:t._activePlayersNumMoves}]),e.currentPlayer!==void 0&&lt(n,i,o,t.currentPlayer,e.currentPlayer),e.others!==void 0)for(let c=0;c<t.playOrder.length;c++){const l=t.playOrder[c];l!==t.currentPlayer&&lt(n,i,o,l,e.others)}if(e.all!==void 0)for(let c=0;c<t.playOrder.length;c++){const l=t.playOrder[c];lt(n,i,o,l,e.all)}if(e.value)for(const c in e.value)lt(n,i,o,c,e.value[c]);if(e.minMoves)for(const c in n)i[c]===void 0&&(i[c]=e.minMoves);if(e.maxMoves)for(const c in n)o[c]===void 0&&(o[c]=e.maxMoves)}Object.keys(n).length===0&&(n=null),Object.keys(i).length===0&&(i=null),Object.keys(o).length===0&&(o=null);const a={};for(const c in n)a[c]=0;return{...t,activePlayers:n,_activePlayersMinMoves:i,_activePlayersMaxMoves:o,_activePlayersNumMoves:a,_prevActivePlayers:r,_nextActivePlayers:s}}function Vo(t){let{activePlayers:e,_activePlayersMinMoves:n,_activePlayersMaxMoves:r,_activePlayersNumMoves:s,_prevActivePlayers:i,_nextActivePlayers:o}=t;if(e&&Object.keys(e).length===0)if(o)t=It(t,o),{activePlayers:e,_activePlayersMinMoves:n,_activePlayersMaxMoves:r,_activePlayersNumMoves:s,_prevActivePlayers:i}=t;else if(i.length>0){const a=i.length-1;({activePlayers:e,_activePlayersMinMoves:n,_activePlayersMaxMoves:r,_activePlayersNumMoves:s}=i[a]),i=i.slice(0,a)}else e=null,n=null,r=null;return{...t,activePlayers:e,_activePlayersMinMoves:n,_activePlayersMaxMoves:r,_activePlayersNumMoves:s,_prevActivePlayers:i}}function lt(t,e,n,r,s){(typeof s!="object"||s===xt.NULL)&&(s={stage:s}),s.stage!==void 0&&(kt(s),t[r]=s.stage,s.minMoves&&(e[r]=s.minMoves),s.maxMoves&&(n[r]=s.maxMoves))}function wn(t,e){return t[e]+""}function Ho(t,e){let{G:n,ctx:r}=t;const{numPlayers:s}=r,o={...Le(t),G:n,ctx:r},a=e.order;let c=[...Array.from({length:s})].map((d,_)=>_+"");a.playOrder!==void 0&&(c=a.playOrder(o));const l=a.first(o),h=typeof l;h!=="number"&&M(`invalid value returned by turn.order.first — expected number got ${h} “${l}”.`);const u=wn(c,l);return r={...r,currentPlayer:u,playOrderPos:l,playOrder:c},r=It(r,e.activePlayers||{}),r}function Wo(t,e,n,r){const s=n.order;let{G:i,ctx:o}=t,a=o.playOrderPos,c=!1;if(r&&r!==!0)typeof r!="object"&&M(`invalid argument to endTurn: ${r}`),Object.keys(r).forEach(l=>{switch(l){case"remove":e=wn(o.playOrder,a);break;case"next":a=o.playOrder.indexOf(r.next),e=r.next;break;default:M(`invalid argument to endTurn: ${l}`)}});else{const h={...Le(t),G:i,ctx:o},u=s.next(h),d=typeof u;u!==void 0&&d!=="number"&&M(`invalid value returned by turn.order.next — expected number or undefined got ${d} “${u}”.`),u===void 0?c=!0:(a=u,e=wn(o.playOrder,a))}return o={...o,playOrderPos:a,currentPlayer:e},{endPhase:c,ctx:o}}const zo={DEFAULT:{first:({ctx:t})=>t.turn===0?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:({ctx:t})=>(t.playOrderPos+1)%t.playOrder.length}},xt={NULL:null},Jo=t=>{const[,e,n]=t.split("-");return[e,n].map(r=>parseInt(r,10))},ni=(t,e,n,r)=>{const s=(e+t)%2===0?"up":"down",i=`t-${t}-${e}`,o=(s==="down"?[[t-1,e],[t,e-1],[t,e+1]]:[[t+1,e],[t,e-1],[t,e+1]]).filter(([a,c])=>a>=0&&a<n&&c>=0&&c<r).map(([a,c])=>`t-${a}-${c}`);return{row:t,col:e,direction:s,id:i,neighborIds:o}},Ko=(t,e,n)=>{const[r,s]=Jo(t);return ni(r,s,e,n)},ri=(t,e,n)=>{for(let r=0;r<e;r++)for(let s=0;s<n;s++)t(r,s)},si=(t,e)=>{const n=new Set;return ri((r,s)=>{if(r===0||r===t-1||s===0||s===e-1){const i=`t-${r}-${s}`;n.add(i)}},t,e),n},Yo=(t,e,n,r)=>{const s=new Set,i=new Set,o=si(n,r),a=Object.entries(t).filter(([l,h])=>h!==e).map(([l,h])=>l),c=Array.from([...o,...a]);for(;c.length>0;){const l=c.shift();if(i.has(l)||(i.add(l),t[l]===e))continue;s.add(l);const u=Ko(l,n,r);for(const d of u.neighborIds){if(i.has(d))continue;t[d]!==e&&(s.add(d),c.push(d))}}return s},Xo=(t,e,n,r)=>{const s=Yo(t,e,n,r),i=new Set;return ri((o,a)=>{const c=`t-${o}-${a}`;!s.has(c)&&t[c]===void 0&&i.add(c)},n,r),i},Ir=({G:t,events:e})=>{t.tries=Math.floor(Math.random()*6)+1,e.endStage()},xr=({G:t,ctx:e},n)=>{const r=t.stagedCells.includes(n);if(t.stagedCells.length>=t.tries&&!r||t.capturedCells[n]!==void 0)return $e;const s=parseInt(e.currentPlayer,10);r?t.stagedCells=t.stagedCells.filter(o=>o!==n):t.stagedCells.push(n);const i=Object.fromEntries(t.stagedCells.map(o=>[o,s]));t.fillableGroup=[...Xo({...t.capturedCells,...i},s,t.boardRows,t.boardCols)]},Ar=({G:t})=>{t.stagedCells=[],t.fillableGroup=[]},Nr=({G:t,ctx:e,events:n})=>{if(t.stagedCells.length!==t.tries)return $e;const r=parseInt(e.currentPlayer,10);for(;t.stagedCells.length>0;){const s=t.stagedCells.pop();t.capturedCells[s]=r}for(;t.fillableGroup.length>0;){const s=t.fillableGroup.pop();t.capturedCells[s]=r}n.endTurn()},Qo=({capturedCells:t,stagedCells:e,currentPlayer:n})=>{const r={0:0,1:0,2:0};for(const s of Object.values(t))s in r&&(r[s]+=1);return n in r&&(r[n]+=e.length),Object.entries(r).sort(([s,i],[o,a])=>a-i)},Zo=({numPlayers:t,...e})=>{const[n,r,s]=Qo(e),i=Object.fromEntries([n,r,s]);return n[1]===r[1]?{winner:-1,scores:i}:{winner:parseInt(n[0],10),scores:i}},ea=(t,e)=>({setup:()=>({capturedCells:{},tries:0,stagedCells:[],fillableGroup:[],boardRows:t,boardCols:e}),minPlayers:2,maxPlayers:3,moves:{rollDice:Ir,pickCell:xr,revertPickCells:Ar,captureCells:Nr},endIf:({G:n,ctx:r})=>{const{capturedCells:s,stagedCells:i,fillableGroup:o}=n,a=Object.keys(s).length;if((n.boardRows-2)*(n.boardCols-2)>a+i.length+o.length)return;const{currentPlayer:l,numPlayers:h}=r,u=Zo({capturedCells:s,stagedCells:[...i,...o],currentPlayer:l,numPlayers:h});return u.winner===-1?{draw:!0}:{winner:u.winner.toString()}},onEnd:({G:n,ctx:r})=>{const s=parseInt(r.currentPlayer,10);for(;n.stagedCells.length>0;){const i=n.stagedCells.pop();n.capturedCells[i]=s}for(;n.fillableGroup.length>0;){const i=n.fillableGroup.pop();n.capturedCells[i]=s}},turn:{activePlayers:{currentPlayer:"roll"},stages:{roll:{moves:{rollDice:Ir},next:"pick"},pick:{moves:{pickCell:xr,captureCells:Nr,revertPickCells:Ar}}}}});var Se,R,Kt,Mr,Be=0,ii=[],$=A,Tr=$.__b,Dr=$.__r,Rr=$.diffed,$r=$.__c,Lr=$.unmount,Br=$.__;function je(t,e){$.__h&&$.__h(R,t,Be||e),Be=0;var n=R.__H||(R.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Yn(t){return Be=1,Xn(li,t)}function Xn(t,e,n){var r=je(Se++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):li(void 0,e),function(a){var c=r.__N?r.__N[0]:r.__[0],l=r.t(c,a);c!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=R,!R.__f)){var s=function(a,c,l){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(d){return!!d.__c});if(h.every(function(d){return!d.__N}))return!i||i.call(this,a,c,l);var u=r.__c.props!==a;return h.forEach(function(d){if(d.__N){var _=d.__[0];d.__=d.__N,d.__N=void 0,_!==d.__[0]&&(u=!0)}}),i&&i.call(this,a,c,l)||u};R.__f=!0;var i=R.shouldComponentUpdate,o=R.componentWillUpdate;R.componentWillUpdate=function(a,c,l){if(this.__e){var h=i;i=void 0,s(a,c,l),i=h}o&&o.call(this,a,c,l)},R.shouldComponentUpdate=s}return r.__N||r.__}function Qn(t,e){var n=je(Se++,3);!$.__s&&er(n.__H,e)&&(n.__=t,n.u=e,R.__H.__h.push(n))}function ot(t,e){var n=je(Se++,4);!$.__s&&er(n.__H,e)&&(n.__=t,n.u=e,R.__h.push(n))}function oi(t){return Be=5,pe(function(){return{current:t}},[])}function ai(t,e,n){Be=6,ot(function(){if(typeof t=="function"){var r=t(e());return function(){t(null),r&&typeof r=="function"&&r()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function pe(t,e){var n=je(Se++,7);return er(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function At(t,e){return Be=8,pe(function(){return t},e)}function Zn(t){var e=R.context[t.__c],n=je(Se++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(R)),e.props.value):t.__}function ci(t,e){$.useDebugValue&&$.useDebugValue(e?e(t):t)}function ui(){var t=je(Se++,11);if(!t.__){for(var e=R.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function ta(){for(var t;t=ii.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(yt),t.__H.__h.forEach(En),t.__H.__h=[]}catch(e){t.__H.__h=[],$.__e(e,t.__v)}}$.__b=function(t){R=null,Tr&&Tr(t)},$.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Br&&Br(t,e)},$.__r=function(t){Dr&&Dr(t),Se=0;var e=(R=t.__c).__H;e&&(Kt===R?(e.__h=[],R.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(yt),e.__h.forEach(En),e.__h=[],Se=0)),Kt=R},$.diffed=function(t){Rr&&Rr(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(ii.push(e)!==1&&Mr===$.requestAnimationFrame||((Mr=$.requestAnimationFrame)||na)(ta)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Kt=R=null},$.__c=function(t,e){e.some(function(n){try{n.__h.forEach(yt),n.__h=n.__h.filter(function(r){return!r.__||En(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],$.__e(r,n.__v)}}),$r&&$r(t,e)},$.unmount=function(t){Lr&&Lr(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{yt(r)}catch(s){e=s}}),n.__H=void 0,e&&$.__e(e,n.__v))};var Ur=typeof requestAnimationFrame=="function";function na(t){var e,n=function(){clearTimeout(r),Ur&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);Ur&&(e=requestAnimationFrame(n))}function yt(t){var e=R,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),R=e}function En(t){var e=R;t.__c=t.__(),R=e}function er(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function li(t,e){return typeof e=="function"?e(t):e}let ra="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",sa=(t=21)=>{let e="",n=t|0;for(;n--;)e+=ra[Math.random()*64|0];return e};var Yt={},me={},jr;function hi(){if(jr)return me;jr=1,Object.defineProperty(me,"__esModule",{value:!0}),me.Pointer=me.escapeToken=me.unescapeToken=void 0;function t(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}me.unescapeToken=t;function e(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}me.escapeToken=e;var n=(function(){function r(s){s===void 0&&(s=[""]),this.tokens=s}return r.fromJSON=function(s){var i=s.split("/").map(t);if(i[0]!=="")throw new Error("Invalid JSON Pointer: ".concat(s));return new r(i)},r.prototype.toString=function(){return this.tokens.map(e).join("/")},r.prototype.evaluate=function(s){for(var i=null,o="",a=s,c=1,l=this.tokens.length;c<l;c++)i=a,o=this.tokens[c],!(o=="__proto__"||o=="constructor"||o=="prototype")&&(a=(i||{})[o]);return{parent:i,key:o,value:a}},r.prototype.get=function(s){return this.evaluate(s).value},r.prototype.set=function(s,i){var o=this.evaluate(s);o.parent&&(o.parent[o.key]=i)},r.prototype.push=function(s){this.tokens.push(s)},r.prototype.add=function(s){var i=this.tokens.concat(String(s));return new r(i)},r})();return me.Pointer=n,me}var D={},Xt={},Gr;function fi(){return Gr||(Gr=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.clone=t.objectType=t.hasOwnProperty=void 0,t.hasOwnProperty=Object.prototype.hasOwnProperty;function e(s){return s===void 0?"undefined":s===null?"null":Array.isArray(s)?"array":typeof s}t.objectType=e;function n(s){return s!=null&&typeof s=="object"}function r(s){if(!n(s))return s;if(s.constructor==Array){for(var i=s.length,o=new Array(i),a=0;a<i;a++)o[a]=r(s[a]);return o}if(s.constructor==Date){var c=new Date(+s);return c}var l={};for(var h in s)t.hasOwnProperty.call(s,h)&&(l[h]=r(s[h]));return l}t.clone=r})(Xt)),Xt}var J={},Fr;function di(){if(Fr)return J;Fr=1,Object.defineProperty(J,"__esModule",{value:!0}),J.diffAny=J.diffObjects=J.diffArrays=J.intersection=J.subtract=J.isDestructive=void 0;var t=fi();function e(h){var u=h.op;return u==="remove"||u==="replace"||u==="copy"||u==="move"}J.isDestructive=e;function n(h,u){var d={};for(var _ in h)t.hasOwnProperty.call(h,_)&&h[_]!==void 0&&(d[_]=1);for(var v in u)t.hasOwnProperty.call(u,v)&&u[v]!==void 0&&delete d[v];return Object.keys(d)}J.subtract=n;function r(h){for(var u=h.length,d={},_=0;_<u;_++){var v=h[_];for(var E in v)t.hasOwnProperty.call(v,E)&&v[E]!==void 0&&(d[E]=(d[E]||0)+1)}for(var E in d)d[E]<u&&delete d[E];return Object.keys(d)}J.intersection=r;function s(h){return h.op==="add"}function i(h){return h.op==="remove"}function o(h,u){return{operations:h.operations.concat(u),cost:h.cost+1}}function a(h,u,d,_){_===void 0&&(_=l);var v={"0,0":{operations:[],cost:0}};function E(P,C){var B="".concat(P,",").concat(C),G=v[B];if(G===void 0){if(P>0&&C>0&&!_(h[P-1],u[C-1],d.add(String(P-1))).length)G=E(P-1,C-1);else{var Y=[];if(P>0){var re=E(P-1,C),se={op:"remove",index:P-1};Y.push(o(re,se))}if(C>0){var F=E(P,C-1),q={op:"add",index:P-1,value:u[C-1]};Y.push(o(F,q))}if(P>0&&C>0){var Me=E(P-1,C-1),Fe={op:"replace",index:P-1,original:h[P-1],value:u[C-1]};Y.push(o(Me,Fe))}var at=Y.sort(function(jt,Gt){return jt.cost-Gt.cost})[0];G=at}v[B]=G}return G}var b=isNaN(h.length)||h.length<=0?0:h.length,m=isNaN(u.length)||u.length<=0?0:u.length,f=E(b,m).operations,g=f.reduce(function(P,C){var B=P[0],G=P[1];if(s(C)){var Y=C.index+1+G,re=Y<b+G?String(Y):"-",se={op:C.op,path:d.add(re).toString(),value:C.value};return[B.concat(se),G+1]}else if(i(C)){var se={op:C.op,path:d.add(String(C.index+G)).toString()};return[B.concat(se),G-1]}else{var F=d.add(String(C.index+G)),q=_(C.original,C.value,F);return[B.concat.apply(B,q),G]}},[[],0])[0];return g}J.diffArrays=a;function c(h,u,d,_){_===void 0&&(_=l);var v=[];return n(h,u).forEach(function(E){v.push({op:"remove",path:d.add(E).toString()})}),n(u,h).forEach(function(E){v.push({op:"add",path:d.add(E).toString(),value:u[E]})}),r([h,u]).forEach(function(E){v.push.apply(v,_(h[E],u[E],d.add(E)))}),v}J.diffObjects=c;function l(h,u,d,_){if(_===void 0&&(_=l),h===u)return[];var v=(0,t.objectType)(h),E=(0,t.objectType)(u);return v=="array"&&E=="array"?a(h,u,d,_):v=="object"&&E=="object"?c(h,u,d,_):[{op:"replace",path:d.toString(),value:u}]}return J.diffAny=l,J}var qr;function ia(){if(qr)return D;qr=1;var t=D&&D.__extends||(function(){var b=function(m,f){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,P){g.__proto__=P}||function(g,P){for(var C in P)Object.prototype.hasOwnProperty.call(P,C)&&(g[C]=P[C])},b(m,f)};return function(m,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");b(m,f);function g(){this.constructor=m}m.prototype=f===null?Object.create(f):(g.prototype=f.prototype,new g)}})();Object.defineProperty(D,"__esModule",{value:!0}),D.apply=D.InvalidOperationError=D.test=D.copy=D.move=D.replace=D.remove=D.add=D.TestError=D.MissingError=void 0;var e=hi(),n=fi(),r=di(),s=(function(b){t(m,b);function m(f){var g=b.call(this,"Value required at path: ".concat(f))||this;return g.path=f,g.name="MissingError",g}return m})(Error);D.MissingError=s;var i=(function(b){t(m,b);function m(f,g){var P=b.call(this,"Test failed: ".concat(f," != ").concat(g))||this;return P.actual=f,P.expected=g,P.name="TestError",P}return m})(Error);D.TestError=i;function o(b,m,f){if(Array.isArray(b))if(m=="-")b.push(f);else{var g=parseInt(m,10);b.splice(g,0,f)}else b[m]=f}function a(b,m){if(Array.isArray(b)){var f=parseInt(m,10);b.splice(f,1)}else delete b[m]}function c(b,m){var f=e.Pointer.fromJSON(m.path).evaluate(b);return f.parent===void 0?new s(m.path):(o(f.parent,f.key,(0,n.clone)(m.value)),null)}D.add=c;function l(b,m){var f=e.Pointer.fromJSON(m.path).evaluate(b);return f.value===void 0?new s(m.path):(a(f.parent,f.key),null)}D.remove=l;function h(b,m){var f=e.Pointer.fromJSON(m.path).evaluate(b);if(f.parent===null)return new s(m.path);if(Array.isArray(f.parent)){if(parseInt(f.key,10)>=f.parent.length)return new s(m.path)}else if(f.value===void 0)return new s(m.path);return f.parent[f.key]=(0,n.clone)(m.value),null}D.replace=h;function u(b,m){var f=e.Pointer.fromJSON(m.from).evaluate(b);if(f.value===void 0)return new s(m.from);var g=e.Pointer.fromJSON(m.path).evaluate(b);return g.parent===void 0?new s(m.path):(a(f.parent,f.key),o(g.parent,g.key,f.value),null)}D.move=u;function d(b,m){var f=e.Pointer.fromJSON(m.from).evaluate(b);if(f.value===void 0)return new s(m.from);var g=e.Pointer.fromJSON(m.path).evaluate(b);return g.parent===void 0?new s(m.path):(o(g.parent,g.key,(0,n.clone)(f.value)),null)}D.copy=d;function _(b,m){var f=e.Pointer.fromJSON(m.path).evaluate(b);return(0,r.diffAny)(f.value,m.value,new e.Pointer).length?new i(f.value,m.value):null}D.test=_;var v=(function(b){t(m,b);function m(f){var g=b.call(this,"Invalid operation: ".concat(f.op))||this;return g.operation=f,g.name="InvalidOperationError",g}return m})(Error);D.InvalidOperationError=v;function E(b,m){switch(m.op){case"add":return c(b,m);case"remove":return l(b,m);case"replace":return h(b,m);case"move":return u(b,m);case"copy":return d(b,m);case"test":return _(b,m)}return new v(m)}return D.apply=E,D}var Vr;function oa(){return Vr||(Vr=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createTests=t.createPatch=t.applyPatch=t.Pointer=void 0;var e=hi();Object.defineProperty(t,"Pointer",{enumerable:!0,get:function(){return e.Pointer}});var n=ia(),r=di();function s(l,h){return h.map(function(u){return(0,n.apply)(l,u)})}t.applyPatch=s;function i(l){function h(u,d,_){var v=l(u,d,_);return Array.isArray(v)?v:(0,r.diffAny)(u,d,_,h)}return h}function o(l,h,u){var d=new e.Pointer;return(u?i(u):r.diffAny)(l,h,d)}t.createPatch=o;function a(l,h){var u=e.Pointer.fromJSON(h).evaluate(l);if(u!==void 0)return{op:"test",path:h,value:u.value}}function c(l,h){var u=new Array;return h.filter(r.isDestructive).forEach(function(d){var _=a(l,d.path);if(_&&u.push(_),"from"in d){var v=a(l,d.from);v&&u.push(v)}}),u}t.createTests=c})(Yt)),Yt}var pi=oa();function aa({moves:t,phases:e,endIf:n,onEnd:r,turn:s,events:i,plugins:o}){t===void 0&&(t={}),i===void 0&&(i={}),o===void 0&&(o=[]),e===void 0&&(e={}),n||(n=()=>{}),r||(r=({G:p})=>p),s||(s={});const a={...e};""in a&&M("cannot specify phase with empty name"),a[""]={};const c={},l=new Set;let h=null;Object.keys(t).forEach(p=>l.add(p));const u=(p,y)=>{const w=Zs(p,y,o);return x=>{const k=Le(x);return w({...k,G:x.G,ctx:x.ctx,playerID:x.playerID})}},d=p=>y=>{const w=Le(y);return p({...w,G:y.G,ctx:y.ctx})},_={onEnd:u(r,W.GAME_ON_END),endIf:d(n)};for(const p in a){const y=a[p];if(y.start===!0&&(h=p),y.moves!==void 0)for(const w of Object.keys(y.moves))c[p+"."+w]=y.moves[w],l.add(w);y.endIf===void 0&&(y.endIf=()=>{}),y.onBegin===void 0&&(y.onBegin=({G:w})=>w),y.onEnd===void 0&&(y.onEnd=({G:w})=>w),y.turn===void 0&&(y.turn=s),y.turn.order===void 0&&(y.turn.order=zo.DEFAULT),y.turn.onBegin===void 0&&(y.turn.onBegin=({G:w})=>w),y.turn.onEnd===void 0&&(y.turn.onEnd=({G:w})=>w),y.turn.endIf===void 0&&(y.turn.endIf=()=>!1),y.turn.onMove===void 0&&(y.turn.onMove=({G:w})=>w),y.turn.stages===void 0&&(y.turn.stages={}),kt(y.turn,!0);for(const w in y.turn.stages){const k=y.turn.stages[w].moves||{};for(const O of Object.keys(k)){const L=p+"."+w+"."+O;c[L]=k[O],l.add(O)}}if(y.wrapped={onBegin:u(y.onBegin,W.PHASE_ON_BEGIN),onEnd:u(y.onEnd,W.PHASE_ON_END),endIf:d(y.endIf)},y.turn.wrapped={onMove:u(y.turn.onMove,W.TURN_ON_MOVE),onBegin:u(y.turn.onBegin,W.TURN_ON_BEGIN),onEnd:u(y.turn.onEnd,W.TURN_ON_END),endIf:d(y.turn.endIf)},typeof y.next!="function"){const{next:w}=y;y.next=()=>w||null}y.wrapped.next=d(y.next)}function v(p){return p.phase?a[p.phase]:a[""]}function E(p){return p}function b(p,y){const w=new Set,x=new Set;for(let k=0;k<y.length;k++){const{fn:O,arg:L,...T}=y[k];if(O===q){x.clear();const z=p.ctx.phase;if(w.has(z)){const ce={...p.ctx,phase:null};return{...p,ctx:ce}}w.add(z)}const te=[];if(p=O(p,{...T,arg:L,next:te}),O===F)break;const U=Y(p);if(U){y.push({fn:F,arg:U,turn:p.ctx.turn,phase:p.ctx.phase,automatic:!0});continue}const V=re(p);if(V){y.push({fn:q,arg:V,turn:p.ctx.turn,phase:p.ctx.phase,automatic:!0});continue}if([E,B,G].includes(O)){const z=se(p);if(z){y.push({fn:Me,arg:z,turn:p.ctx.turn,phase:p.ctx.phase,automatic:!0});continue}}y.push(...te)}return p}function m(p,{next:y}){return y.push({fn:f}),p}function f(p,{next:y}){let{G:w,ctx:x}=p;return w=v(x).wrapped.onBegin(p),y.push({fn:g}),{...p,G:w,ctx:x}}function g(p,{currentPlayer:y}){let{ctx:w}=p;const x=v(w);y?(w={...w,currentPlayer:y},x.turn.activePlayers&&(w=It(w,x.turn.activePlayers))):w=Ho(p,x.turn);const k=w.turn+1;w={...w,turn:k,numMoves:0,_prevActivePlayers:[]};const O=x.turn.wrapped.onBegin({...p,ctx:w});return{...p,G:O,ctx:w,_undo:[],_redo:[]}}function P(p,{arg:y,next:w,phase:x}){const k=v({phase:x});let{ctx:O}=p;if(y&&y.next)if(y.next in a)O={...O,phase:y.next};else return M("invalid phase: "+y.next),p;else O={...O,phase:k.wrapped.next(p)||null};return p={...p,ctx:O},w.push({fn:f}),p}function C(p,{arg:y,currentPlayer:w,next:x}){let{G:k,ctx:O}=p;const L=v(O),{endPhase:T,ctx:te}=Wo(p,w,L.turn,y);return O=te,p={...p,G:k,ctx:O},T?x.push({fn:q,turn:O.turn,phase:O.phase}):x.push({fn:g,currentPlayer:O.currentPlayer}),p}function B(p,{arg:y,playerID:w}){if((typeof y=="string"||y===xt.NULL)&&(y={stage:y}),typeof y!="object")return p;kt(y);let{ctx:x}=p,{activePlayers:k,_activePlayersMinMoves:O,_activePlayersMaxMoves:L,_activePlayersNumMoves:T}=x;return y.stage!==void 0&&(k===null&&(k={}),k[w]=y.stage,T[w]=0,y.minMoves&&(O===null&&(O={}),O[w]=y.minMoves),y.maxMoves&&(L===null&&(L={}),L[w]=y.maxMoves)),x={...x,activePlayers:k,_activePlayersMinMoves:O,_activePlayersMaxMoves:L,_activePlayersNumMoves:T},{...p,ctx:x}}function G(p,{arg:y}){return{...p,ctx:It(p.ctx,y)}}function Y(p){return _.endIf(p)}function re(p){return v(p.ctx).wrapped.endIf(p)}function se(p){const y=v(p.ctx),w=p.ctx.numMoves||0;return y.turn.maxMoves&&w>=y.turn.maxMoves?!0:y.turn.wrapped.endIf(p)}function F(p,{arg:y,phase:w}){p=q(p,{}),y===void 0&&(y=!0),p={...p,ctx:{...p.ctx,gameover:y}};const x=_.onEnd(p);return{...p,G:x}}function q(p,{arg:y,next:w,turn:x,automatic:k}){p=Me(p,{turn:x,force:!0,automatic:!0});const{phase:O,turn:L}=p.ctx;if(w&&w.push({fn:P,arg:y,phase:O}),O===null)return p;const te=v(p.ctx).wrapped.onEnd(p),U={...p.ctx,phase:null},V=Xe("endPhase",y),{_stateID:z}=p,ce={action:V,_stateID:z,turn:L,phase:O};k&&(ce.automatic=!0);const Ce=[...p.deltalog||[],ce];return{...p,G:te,ctx:U,deltalog:Ce}}function Me(p,{arg:y,next:w,turn:x,force:k,automatic:O,playerID:L}){if(x!==p.ctx.turn)return p;const{currentPlayer:T,numMoves:te,phase:U,turn:V}=p.ctx,z=v(p.ctx),ce=te||0;if(!k&&z.turn.minMoves&&ce<z.turn.minMoves)return`${z.turn.minMoves}`,p;const Ce=z.turn.wrapped.onEnd(p);w&&w.push({fn:C,arg:y,currentPlayer:T});let Ee={...p.ctx,activePlayers:null};if(y&&y.remove){L=L||T;const Oe=Ee.playOrder.filter(oo=>oo!=L),io=Ee.playOrderPos>Oe.length-1?0:Ee.playOrderPos;if(Ee={...Ee,playOrder:Oe,playOrderPos:io},Oe.length===0)return w.push({fn:q,turn:V,phase:U}),p}const Ft=Xe("endTurn",y),{_stateID:fr}=p,qe={action:Ft,_stateID:fr,turn:V,phase:U};O&&(qe.automatic=!0);const qt=[...p.deltalog||[],qe];return{...p,G:Ce,ctx:Ee,deltalog:qt,_undo:[],_redo:[]}}function Fe(p,{arg:y,next:w,automatic:x,playerID:k}){k=k||p.ctx.currentPlayer;let{ctx:O,_stateID:L}=p,{activePlayers:T,_activePlayersNumMoves:te,_activePlayersMinMoves:U,_activePlayersMaxMoves:V,phase:z,turn:ce}=O;const Ce=T!==null&&k in T,Ee=v(O);if(!y&&Ce){const Oe=Ee.turn.stages[T[k]];Oe&&Oe.next&&(y=Oe.next)}if(w&&w.push({fn:B,arg:y,playerID:k}),!Ce)return p;const Ft=te[k]||0;if(U&&U[k]&&Ft<U[k])return`${U[k]}`,p;T={...T},delete T[k],U&&(U={...U},delete U[k]),V&&(V={...V},delete V[k]),O=Vo({...O,activePlayers:T,_activePlayersMinMoves:U,_activePlayersMaxMoves:V});const qe={action:Xe("endStage",y),_stateID:L,turn:ce,phase:z};x&&(qe.automatic=!0);const qt=[...p.deltalog||[],qe];return{...p,ctx:O,deltalog:qt}}function at(p,y,w){const x=v(p),k=x.turn.stages,{activePlayers:O}=p;if(O&&O[w]!==void 0&&O[w]!==xt.NULL&&k[O[w]]!==void 0&&k[O[w]].moves!==void 0){const T=k[O[w]].moves;if(y in T)return T[y]}else if(x.moves){if(y in x.moves)return x.moves[y]}else if(y in t)return t[y];return null}function jt(p,y){const{playerID:w,type:x}=y,{currentPlayer:k,activePlayers:O,_activePlayersMaxMoves:L}=p.ctx,T=at(p.ctx,x,w),te=!T||typeof T=="function"||T.noLimit!==!0;let{numMoves:U,_activePlayersNumMoves:V}=p.ctx;te&&(w===k&&U++,O&&V[w]++),p={...p,ctx:{...p.ctx,numMoves:U,_activePlayersNumMoves:V}},L&&V[w]>=L[w]&&(p=Fe(p,{playerID:w,automatic:!0}));const ce=v(p.ctx).turn.wrapped.onMove({...p,playerID:w});return p={...p,G:ce},b(p,[{fn:E}])}function Gt(p,y,w){return b(p,[{fn:Fe,arg:w,playerID:y}])}function Yi(p,y){return b(p,[{fn:Fe,playerID:y}])}function Xi(p,y,w){return b(p,[{fn:G,arg:w}])}function Qi(p,y,w){return b(p,[{fn:q,phase:p.ctx.phase,turn:p.ctx.turn,arg:{next:w}}])}function Zi(p){return b(p,[{fn:q,phase:p.ctx.phase,turn:p.ctx.turn}])}function eo(p,y,w){return b(p,[{fn:Me,turn:p.ctx.turn,phase:p.ctx.phase,arg:w}])}function to(p,y,w){return b(p,[{fn:Me,turn:p.ctx.turn,phase:p.ctx.phase,force:!0,arg:w}])}function no(p,y,w){return b(p,[{fn:F,turn:p.ctx.turn,phase:p.ctx.phase,arg:w}])}const ct={endStage:Yi,setStage:Gt,endTurn:eo,pass:to,endPhase:Zi,setPhase:Qi,endGame:no,setActivePlayers:Xi},ye=[];i.endTurn!==!1&&ye.push("endTurn"),i.pass!==!1&&ye.push("pass"),i.endPhase!==!1&&ye.push("endPhase"),i.setPhase!==!1&&ye.push("setPhase"),i.endGame!==!1&&ye.push("endGame"),i.setActivePlayers!==!1&&ye.push("setActivePlayers"),i.endStage!==!1&&ye.push("endStage"),i.setStage!==!1&&ye.push("setStage");function ro(p,y){const{type:w,playerID:x,args:k}=y.payload;return typeof ct[w]!="function"?p:ct[w](p,x,...Array.isArray(k)?k:[k])}function so(p,y,w){return y.activePlayers?w in y.activePlayers:y.currentPlayer===w}return{ctx:p=>({numPlayers:p,turn:0,currentPlayer:"0",playOrder:[...Array.from({length:p})].map((y,w)=>w+""),playOrderPos:0,phase:h,activePlayers:null}),init:p=>b(p,[{fn:m}]),isPlayerActive:so,eventHandlers:ct,eventNames:Object.keys(ct),enabledEventNames:ye,moveMap:c,moveNames:[...l.values()],processMove:jt,processEvent:ro,getMove:at}}function ca(t){return t.processMove!==void 0}function $t(t){if(ca(t))return t;if(t.name===void 0&&(t.name="default"),t.deltaState===void 0&&(t.deltaState=!1),t.disableUndo===void 0&&(t.disableUndo=!1),t.setup===void 0&&(t.setup=()=>({})),t.moves===void 0&&(t.moves={}),t.playerView===void 0&&(t.playerView=({G:n})=>n),t.plugins===void 0&&(t.plugins=[]),t.plugins.forEach(n=>{if(n.name===void 0)throw new Error("Plugin missing name attribute");if(n.name.includes(" "))throw new Error(n.name+": Plugin name must not include spaces")}),t.name.includes(" "))throw new Error(t.name+": Game name must not include spaces");const e=aa(t);return{...t,flow:e,moveNames:e.moveNames,pluginNames:t.plugins.map(n=>n.name),processMove:(n,r)=>{let s=e.getMove(n.ctx,r.type,r.playerID);if(_i(s)&&(s=s.move),s instanceof Function){const i=Zs(s,W.MOVE,t.plugins);let o=[];r.args!==void 0&&(o=Array.isArray(r.args)?r.args:[r.args]);const a={...Le(n),G:n.G,ctx:n.ctx,playerID:r.playerID};return i(a,...o)}return M(`invalid move object: ${r.type}`),n.G}}}function _i(t){return t instanceof Object&&t.move!==void 0}var Pn;(function(t){t.UnauthorizedAction="update/unauthorized_action",t.MatchNotFound="update/match_not_found",t.PatchFailed="update/patch_failed"})(Pn||(Pn={}));var H;(function(t){t.StaleStateId="action/stale_state_id",t.UnavailableMove="action/unavailable_move",t.InvalidMove="action/invalid_move",t.InactivePlayer="action/inactive_player",t.GameOver="action/gameover",t.ActionDisabled="action/action_disabled",t.ActionInvalid="action/action_invalid",t.PluginActionInvalid="action/plugin_invalid"})(H||(H={}));const ht=t=>t.payload.playerID!==null&&t.payload.playerID!==void 0,ua=(t,e,n)=>{function r(i){return i.undoable!==void 0}function s(i){return i instanceof Function}return r(n)?s(n.undoable)?n.undoable({G:t,ctx:e}):n.undoable:!0};function Hr(t,e){if(e.game.disableUndo)return t;const n={G:t.G,ctx:t.ctx,plugins:t.plugins,playerID:e.action.payload.playerID||t.ctx.currentPlayer};return e.action.type==="MAKE_MOVE"&&(n.moveType=e.action.payload.type),{...t,_undo:[...t._undo,n],_redo:[]}}function Qt(t,e,n){const r={action:e,_stateID:t._stateID,turn:t.ctx.turn,phase:t.ctx.phase},s=t.plugins.log.data.metadata;return s!==void 0&&(r.metadata=s),typeof n=="object"&&n.redact===!0?r.redact=!0:typeof n=="object"&&n.redact instanceof Function&&(r.redact=n.redact({G:t.G,ctx:t.ctx})),{...t,deltalog:[r]}}function Zt(t,e,n){const[r,s]=ei(t,n);return s?[r,K(e,H.PluginActionInvalid,s)]:[r]}function yi(t){if(!t)return[null,void 0];const{transients:e,...n}=t;return[n,e]}function K(t,e,n){return{...t,transients:{error:{type:e,payload:n}}}}const mi=t=>e=>n=>{const r=e(n);if(n.type===Rt)return r;{const[,s]=yi(t.getState());return typeof s<"u"?(t.dispatch(Qs()),{...r,transients:s}):r}};function tr({game:t,isClient:e}){return t=$t(t),(n=null,r)=>{let[s]=yi(n);switch(r.type){case Rt:return s;case Mt:{if(s={...s,deltalog:[]},e)return s;if(s.ctx.gameover!==void 0)return M("cannot call event after game end"),K(s,H.GameOver);if(ht(r)&&!t.flow.isPlayerActive(s.G,s.ctx,r.payload.playerID))return M(`disallowed event: ${r.payload.type}`),K(s,H.InactivePlayer);s=bn(s,{game:t,playerID:r.payload.playerID});let i=t.flow.processEvent(s,r),o;return[i,o]=Zt(i,s,{game:t}),o||(i=Hr(i,{game:t,action:r}),{...i,_stateID:s._stateID+1})}case tt:{const i=s={...s,deltalog:[]},o=t.flow.getMove(s.ctx,r.payload.type,r.payload.playerID||s.ctx.currentPlayer);if(o===null)return M(`disallowed move: ${r.payload.type}`),K(s,H.UnavailableMove);if(e&&o.client===!1)return s;if(s.ctx.gameover!==void 0)return M("cannot make move after game end"),K(s,H.GameOver);if(ht(r)&&!t.flow.isPlayerActive(s.G,s.ctx,r.payload.playerID))return M(`disallowed move: ${r.payload.type}`),K(s,H.InactivePlayer);s=bn(s,{game:t,playerID:r.payload.playerID});const a=t.processMove(s,r.payload);if(a===$e)return M(`invalid move: ${r.payload.type} args: ${r.payload.args}`),K(s,H.InvalidMove);const c={...s,G:a};if(e&&Fo(c,{game:t}))return s;if(s=c,e){let h;return[s,h]=Zt(s,i,{game:t}),h||{...s,_stateID:s._stateID+1}}s=Qt(s,r,o),s=t.flow.processMove(s,r.payload);let l;return[s,l]=Zt(s,i,{game:t}),l||(s=Hr(s,{game:t,action:r}),{...s,_stateID:s._stateID+1})}case Vn:case Wn:case Hn:return r.state;case Dt:{if(s={...s,deltalog:[]},t.disableUndo)return M("Undo is not enabled"),K(s,H.ActionDisabled);const{G:i,ctx:o,_undo:a,_redo:c,_stateID:l}=s;if(a.length<2)return M("No moves to undo"),K(s,H.ActionInvalid);const h=a[a.length-1],u=a[a.length-2];if(ht(r)&&r.payload.playerID!==h.playerID)return M("Cannot undo other players' moves"),K(s,H.ActionInvalid);if(h.moveType){const d=t.flow.getMove(u.ctx,h.moveType,h.playerID);if(!ua(i,o,d))return M("Move cannot be undone"),K(s,H.ActionInvalid)}return s=Qt(s,r),{...s,G:u.G,ctx:u.ctx,plugins:u.plugins,_stateID:l+1,_undo:a.slice(0,-1),_redo:[h,...c]}}case Tt:{if(s={...s,deltalog:[]},t.disableUndo)return M("Redo is not enabled"),K(s,H.ActionDisabled);const{_undo:i,_redo:o,_stateID:a}=s;if(o.length===0)return M("No moves to redo"),K(s,H.ActionInvalid);const c=o[0];return ht(r)&&r.payload.playerID!==c.playerID?(M("Cannot redo other players' moves"),K(s,H.ActionInvalid)):(s=Qt(s,r),{...s,G:c.G,ctx:c.ctx,plugins:c.plugins,_stateID:a+1,_undo:[...i,c],_redo:o.slice(1)})}case qs:return Uo(s,r,{game:t});case zn:{const i=s,o=JSON.parse(JSON.stringify(i)),a=pi.applyPatch(o,r.patch);return a.some(l=>l!==null)?(M(`Patch ${JSON.stringify(r.patch)} apply failed`),K(i,Pn.PatchFailed,a)):o}default:return s}}}var en={},Wr;function la(){return Wr||(Wr=1,(function(t,e){if(t.setImmediate)return;var n=1,r={},s=!1,i=t.document,o;function a(f){typeof f!="function"&&(f=new Function(""+f));for(var g=new Array(arguments.length-1),P=0;P<g.length;P++)g[P]=arguments[P+1];var C={callback:f,args:g};return r[n]=C,o(n),n++}function c(f){delete r[f]}function l(f){var g=f.callback,P=f.args;switch(P.length){case 0:g();break;case 1:g(P[0]);break;case 2:g(P[0],P[1]);break;case 3:g(P[0],P[1],P[2]);break;default:g.apply(e,P);break}}function h(f){if(s)setTimeout(h,0,f);else{var g=r[f];if(g){s=!0;try{l(g)}finally{c(f),s=!1}}}}function u(){o=function(f){process.nextTick(function(){h(f)})}}function d(){if(t.postMessage&&!t.importScripts){var f=!0,g=t.onmessage;return t.onmessage=function(){f=!1},t.postMessage("","*"),t.onmessage=g,f}}function _(){var f="setImmediate$"+Math.random()+"$",g=function(P){P.source===t&&typeof P.data=="string"&&P.data.indexOf(f)===0&&h(+P.data.slice(f.length))};t.addEventListener?t.addEventListener("message",g,!1):t.attachEvent("onmessage",g),o=function(P){t.postMessage(f+P,"*")}}function v(){var f=new MessageChannel;f.port1.onmessage=function(g){var P=g.data;h(P)},o=function(g){f.port2.postMessage(g)}}function E(){var f=i.documentElement;o=function(g){var P=i.createElement("script");P.onreadystatechange=function(){h(g),P.onreadystatechange=null,f.removeChild(P),P=null},f.appendChild(P)}}function b(){o=function(f){setTimeout(h,0,f)}}var m=Object.getPrototypeOf&&Object.getPrototypeOf(t);m=m&&m.setTimeout?m:t,{}.toString.call(t.process)==="[object process]"?u():d()?_():t.MessageChannel?v():i&&"onreadystatechange"in i.createElement("script")?E():b(),m.setImmediate=a,m.clearImmediate=c})(typeof self>"u"?typeof Or>"u"?en:Or:self)),en}la();class ha{constructor({enumerate:e,seed:n}){this.enumerateFn=e,this.seed=n,this.iterationCounter=0,this._opts={}}addOpt({key:e,range:n,initial:r}){this._opts[e]={range:n,value:r}}getOpt(e){return this._opts[e].value}setOpt(e,n){e in this._opts&&(this._opts[e].value=n)}opts(){return this._opts}enumerate(e,n,r){return this.enumerateFn(e,n,r).map(i=>{if("payload"in i)return i;if("move"in i)return Vs(i.move,i.args,r);if("event"in i)return Xe(i.event,i.args,r)})}random(e){let n;if(this.seed!==void 0){const r=this.prngstate?"":this.seed,s=Gs(r,this.prngstate);n=s(),this.prngstate=s.state()}else n=Math.random();if(e)if(Array.isArray(e)){const r=Math.floor(n*e.length);return e[r]}else return Math.floor(n*e);return n}}const fa=25;class da extends ha{constructor({enumerate:e,seed:n,objectives:r,game:s,iterations:i,playoutDepth:o,iterationCallback:a}){super({enumerate:e,seed:n}),r===void 0&&(r=()=>({})),this.objectives=r,this.iterationCallback=a||(()=>{}),this.reducer=tr({game:s}),this.iterations=i,this.playoutDepth=o,this.addOpt({key:"async",initial:!1}),this.addOpt({key:"iterations",initial:typeof i=="number"?i:1e3,range:{min:1,max:2e3}}),this.addOpt({key:"playoutDepth",initial:typeof o=="number"?o:50,range:{min:1,max:100}})}createNode({state:e,parentAction:n,parent:r,playerID:s}){const{G:i,ctx:o}=e;let a=[],c=[];if(s!==void 0)a=this.enumerate(i,o,s),c=this.objectives(i,o,s);else if(o.activePlayers)for(const l in o.activePlayers)a.push(...this.enumerate(i,o,l)),c.push(this.objectives(i,o,l));else a=this.enumerate(i,o,o.currentPlayer),c=this.objectives(i,o,o.currentPlayer);return{state:e,parent:r,parentAction:n,actions:a,objectives:c,children:[],visits:0,value:0}}select(e){if(e.actions.length>0||e.children.length===0)return e;let n=null,r=0;for(const s of e.children){const i=s.visits+Number.EPSILON,o=s.value/i+Math.sqrt(2*Math.log(e.visits)/i);(n==null||o>r)&&(r=o,n=s)}return this.select(n)}expand(e){const n=e.actions;if(n.length===0||e.state.ctx.gameover!==void 0)return e;const r=this.random(n.length),s=n[r];e.actions.splice(r,1);const i=this.reducer(e.state,s),o=this.createNode({state:i,parentAction:s,parent:e});return e.children.push(o),o}playout({state:e}){let n=this.getOpt("playoutDepth");typeof this.playoutDepth=="function"&&(n=this.playoutDepth(e.G,e.ctx));for(let r=0;r<n&&e.ctx.gameover===void 0;r++){const{G:s,ctx:i}=e;let o=i.currentPlayer;i.activePlayers&&(o=Object.keys(i.activePlayers)[0]);const a=this.enumerate(s,i,o),c=this.objectives(s,i,o),l=Object.keys(c).reduce((d,_)=>{const v=c[_];return v.checker(s,i)?d+v.weight:d},0);if(l>0)return{score:l};if(!a||a.length===0)return;const h=this.random(a.length);e=this.reducer(e,a[h])}return e.ctx.gameover}backpropagate(e,n={}){e.visits++,n.score!==void 0&&(e.value+=n.score),n.draw===!0&&(e.value+=.5),e.parentAction&&n.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,n)}play(e,n){const r=this.createNode({state:e,playerID:n});let s=this.getOpt("iterations");typeof this.iterations=="function"&&(s=this.iterations(e.G,e.ctx));const i=()=>{let o=null;for(const l of r.children)(o==null||l.visits>o.visits)&&(o=l);return{action:o&&o.parentAction,metadata:r}};return new Promise(o=>{const a=()=>{for(let c=0;c<fa&&this.iterationCounter<s;c++){const l=this.select(r),h=this.expand(l),u=this.playout(h);this.backpropagate(h,u),this.iterationCounter++}this.iterationCallback({iterationCounter:this.iterationCounter,numIterations:s,metadata:r})};if(this.iterationCounter=0,this.getOpt("async")){const c=()=>{this.iterationCounter<s?(a(),setImmediate(c)):o(i())};c()}else{for(;this.iterationCounter<s;)a();o(i())}})}}function nt(t){"@babel/helpers - typeof";return nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(t)}function pa(t,e){if(nt(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(nt(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _a(t){var e=pa(t,"string");return nt(e)=="symbol"?e:e+""}function ya(t,e,n){return(e=_a(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Jr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zr(Object(n),!0).forEach(function(r){ya(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zr(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Q(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}var Kr=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})(),Yr=function(){return Math.random().toString(36).substring(7).split("").join(".")},Xr={INIT:"@@redux/INIT"+Yr(),REPLACE:"@@redux/REPLACE"+Yr()};function ma(t){if(typeof t!="object"||t===null)return!1;for(var e=t;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function nr(t,e,n){var r;if(typeof e=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(Q(0));if(typeof e=="function"&&typeof n>"u"&&(n=e,e=void 0),typeof n<"u"){if(typeof n!="function")throw new Error(Q(1));return n(nr)(t,e)}if(typeof t!="function")throw new Error(Q(2));var s=t,i=e,o=[],a=o,c=!1;function l(){a===o&&(a=o.slice())}function h(){if(c)throw new Error(Q(3));return i}function u(E){if(typeof E!="function")throw new Error(Q(4));if(c)throw new Error(Q(5));var b=!0;return l(),a.push(E),function(){if(b){if(c)throw new Error(Q(6));b=!1,l();var f=a.indexOf(E);a.splice(f,1),o=null}}}function d(E){if(!ma(E))throw new Error(Q(7));if(typeof E.type>"u")throw new Error(Q(8));if(c)throw new Error(Q(9));try{c=!0,i=s(i,E)}finally{c=!1}for(var b=o=a,m=0;m<b.length;m++){var f=b[m];f()}return E}function _(E){if(typeof E!="function")throw new Error(Q(10));s=E,d({type:Xr.REPLACE})}function v(){var E,b=u;return E={subscribe:function(f){if(typeof f!="object"||f===null)throw new Error(Q(11));function g(){f.next&&f.next(h())}g();var P=b(g);return{unsubscribe:P}}},E[Kr]=function(){return this},E}return d({type:Xr.INIT}),r={dispatch:d,subscribe:u,getState:h,replaceReducer:_},r[Kr]=v,r}function gi(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===0?function(r){return r}:e.length===1?e[0]:e.reduce(function(r,s){return function(){return r(s.apply(void 0,arguments))}})}function vi(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){return function(){var s=r.apply(void 0,arguments),i=function(){throw new Error(Q(15))},o={getState:s.getState,dispatch:function(){return i.apply(void 0,arguments)}},a=e.map(function(c){return c(o)});return i=gi.apply(void 0,a)(s.dispatch),Jr(Jr({},s),{},{dispatch:i})}}}function bi({game:t,numPlayers:e,setupData:n}){t=$t(t),e||(e=2);const r=t.flow.ctx(e);let s={G:{},ctx:r,plugins:{}};s=jo(s,{game:t}),s=bn(s,{game:t,playerID:void 0});const i=Le(s);s.G=t.setup({...i,ctx:s.ctx},n);let o={...s,_undo:[],_redo:[],_stateID:0};return o=t.flow.init(o),[o]=ei(o,{game:t}),t.disableUndo||(o._undo=[{G:o.G,ctx:o.ctx,plugins:o.plugins}]),o}let rr=class{constructor({transportDataCallback:e,gameName:n,playerID:r,matchID:s,credentials:i,numPlayers:o}){this.connectionStatusCallback=()=>{},this.isConnected=!1,this.transportDataCallback=e,this.gameName=n||"default",this.playerID=r||null,this.matchID=s||"default",this.credentials=i,this.numPlayers=o||2}subscribeToConnectionStatus(e){this.connectionStatusCallback=e}setConnectionStatus(e){this.isConnected=e,this.connectionStatusCallback()}notifyClient(e){this.transportDataCallback(e)}};class ga extends rr{connect(){}disconnect(){}sendAction(){}sendChatMessage(){}requestSync(){}updateCredentials(){}updateMatchID(){}updatePlayerID(){}}const va=t=>new ga(t);class ba{constructor(){this.debugPanel=null,this.currentClient=null,this.clients=new Map,this.subscribers=new Map}register(e){this.clients.set(e,e),this.mountDebug(e),this.notifySubscribers()}unregister(e){if(this.clients.delete(e),this.currentClient===e){this.unmountDebug();for(const[n]of this.clients){if(this.debugPanel)break;this.mountDebug(n)}}this.notifySubscribers()}subscribe(e){const n=Symbol();return this.subscribers.set(n,e),e(this.getState()),()=>{this.subscribers.delete(n)}}switchPlayerID(e){if(this.currentClient.multiplayer){for(const[n]of this.clients)if(n.playerID===e&&n.debugOpt!==!1&&n.multiplayer===this.currentClient.multiplayer){this.switchToClient(n);return}}this.currentClient.updatePlayerID(e),this.notifySubscribers()}switchToClient(e){e!==this.currentClient&&(this.unmountDebug(),this.mountDebug(e),this.notifySubscribers())}notifySubscribers(){const e=this.getState();this.subscribers.forEach(n=>{n(e)})}getState(){return{client:this.currentClient,debuggableClients:this.getDebuggableClients()}}getDebuggableClients(){return[...this.clients.values()].filter(e=>e.debugOpt!==!1)}mountDebug(e){if(e.debugOpt===!1||this.debugPanel!==null||typeof document>"u")return;let n,r=document.body;e.debugOpt&&e.debugOpt!==!0&&(n=e.debugOpt.impl||n,r=e.debugOpt.target||r),n&&(this.currentClient=e,this.debugPanel=new n({target:r,props:{clientManager:this}}))}unmountDebug(){this.debugPanel.$destroy(),this.debugPanel=null,this.currentClient=null}}const wa=new ba;function Sn(t,e,n){return!n&&t==null&&(t=e.getState().ctx.currentPlayer),t}function sr(t,e,n,r,s,i){const o={};for(const a of e)o[a]=(...c)=>{const l=To[t](a,c,Sn(r,n,i),s);n.dispatch(l)};return o}const Ea=sr.bind(null,"makeMove"),Pa=sr.bind(null,"gameEvent"),Sa=sr.bind(null,"plugin");class Ca{constructor({game:e,debug:n,numPlayers:r,multiplayer:s,matchID:i,playerID:o,credentials:a,enhancer:c}){this.game=$t(e),this.playerID=o,this.matchID=i||"default",this.credentials=a,this.multiplayer=s,this.debugOpt=n,this.manager=wa,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=tr({game:this.game,isClient:s!==void 0}),this.initialState=null,s||(this.initialState=bi({game:this.game,numPlayers:r})),this.reset=()=>{this.store.dispatch(Ks(this.initialState))},this.undo=()=>{const _=Ys(Sn(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(_)},this.redo=()=>{const _=Xs(Sn(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(_)},this.log=[];const d=vi(mi,()=>_=>v=>{const E=_(v);return this.notifySubscribers(),E},_=>v=>E=>{const b=_.getState(),m=v(E);return!("clientOnly"in E)&&E.type!==Rt&&this.transport.sendAction(b,E),m},_=>v=>E=>{const b=v(E),m=_.getState();switch(E.type){case tt:case Mt:case Dt:case Tt:{const f=m.deltalog;this.log=[...this.log,...f];break}case Vn:{this.log=[];break}case zn:case Wn:{let f=-1;this.log.length>0&&(f=this.log[this.log.length-1]._stateID);let g=E.deltalog||[];g=g.filter(P=>P._stateID>f),this.log=[...this.log,...g];break}case Hn:{this.initialState=E.initialState,this.log=E.log||[];break}}return b});c=c!==void 0?gi(d,c):d,this.store=nr(this.reducer,this.initialState,c),s||(s=va),this.transport=s({transportDataCallback:_=>this.receiveTransportData(_),gameKey:e,game:this.game,matchID:i,playerID:o,credentials:a,gameName:this.game.name,numPlayers:r}),this.createDispatchers(),this.chatMessages=[],this.sendChatMessage=_=>{this.transport.sendChatMessage(this.matchID,{id:sa(7),sender:this.playerID,payload:_})}}receiveMatchData(e){this.matchData=e,this.notifySubscribers()}receiveChatMessage(e){this.chatMessages=[...this.chatMessages,e],this.notifySubscribers()}receiveTransportData(e){const[n]=e.args;if(n===this.matchID)switch(e.type){case"sync":{const[,r]=e.args,s=Ws(r);this.receiveMatchData(r.filteredMetadata),this.store.dispatch(s);break}case"update":{const[,r,s]=e.args,i=this.store.getState();if(r._stateID>=i._stateID){const o=Js(r,s);this.store.dispatch(o)}break}case"patch":{const[,r,s,i,o]=e.args,a=this.store.getState()._stateID;if(r!==a)break;const c=zs(r,s,i,o);this.store.dispatch(c),this.store.getState()._stateID===a&&this.transport.requestSync();break}case"matchData":{const[,r]=e.args;this.receiveMatchData(r);break}case"chat":{const[,r]=e.args;this.receiveChatMessage(r);break}}}notifySubscribers(){Object.values(this.subscribers).forEach(e=>e(this.getState()))}overrideGameState(e){this.gameStateOverride=e,this.notifySubscribers()}start(){this.transport.connect(),this._running=!0,this.manager.register(this)}stop(){this.transport.disconnect(),this._running=!1,this.manager.unregister(this)}subscribe(e){const n=Object.keys(this.subscribers).length;return this.subscribers[n]=e,this.transport.subscribeToConnectionStatus(()=>this.notifySubscribers()),(this._running||!this.multiplayer)&&e(this.getState()),()=>{delete this.subscribers[n]}}getInitialState(){return this.initialState}getState(){let e=this.store.getState();if(this.gameStateOverride!==null&&(e=this.gameStateOverride),e===null)return e;let n=!0;const r=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);return this.multiplayer&&!r&&(n=!1),!this.multiplayer&&this.playerID!==null&&this.playerID!==void 0&&!r&&(n=!1),e.ctx.gameover!==void 0&&(n=!1),this.multiplayer||(e={...e,G:this.game.playerView({G:e.G,ctx:e.ctx,playerID:this.playerID}),plugins:ti(e,this)}),{...e,log:this.log,isActive:n,isConnected:this.transport.isConnected}}createDispatchers(){this.moves=Ea(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=Pa(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=Sa(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}updatePlayerID(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}updateMatchID(e){this.matchID=e,this.createDispatchers(),this.transport.updateMatchID(e),this.notifySubscribers()}updateCredentials(e){this.credentials=e,this.createDispatchers(),this.transport.updateCredentials(e),this.notifySubscribers()}}function Oa(t){return new Ca(t)}const wi=(t,e)=>{if(!t||typeof t!="string")throw new Error(`Expected ${e} string, got "${t}".`)},ke=t=>wi(t,"game name"),Ve=t=>wi(t,"match ID"),He=(t,e)=>{if(!t)throw new Error(`Expected body, got “${t}”.`);for(const n in e){const r=e[n],s=Array.isArray(r)?r:[r],i=t[n];if(!s.includes(typeof i)){const o=s.join("|");throw new TypeError(`Expected body.${n} to be of type ${o}, got “${i}”.`)}}};class ka extends Error{constructor(e,n){super(e),this.details=n}}class Ia{constructor({server:e=""}={}){this.server=e.replace(/\/$/,"")}async request(e,n){const r=await fetch(this.server+e,n);if(!r.ok){let s;try{s=await r.clone().json()}catch{try{s=await r.text()}catch(i){s=i.message}}throw new ka(`HTTP status ${r.status}`,s)}return r.json()}async post(e,n){let r={method:"post",body:JSON.stringify(n.body),headers:{"Content-Type":"application/json"}};return n.init&&(r={...r,...n.init,headers:{...r.headers,...n.init.headers}}),this.request(e,r)}async listGames(e){return this.request("/games",e)}async listMatches(e,n,r){ke(e);let s="";if(n){const i=[],{isGameover:o,updatedBefore:a,updatedAfter:c}=n;o!==void 0&&i.push(`isGameover=${o}`),a&&i.push(`updatedBefore=${a}`),c&&i.push(`updatedAfter=${c}`),i.length>0&&(s="?"+i.join("&"))}return this.request(`/games/${e}${s}`,r)}async getMatch(e,n,r){return ke(e),Ve(n),this.request(`/games/${e}/${n}`,r)}async createMatch(e,n,r){return ke(e),He(n,{numPlayers:"number"}),this.post(`/games/${e}/create`,{body:n,init:r})}async joinMatch(e,n,r,s){return ke(e),Ve(n),He(r,{playerID:["string","undefined"],playerName:"string"}),this.post(`/games/${e}/${n}/join`,{body:r,init:s})}async leaveMatch(e,n,r,s){ke(e),Ve(n),He(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${e}/${n}/leave`,{body:r,init:s})}async updatePlayer(e,n,r,s){ke(e),Ve(n),He(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${e}/${n}/update`,{body:r,init:s})}async playAgain(e,n,r,s){return ke(e),Ve(n),He(r,{playerID:"string",credentials:"string"}),this.post(`/games/${e}/${n}/playAgain`,{body:r,init:s})}}function Ei(t,e){for(var n in e)t[n]=e[n];return t}function Cn(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function Pi(t,e){var n=e(),r=Yn({t:{__:n,u:e}}),s=r[0].t,i=r[1];return ot(function(){s.__=n,s.u=e,tn(s)&&i({t:s})},[t,n,e]),Qn(function(){return tn(s)&&i({t:s}),t(function(){tn(s)&&i({t:s})})},[t]),n}function tn(t){var e,n,r=t.u,s=t.__;try{var i=r();return!((e=s)===(n=i)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Si(t){t()}function Ci(t){return t}function Oi(){return[!1,Si]}var ki=ot;function On(t,e){this.props=t,this.context=e}function xa(t,e){function n(s){var i=this.props.ref,o=i==s.ref;return!o&&i&&(i.call?i(null):i.current=null),e?!e(this.props,s)||!o:Cn(this.props,s)}function r(s){return this.shouldComponentUpdate=n,be(t,s)}return r.displayName="Memo("+(t.displayName||t.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r.type=t,r}(On.prototype=new he).isPureReactComponent=!0,On.prototype.shouldComponentUpdate=function(t,e){return Cn(this.props,t)||Cn(this.state,e)};var Qr=A.__b;A.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Qr&&Qr(t)};var Aa=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Na(t){function e(n){var r=Ei({},n);return delete r.ref,t(r,n.ref||null)}return e.$$typeof=Aa,e.render=t,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Zr=function(t,e){return t==null?null:ve(ve(t).map(e))},Ma={map:Zr,forEach:Zr,count:function(t){return t?ve(t).length:0},only:function(t){var e=ve(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:ve},Ta=A.__e;A.__e=function(t,e,n,r){if(t.then){for(var s,i=e;i=i.__;)if((s=i.__c)&&s.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),s.__c(t,e)}Ta(t,e,n,r)};var es=A.unmount;function Ii(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=Ei({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return Ii(r,e,n)})),t}function xi(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return xi(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function mt(){this.__u=0,this.o=null,this.__b=null}function Ai(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Da(t){var e,n,r,s=null;function i(o){if(e||(e=t()).then(function(a){a&&(s=a.default||a),r=!0},function(a){n=a,r=!0}),n)throw n;if(!r)throw e;return s?be(s,o):null}return i.displayName="Lazy",i.__f=!0,i}function Je(){this.i=null,this.l=null}A.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),es&&es(t)},(mt.prototype=new he).__c=function(t,e){var n=e.__c,r=this;r.o==null&&(r.o=[]),r.o.push(n);var s=Ai(r.__v),i=!1,o=function(){i||(i=!0,n.__R=null,s?s(a):a())};n.__R=o;var a=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=xi(c,c.__c.__P,c.__c.__O)}var l;for(r.setState({__a:r.__b=null});l=r.o.pop();)l.forceUpdate()}};r.__u++||32&e.__u||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(o,o)},mt.prototype.componentWillUnmount=function(){this.o=[]},mt.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=Ii(this.__b,n,r.__O=r.__P)}this.__b=null}var s=e.__a&&be(we,null,t.fallback);return s&&(s.__u&=-33),[be(we,null,e.__a?null:t.children),s]};var ts=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function Ra(t){return this.getChildContext=function(){return t.context},t.children}function $a(t){var e=this,n=t.h;if(e.componentWillUnmount=function(){De(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),!e.v){for(var r=e.__v;r!==null&&!r.__m&&r.__!==null;)r=r.__;e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:r.__m},contains:function(){return!0},insertBefore:function(s,i){this.childNodes.push(s),e.h.insertBefore(s,i)},removeChild:function(s){this.childNodes.splice(this.childNodes.indexOf(s)>>>1,1),e.h.removeChild(s)}}}De(be(Ra,{context:e.context},t.__v),e.v)}function La(t,e){var n=be($a,{__v:t,h:e});return n.containerInfo=e,n}(Je.prototype=new he).__a=function(t){var e=this,n=Ai(e.__v),r=e.l.get(t);return r[0]++,function(s){var i=function(){e.props.revealOrder?(r.push(s),ts(e,t,r)):s()};n?n(i):i()}},Je.prototype.render=function(t){this.i=null,this.l=new Map;var e=ve(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},Je.prototype.componentDidUpdate=Je.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){ts(t,n,e)})};var Ni=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Ba=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Ua=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,ja=/[A-Z0-9]/g,Ga=typeof document<"u",Fa=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function qa(t,e,n){return e.__k==null&&(e.textContent=""),De(t,e),typeof n=="function"&&n(),t?t.__c:null}function Va(t,e,n){return Ls(t,e),typeof n=="function"&&n(),t?t.__c:null}he.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(he.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var ns=A.event;function Ha(){}function Wa(){return this.cancelBubble}function za(){return this.defaultPrevented}A.event=function(t){return ns&&(t=ns(t)),t.persist=Ha,t.isPropagationStopped=Wa,t.isDefaultPrevented=za,t.nativeEvent=t};var ir,Ja={enumerable:!1,configurable:!0,get:function(){return this.class}},rs=A.vnode;A.vnode=function(t){typeof t.type=="string"&&(function(e){var n=e.props,r=e.type,s={},i=r.indexOf("-")===-1;for(var o in n){var a=n[o];if(!(o==="value"&&"defaultValue"in n&&a==null||Ga&&o==="children"&&r==="noscript"||o==="class"||o==="className")){var c=o.toLowerCase();o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?o="ondblclick":c!=="onchange"||r!=="input"&&r!=="textarea"||Fa(n.type)?c==="onfocus"?o="onfocusin":c==="onblur"?o="onfocusout":Ua.test(o)&&(o=c):c=o="oninput":i&&Ba.test(o)?o=o.replace(ja,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&s[o=c]&&(o="oninputCapture"),s[o]=a}}r=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=ve(n.children).forEach(function(l){l.props.selected=s.value.indexOf(l.props.value)!=-1})),r=="select"&&s.defaultValue!=null&&(s.value=ve(n.children).forEach(function(l){l.props.selected=s.multiple?s.defaultValue.indexOf(l.props.value)!=-1:s.defaultValue==l.props.value})),n.class&&!n.className?(s.class=n.class,Object.defineProperty(s,"className",Ja)):(n.className&&!n.class||n.class&&n.className)&&(s.class=s.className=n.className),e.props=s})(t),t.$$typeof=Ni,rs&&rs(t)};var ss=A.__r;A.__r=function(t){ss&&ss(t),ir=t.__c};var is=A.diffed;A.diffed=function(t){is&&is(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),ir=null};var Ka={ReactCurrentDispatcher:{current:{readContext:function(t){return ir.__n[t.__c].props.value},useCallback:At,useContext:Zn,useDebugValue:ci,useDeferredValue:Ci,useEffect:Qn,useId:ui,useImperativeHandle:ai,useInsertionEffect:ki,useLayoutEffect:ot,useMemo:pe,useReducer:Xn,useRef:oi,useState:Yn,useSyncExternalStore:Pi,useTransition:Oi}}};function Ya(t){return be.bind(null,t)}function Lt(t){return!!t&&t.$$typeof===Ni}function Xa(t){return Lt(t)&&t.type===we}function Qa(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function Za(t){return Lt(t)?po.apply(null,arguments):t}function ec(t){return!!t.__k&&(De(null,t),!0)}function tc(t){return t&&(t.base||t.nodeType===1&&t)||null}var nc=function(t,e){return t(e)},rc=function(t,e){return t(e)},sc=we,ic=Lt,S={useState:Yn,useId:ui,useReducer:Xn,useEffect:Qn,useLayoutEffect:ot,useInsertionEffect:ki,useTransition:Oi,useDeferredValue:Ci,useSyncExternalStore:Pi,startTransition:Si,useRef:oi,useImperativeHandle:ai,useMemo:pe,useCallback:At,useContext:Zn,useDebugValue:ci,version:"18.3.1",Children:Ma,render:qa,hydrate:Va,unmountComponentAtNode:ec,createPortal:La,createElement:be,createContext:Bs,createFactory:Ya,cloneElement:Za,createRef:co,Fragment:we,isValidElement:Lt,isElement:ic,isFragment:Xa,isMemo:Qa,findDOMNode:tc,Component:he,PureComponent:On,memo:xa,forwardRef:Na,flushSync:rc,unstable_batchedUpdates:nc,StrictMode:sc,Suspense:mt,SuspenseList:Je,lazy:Da,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ka},nn={exports:{}},rn,os;function oc(){if(os)return rn;os=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return rn=t,rn}var sn,as;function ac(){if(as)return sn;as=1;var t=oc();function e(){}function n(){}return n.resetWarningCache=e,sn=function(){function r(o,a,c,l,h,u){if(u!==t){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}r.isRequired=r;function s(){return r}var i={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:s,element:r,elementType:r,instanceOf:s,node:r,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:n,resetWarningCache:e};return i.PropTypes=i,i},sn}var cs;function cc(){return cs||(cs=1,nn.exports=ac()()),nn.exports}var uc=cc();const ue=Fs(uc);var ie={},ft={};var us;function lc(){if(us)return ft;us=1,ft.parse=s,ft.serialize=i;var t=decodeURIComponent,e=encodeURIComponent,n=/; */,r=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function s(a,c){if(typeof a!="string")throw new TypeError("argument str must be a string");for(var l={},h=c||{},u=a.split(n),d=h.decode||t,_=0;_<u.length;_++){var v=u[_],E=v.indexOf("=");if(!(E<0)){var b=v.substr(0,E).trim(),m=v.substr(++E,v.length).trim();m[0]=='"'&&(m=m.slice(1,-1)),l[b]==null&&(l[b]=o(m,d))}}return l}function i(a,c,l){var h=l||{},u=h.encode||e;if(typeof u!="function")throw new TypeError("option encode is invalid");if(!r.test(a))throw new TypeError("argument name is invalid");var d=u(c);if(d&&!r.test(d))throw new TypeError("argument val is invalid");var _=a+"="+d;if(h.maxAge!=null){var v=h.maxAge-0;if(isNaN(v))throw new Error("maxAge should be a Number");_+="; Max-Age="+Math.floor(v)}if(h.domain){if(!r.test(h.domain))throw new TypeError("option domain is invalid");_+="; Domain="+h.domain}if(h.path){if(!r.test(h.path))throw new TypeError("option path is invalid");_+="; Path="+h.path}if(h.expires){if(typeof h.expires.toUTCString!="function")throw new TypeError("option expires is invalid");_+="; Expires="+h.expires.toUTCString()}if(h.httpOnly&&(_+="; HttpOnly"),h.secure&&(_+="; Secure"),h.sameSite){var E=typeof h.sameSite=="string"?h.sameSite.toLowerCase():h.sameSite;switch(E){case!0:_+="; SameSite=Strict";break;case"lax":_+="; SameSite=Lax";break;case"strict":_+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return _}function o(a,c){try{return c(a)}catch{return a}}return ft}var on,ls;function hc(){if(ls)return on;ls=1;var t=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function r(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function s(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var c=Object.getOwnPropertyNames(o).map(function(h){return o[h]});if(c.join("")!=="0123456789")return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach(function(h){l[h]=h}),Object.keys(Object.assign({},l)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return on=s()?Object.assign:function(i,o){for(var a,c=r(i),l,h=1;h<arguments.length;h++){a=Object(arguments[h]);for(var u in a)e.call(a,u)&&(c[u]=a[u]);if(t){l=t(a);for(var d=0;d<l.length;d++)n.call(a,l[d])&&(c[l[d]]=a[l[d]])}}return c},on}var hs;function fc(){if(hs)return ie;hs=1;var t={};Object.defineProperty(ie,"__esModule",{value:!0});var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f};ie.load=u,ie.loadAll=d,ie.select=_,ie.save=v,ie.remove=E,ie.setRawCookie=b,ie.plugToRequest=m;var n=lc(),r=o(n),s=hc(),i=o(s);function o(f){return f&&f.__esModule?f:{default:f}}var a=typeof document>"u"||typeof process<"u"&&t&&!1,c={},l=void 0;function h(){return l&&!l.headersSent}function u(f,g){var P=a?c:r.default.parse(document.cookie),C=P&&P[f];if(typeof g>"u"&&(g=!C||C[0]!=="{"&&C[0]!=="["),!g)try{C=JSON.parse(C)}catch{}return C}function d(f){var g=a?c:r.default.parse(document.cookie),P=g;if(typeof f>"u"&&(f=!P||P[0]!=="{"&&P[0]!=="["),!f)try{P=JSON.parse(P)}catch{}return P}function _(f){var g=a?c:r.default.parse(document.cookie);return g?f?Object.keys(g).reduce(function(P,C){if(!f.test(C))return P;var B={};return B[C]=g[C],(0,i.default)({},P,B)},{}):g:{}}function v(f,g,P){c[f]=g,(typeof g>"u"?"undefined":e(g))==="object"&&(c[f]=JSON.stringify(g)),a||(document.cookie=r.default.serialize(f,c[f],P)),h()&&l.cookie&&l.cookie(f,g,P)}function E(f,g){delete c[f],typeof g>"u"?g={}:typeof g=="string"?g={path:g}:g=(0,i.default)({},g),typeof document<"u"&&(g.expires=new Date(1970,1,1,0,0,1),g.maxAge=0,document.cookie=r.default.serialize(f,"",g)),h()&&l.clearCookie&&l.clearCookie(f,g)}function b(f){f?c=r.default.parse(f):c={}}function m(f,g){return f.cookie?c=f.cookie:f.cookies?c=f.cookies:f.headers&&f.headers.cookie?b(f.headers.cookie):c={},l=g,function(){l=null,c={}}}return ie.default={setRawCookie:b,load:u,loadAll:d,select:_,save:v,remove:E,plugToRequest:m},ie}var dc=fc();const fs=Fs(dc);var Nt;(function(t){t[t.SYNC=0]="SYNC",t[t.ASYNC=1]="ASYNC"})(Nt||(Nt={}));function Ie(t){return t.type()===Nt.SYNC}class pc{type(){return Nt.SYNC}connect(){}createMatch(e,n){if(this.createGame)return console.warn("The database connector does not implement a createMatch method.",`
Using the deprecated createGame method instead.`),this.createGame(e,n);console.error("The database connector does not implement a createMatch method.")}listMatches(e){if(this.listGames)return console.warn("The database connector does not implement a listMatches method.",`
Using the deprecated listGames method instead.`),this.listGames(e);console.error("The database connector does not implement a listMatches method.")}}const _c=({game:t,unlisted:e,setupData:n,numPlayers:r})=>{const s={gameName:t.name,unlisted:!0,players:{},createdAt:Date.now(),updatedAt:Date.now()};for(let i=0;i<r;i++)s.players[i]={id:i};return s},yc=({game:t,numPlayers:e,setupData:n,unlisted:r})=>{(!e||typeof e!="number")&&(e=2);const s=t.validateSetupData&&t.validateSetupData(n,e);if(s!==void 0)return{setupDataError:s};const i=_c({game:t,numPlayers:e,setupData:n,unlisted:r}),o=bi({game:t,numPlayers:e,setupData:n});return{metadata:i,initialState:o}},ds=t=>Object.values(t.players).map(e=>{const{credentials:n,...r}=e;return r}),mc=t=>{const{credentials:e,...n}=t.payload;return{...t,payload:n}};class gc{constructor(e,n,r,s){this.game=$t(e),this.storageAPI=n,this.transportAPI=r,this.subscribeCallback=()=>{},this.auth=s}subscribe(e){this.subscribeCallback=e}async onUpdate(e,n,r,s){if(!e||!e.payload)return{error:"missing action or action payload"};let i;if(Ie(this.storageAPI)?{metadata:i}=this.storageAPI.fetch(r,{metadata:!0}):{metadata:i}=await this.storageAPI.fetch(r,{metadata:!0}),this.auth&&!await this.auth.authenticateCredentials({playerID:s,credentials:e.payload.credentials,metadata:i}))return{error:"unauthorized action"};const o=mc(e),a=r;let c;if(Ie(this.storageAPI)?{state:c}=this.storageAPI.fetch(a,{state:!0}):{state:c}=await this.storageAPI.fetch(a,{state:!0}),c===void 0)return M(`game not found, matchID=[${a}]`),{error:"game not found"};if(c.ctx.gameover!==void 0){M(`game over - matchID=[${a}] - playerID=[${s}] - action[${o.payload.type}]`);return}const l=tr({game:this.game}),h=vi(mi),u=nr(l,c,h);if(o.type==Dt||o.type==Tt){const m=c.ctx.activePlayers!==null,f=c.ctx.currentPlayer===s;if(!m&&!f||m&&(c.ctx.activePlayers[s]===void 0||Object.keys(c.ctx.activePlayers).length>1)){M(`playerID=[${s}] cannot undo / redo right now`);return}}if(!this.game.flow.isPlayerActive(c.G,c.ctx,s)){M(`player not active - playerID=[${s}] - action[${o.payload.type}]`);return}const d=o.type==tt?this.game.flow.getMove(c.ctx,o.payload.type,s):null;if(o.type==tt&&!d){M(`move not processed - canPlayerMakeMove=false - playerID=[${s}] - action[${o.payload.type}]`);return}if(c._stateID!==n&&!(d&&_i(d)&&d.ignoreStaleStateID)){M(`invalid stateID, was=[${n}], expected=[${c._stateID}] - playerID=[${s}] - action[${o.payload.type}]`);return}const _=u.getState();u.dispatch(o),c=u.getState(),this.subscribeCallback({state:c,action:o,matchID:r}),this.game.deltaState?this.transportAPI.sendAll({type:"patch",args:[r,n,_,c]}):this.transportAPI.sendAll({type:"update",args:[r,c]});const{deltalog:v,...E}=c;let b;if(i&&(i.gameover===void 0||i.gameover===null)&&(b={...i,updatedAt:Date.now()},c.ctx.gameover!==void 0&&(b.gameover=c.ctx.gameover)),Ie(this.storageAPI))this.storageAPI.setState(a,E,v),b&&this.storageAPI.setMetadata(a,b);else{const m=[this.storageAPI.setState(a,E,v)];b&&m.push(this.storageAPI.setMetadata(a,b)),await Promise.all(m)}}async onSync(e,n,r,s=2){const i=e,o={state:!0,metadata:!0,log:!0,initialState:!0},a=Ie(this.storageAPI)?this.storageAPI.fetch(i,o):await this.storageAPI.fetch(i,o);let{state:c,initialState:l,log:h,metadata:u}=a;if(this.auth&&n!==void 0&&n!==null&&!await this.auth.authenticateCredentials({playerID:n,credentials:r,metadata:u}))return{error:"unauthorized"};if(c===void 0){const v=yc({game:this.game,unlisted:!0,numPlayers:s,setupData:void 0});if("setupDataError"in v)return{error:"game requires setupData"};l=c=v.initialState,u=v.metadata,this.subscribeCallback({state:c,matchID:e}),Ie(this.storageAPI)?this.storageAPI.createMatch(i,{initialState:l,metadata:u}):await this.storageAPI.createMatch(i,{initialState:l,metadata:u})}const d=u?ds(u):void 0,_={state:c,log:h,filteredMetadata:d,initialState:l};this.transportAPI.send({playerID:n,type:"sync",args:[e,_]})}async onConnectionChange(e,n,r,s){const i=e;if(n==null)return;let o;if(Ie(this.storageAPI)?{metadata:o}=this.storageAPI.fetch(i,{metadata:!0}):{metadata:o}=await this.storageAPI.fetch(i,{metadata:!0}),o===void 0)return M(`metadata not found for matchID=[${i}]`),{error:"metadata not found"};if(o.players[n]===void 0)return M(`Player not in the match, matchID=[${i}] playerID=[${n}]`),{error:"player not in the match"};if(this.auth&&!await this.auth.authenticateCredentials({playerID:n,credentials:r,metadata:o}))return{error:"unauthorized"};o.players[n].isConnected=s;const a=ds(o);this.transportAPI.sendAll({type:"matchData",args:[e,a]}),Ie(this.storageAPI)?this.storageAPI.setMetadata(i,o):await this.storageAPI.setMetadata(i,o)}async onChatMessage(e,n,r){const s=e;if(this.auth){const{metadata:i}=await this.storageAPI.fetch(s,{metadata:!0});if(!(n&&typeof n.sender=="string"))return{error:"unauthorized"};if(!await this.auth.authenticateCredentials({playerID:n.sender,credentials:r,metadata:i}))return{error:"unauthorized"}}this.transportAPI.sendAll({type:"chat",args:[e,n]})}}const dt=(t,e,n)=>({...n,G:t.playerView({G:n.G,ctx:n.ctx,playerID:e}),plugins:ti(n,{playerID:e,game:t}),deltalog:void 0,_undo:[],_redo:[]}),vc=t=>(e,n)=>{switch(n.type){case"patch":{const[r,s,i,o]=n.args,a=an(o.deltalog,e),c=dt(t,e,o),l=o._stateID,h=dt(t,e,i),u=pi.createPatch(h,c);return{type:"patch",args:[r,s,l,u,a]}}case"update":{const[r,s]=n.args,i=an(s.deltalog,e),o=dt(t,e,s);return{type:"update",args:[r,o,i]}}case"sync":{const[r,s]=n.args,i=dt(t,e,s.state),o=an(s.log,e),a={...s,state:i,log:o};return{type:"sync",args:[r,a]}}default:return n}};function an(t,e){return t===void 0?t:t.map(n=>{if(e!==null&&+e==+n.action.payload.playerID||n.redact!==!0)return n;const r={...n.action.payload,args:null},s={...n,action:{...n.action,payload:r}},{redact:i,...o}=s;return o})}const _e=Object.create(null);_e.open="0";_e.close="1";_e.ping="2";_e.pong="3";_e.message="4";_e.upgrade="5";_e.noop="6";const gt=Object.create(null);Object.keys(_e).forEach(t=>{gt[_e[t]]=t});const kn={type:"error",data:"parser error"},Mi=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ti=typeof ArrayBuffer=="function",Di=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,or=({type:t,data:e},n,r)=>Mi&&e instanceof Blob?n?r(e):ps(e,r):Ti&&(e instanceof ArrayBuffer||Di(e))?n?r(e):ps(new Blob([e]),r):r(_e[t]+(e||"")),ps=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+(r||""))},n.readAsDataURL(t)};function _s(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let cn;function bc(t,e){if(Mi&&t.data instanceof Blob)return t.data.arrayBuffer().then(_s).then(e);if(Ti&&(t.data instanceof ArrayBuffer||Di(t.data)))return e(_s(t.data));or(t,!1,n=>{cn||(cn=new TextEncoder),e(cn.encode(n))})}const ys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ke=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<ys.length;t++)Ke[ys.charCodeAt(t)]=t;const wc=t=>{let e=t.length*.75,n=t.length,r,s=0,i,o,a,c;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const l=new ArrayBuffer(e),h=new Uint8Array(l);for(r=0;r<n;r+=4)i=Ke[t.charCodeAt(r)],o=Ke[t.charCodeAt(r+1)],a=Ke[t.charCodeAt(r+2)],c=Ke[t.charCodeAt(r+3)],h[s++]=i<<2|o>>4,h[s++]=(o&15)<<4|a>>2,h[s++]=(a&3)<<6|c&63;return l},Ec=typeof ArrayBuffer=="function",ar=(t,e)=>{if(typeof t!="string")return{type:"message",data:Ri(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:Pc(t.substring(1),e)}:gt[n]?t.length>1?{type:gt[n],data:t.substring(1)}:{type:gt[n]}:kn},Pc=(t,e)=>{if(Ec){const n=wc(t);return Ri(n,e)}else return{base64:!0,data:t}},Ri=(t,e)=>e==="blob"?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,$i="",Sc=(t,e)=>{const n=t.length,r=new Array(n);let s=0;t.forEach((i,o)=>{or(i,!1,a=>{r[o]=a,++s===n&&e(r.join($i))})})},Cc=(t,e)=>{const n=t.split($i),r=[];for(let s=0;s<n.length;s++){const i=ar(n[s],e);if(r.push(i),i.type==="error")break}return r};function Oc(){return new TransformStream({transform(t,e){bc(t,n=>{const r=n.length;let s;if(r<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,r);else if(r<65536){s=new Uint8Array(3);const i=new DataView(s.buffer);i.setUint8(0,126),i.setUint16(1,r)}else{s=new Uint8Array(9);const i=new DataView(s.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(r))}t.data&&typeof t.data!="string"&&(s[0]|=128),e.enqueue(s),e.enqueue(n)})}})}let un;function pt(t){return t.reduce((e,n)=>e+n.length,0)}function _t(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let r=0;for(let s=0;s<e;s++)n[s]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),n}function kc(t,e){un||(un=new TextDecoder);const n=[];let r=0,s=-1,i=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(r===0){if(pt(n)<1)break;const c=_t(n,1);i=(c[0]&128)===128,s=c[0]&127,s<126?r=3:s===126?r=1:r=2}else if(r===1){if(pt(n)<2)break;const c=_t(n,2);s=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(r===2){if(pt(n)<8)break;const c=_t(n,8),l=new DataView(c.buffer,c.byteOffset,c.length),h=l.getUint32(0);if(h>Math.pow(2,21)-1){a.enqueue(kn);break}s=h*Math.pow(2,32)+l.getUint32(4),r=3}else{if(pt(n)<s)break;const c=_t(n,s);a.enqueue(ar(i?c:un.decode(c),e)),r=0}if(s===0||s>t){a.enqueue(kn);break}}}})}const Li=4;function j(t){if(t)return Ic(t)}function Ic(t){for(var e in j.prototype)t[e]=j.prototype[e];return t}j.prototype.on=j.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};j.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};j.prototype.off=j.prototype.removeListener=j.prototype.removeAllListeners=j.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,s=0;s<n.length;s++)if(r=n[s],r===e||r.fn===e){n.splice(s,1);break}return n.length===0&&delete this._callbacks["$"+t],this};j.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,s=n.length;r<s;++r)n[r].apply(this,e)}return this};j.prototype.emitReserved=j.prototype.emit;j.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};j.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Bt=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0),ne=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),xc="arraybuffer";function Bi(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const Ac=ne.setTimeout,Nc=ne.clearTimeout;function Ut(t,e){e.useNativeTimers?(t.setTimeoutFn=Ac.bind(ne),t.clearTimeoutFn=Nc.bind(ne)):(t.setTimeoutFn=ne.setTimeout.bind(ne),t.clearTimeoutFn=ne.clearTimeout.bind(ne))}const Mc=1.33;function Tc(t){return typeof t=="string"?Dc(t):Math.ceil((t.byteLength||t.size)*Mc)}function Dc(t){let e=0,n=0;for(let r=0,s=t.length;r<s;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function Ui(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Rc(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function $c(t){let e={},n=t.split("&");for(let r=0,s=n.length;r<s;r++){let i=n[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}class Lc extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class cr extends j{constructor(e){super(),this.writable=!1,Ut(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,n,r){return super.emitReserved("error",new Lc(e,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=ar(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=Rc(e);return n.length?"?"+n:""}}class Bc extends cr{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Cc(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Sc(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Ui()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}}let ji=!1;try{ji=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Uc=ji;function jc(){}class Gc extends Bc{constructor(e){if(super(e),typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(s,i)=>{this.onError("xhr post error",s,i)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class de extends j{constructor(e,n,r){super(),this.createRequest=e,Ut(this,r),this._opts=r,this._method=r.method||"GET",this._uri=n,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const n=Bi(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(n);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let s in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(s)&&r.setRequestHeader(s,this._opts.extraHeaders[s])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var s;r.readyState===3&&((s=this._opts.cookieJar)===null||s===void 0||s.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(s){this.setTimeoutFn(()=>{this._onError(s)},0);return}typeof document<"u"&&(this._index=de.requestsCount++,de.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=jc,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete de.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}de.requestsCount=0;de.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ms);else if(typeof addEventListener=="function"){const t="onpagehide"in ne?"pagehide":"unload";addEventListener(t,ms,!1)}}function ms(){for(let t in de.requests)de.requests.hasOwnProperty(t)&&de.requests[t].abort()}const Fc=(function(){const t=Gi({xdomain:!1});return t&&t.responseType!==null})();class qc extends Gc{constructor(e){super(e);const n=e&&e.forceBase64;this.supportsBinary=Fc&&!n}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new de(Gi,this.uri(),e)}}function Gi(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Uc))return new XMLHttpRequest}catch{}if(!e)try{return new ne[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Fi=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Vc extends cr{get name(){return"websocket"}doOpen(){const e=this.uri(),n=this.opts.protocols,r=Fi?{}:Bi(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,n,r)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],s=n===e.length-1;or(r,this.supportsBinary,i=>{try{this.doWrite(r,i)}catch{}s&&Bt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Ui()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}}const ln=ne.WebSocket||ne.MozWebSocket;class Hc extends Vc{createSocket(e,n,r){return Fi?new ln(e,n,r):n?new ln(e,n):new ln(e)}doWrite(e,n){this.ws.send(n)}}class Wc extends cr{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const n=kc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(n).getReader(),s=Oc();s.readable.pipeTo(e.writable),this._writer=s.writable.getWriter();const i=()=>{r.read().then(({done:a,value:c})=>{a||(this.onPacket(c),i())}).catch(a=>{})};i();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],s=n===e.length-1;this._writer.write(r).then(()=>{s&&Bt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const zc={websocket:Hc,webtransport:Wc,polling:qc},Jc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Kc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function In(t){if(t.length>8e3)throw"URI too long";const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let s=Jc.exec(t||""),i={},o=14;for(;o--;)i[Kc[o]]=s[o]||"";return n!=-1&&r!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=Yc(i,i.path),i.queryKey=Xc(i,i.query),i}function Yc(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Xc(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,s,i){s&&(n[s]=i)}),n}const xn=typeof addEventListener=="function"&&typeof removeEventListener=="function",vt=[];xn&&addEventListener("offline",()=>{vt.forEach(t=>t())},!1);class Pe extends j{constructor(e,n){if(super(),this.binaryType=xc,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){const r=In(e);n.hostname=r.host,n.secure=r.protocol==="https"||r.protocol==="wss",n.port=r.port,r.query&&(n.query=r.query)}else n.host&&(n.hostname=In(n.host).host);Ut(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(r=>{const s=r.prototype.name;this.transports.push(s),this._transportsByName[s]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=$c(this.opts.query)),xn&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},vt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Li,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Pe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Pe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const s=this.writeBuffer[r].data;if(s&&(n+=Tc(s)),r>0&&n>this._maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Bt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,r){return this._sendPacket("message",e,n,r),this}send(e,n,r){return this._sendPacket("message",e,n,r),this}_sendPacket(e,n,r,s){if(typeof n=="function"&&(s=n,n=void 0),typeof r=="function"&&(s=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:e,data:n,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(Pe.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),xn&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=vt.indexOf(this._offlineEventListener);r!==-1&&vt.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}Pe.protocol=Li;class Qc extends Pe{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let n=this.createTransport(e),r=!1;Pe.priorWebsocketSuccess=!1;const s=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",u=>{if(!r)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Pe.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=n.name,this.emitReserved("upgradeError",d)}}))};function i(){r||(r=!0,h(),n.close(),n=null)}const o=u=>{const d=new Error("probe error: "+u);d.transport=n.name,i(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function c(){o("socket closed")}function l(u){n&&u.name!==n.name&&i()}const h=()=>{n.removeListener("open",s),n.removeListener("error",o),n.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};n.once("open",s),n.once("error",o),n.once("close",a),this.once("close",c),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const n=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}}let Zc=class extends Qc{constructor(e,n={}){const r=typeof e=="object"?e:n;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(s=>zc[s]).filter(s=>!!s)),super(e,r)}};function eu(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=In(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}const tu=typeof ArrayBuffer=="function",nu=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,qi=Object.prototype.toString,ru=typeof Blob=="function"||typeof Blob<"u"&&qi.call(Blob)==="[object BlobConstructor]",su=typeof File=="function"||typeof File<"u"&&qi.call(File)==="[object FileConstructor]";function ur(t){return tu&&(t instanceof ArrayBuffer||nu(t))||ru&&t instanceof Blob||su&&t instanceof File}function bt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(bt(t[n]))return!0;return!1}if(ur(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return bt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&bt(t[n]))return!0;return!1}function iu(t){const e=[],n=t.data,r=t;return r.data=An(n,e),r.attachments=e.length,{packet:r,buffers:e}}function An(t,e){if(!t)return t;if(ur(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=An(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=An(t[r],e));return n}return t}function ou(t,e){return t.data=Nn(t.data,e),delete t.attachments,t}function Nn(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Nn(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Nn(t[n],e));return t}const au=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],cu=5;var N;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(N||(N={}));class uu{constructor(e){this.replacer=e}encode(e){return(e.type===N.EVENT||e.type===N.ACK)&&bt(e)?this.encodeAsBinary({type:e.type===N.EVENT?N.BINARY_EVENT:N.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===N.BINARY_EVENT||e.type===N.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=iu(e),r=this.encodeAsString(n.packet),s=n.buffers;return s.unshift(r),s}}function gs(t){return Object.prototype.toString.call(t)==="[object Object]"}class lr extends j{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const r=n.type===N.BINARY_EVENT;r||n.type===N.BINARY_ACK?(n.type=r?N.EVENT:N.ACK,this.reconstructor=new lu(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(ur(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(N[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===N.BINARY_EVENT||r.type===N.BINARY_ACK){const i=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const o=e.substring(i,n);if(o!=Number(o)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(n+1)==="/"){const i=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(i,n)}else r.nsp="/";const s=e.charAt(n+1);if(s!==""&&Number(s)==s){const i=n+1;for(;++n;){const o=e.charAt(n);if(o==null||Number(o)!=o){--n;break}if(n===e.length)break}r.id=Number(e.substring(i,n+1))}if(e.charAt(++n)){const i=this.tryParse(e.substr(n));if(lr.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case N.CONNECT:return gs(n);case N.DISCONNECT:return n===void 0;case N.CONNECT_ERROR:return typeof n=="string"||gs(n);case N.EVENT:case N.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&au.indexOf(n[0])===-1);case N.ACK:case N.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class lu{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=ou(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const hu=Object.freeze(Object.defineProperty({__proto__:null,Decoder:lr,Encoder:uu,get PacketType(){return N},protocol:cu},Symbol.toStringTag,{value:"Module"}));function oe(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const fu=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Vi extends j{constructor(e,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[oe(e,"open",this.onopen.bind(this)),oe(e,"packet",this.onpacket.bind(this)),oe(e,"error",this.onerror.bind(this)),oe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){var r,s,i;if(fu.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const o={type:N.EVENT,data:n};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const h=this.ids++,u=n.pop();this._registerAckCallback(h,u),o.id=h}const a=(s=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||s===void 0?void 0:s.writable,c=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,n){var r;const s=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(s===void 0){this.acks[e]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);n.call(this,new Error("operation has timed out"))},s),o=(...a)=>{this.io.clearTimeoutFn(i),n.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...n){return new Promise((r,s)=>{const i=(o,a)=>o?s(o):r(a);i.withError=!0,n.push(i),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...i)=>r!==this._queue[0]?void 0:(s!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(s)):(this._queue.shift(),n&&n(null,...i)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:N.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case N.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case N.EVENT:case N.BINARY_EVENT:this.onevent(e);break;case N.ACK:case N.BINARY_ACK:this.onack(e);break;case N.DISCONNECT:this.ondisconnect();break;case N.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let r=!1;return function(...s){r||(r=!0,n.packet({type:N.ACK,id:e,data:s}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(delete this.acks[e.id],n.withError&&e.data.unshift(null),n.apply(this,e.data))}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:N.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function Ge(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Ge.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-n:t+n}return Math.min(t,this.max)|0};Ge.prototype.reset=function(){this.attempts=0};Ge.prototype.setMin=function(t){this.ms=t};Ge.prototype.setMax=function(t){this.max=t};Ge.prototype.setJitter=function(t){this.jitter=t};class Mn extends j{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Ut(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Ge({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const s=n.parser||hu;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Zc(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const s=oe(n,"open",function(){r.onopen(),e&&e()}),i=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=oe(n,"error",i);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{s(),i(new Error("timeout")),n.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(oe(e,"ping",this.onping.bind(this)),oe(e,"data",this.ondata.bind(this)),oe(e,"error",this.onerror.bind(this)),oe(e,"close",this.onclose.bind(this)),oe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){Bt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Vi(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,n){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const We={};function wt(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=eu(t,e.path||"/socket.io"),r=n.source,s=n.id,i=n.path,o=We[s]&&i in We[s].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new Mn(r,e):(We[s]||(We[s]=new Mn(r,e)),c=We[s]),n.query&&!e.query&&(e.query=n.queryKey),c.socket(n.path,e)}Object.assign(wt,{Manager:Mn,Socket:Vi,io:wt,connect:wt});class Hi extends pc{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createMatch(e,n){this.initial.set(e,n.initialState),this.setState(e,n.initialState),this.setMetadata(e,n.metadata)}setMetadata(e,n){this.metadata.set(e,n)}setState(e,n,r){if(r&&r.length>0){const s=this.log.get(e)||[];this.log.set(e,[...s,...r])}this.state.set(e,n)}fetch(e,n){const r={};return n.state&&(r.state=this.state.get(e)),n.metadata&&(r.metadata=this.metadata.get(e)),n.log&&(r.log=this.log.get(e)||[]),n.initialState&&(r.initialState=this.initial.get(e)),r}wipe(e){this.state.delete(e),this.metadata.delete(e)}listMatches(e){return[...this.metadata.entries()].filter(([,n])=>e?!(e.gameName!==void 0&&n.gameName!==e.gameName||e.where!==void 0&&(e.where.isGameover!==void 0&&n.gameover!==void 0!==e.where.isGameover||e.where.updatedBefore!==void 0&&n.updatedAt>=e.where.updatedBefore||e.where.updatedAfter!==void 0&&n.updatedAt<=e.where.updatedAfter)):!0).map(([n])=>n)}}class du extends Map{constructor(e){super(),this.key=e,(JSON.parse(localStorage.getItem(this.key))||[]).forEach(r=>this.set(...r))}sync(){const e=[...this.entries()];localStorage.setItem(this.key,JSON.stringify(e))}set(e,n){return super.set(e,n),this.sync(),this}delete(e){const n=super.delete(e);return this.sync(),n}}class pu extends Hi{constructor(e="bgio"){super();const n=r=>new du(`${e}_${r}`);this.state=n("state"),this.initial=n("initial"),this.metadata=n("metadata"),this.log=n("log")}}function _u(t,e){if(t.ctx.gameover!==void 0)return null;if(t.ctx.activePlayers){for(const n of Object.keys(e))if(n in t.ctx.activePlayers)return n}else if(t.ctx.currentPlayer in e)return t.ctx.currentPlayer;return null}class yu extends gc{constructor({game:e,bots:n,storageKey:r,persist:s}){const i={},o={};if(e&&e.ai&&n)for(const u in n){const d=n[u];o[u]=new d({game:e,enumerate:e.ai.enumerate,seed:e.seed})}const a=({playerID:u,...d})=>{const _=i[u];_!==void 0&&_(c(u,d))},c=vc(e),l={send:a,sendAll:u=>{for(const d in i)a({playerID:d,...u})}},h=s?new pu(r):new Hi;super(e,h,l),this.connect=(u,d)=>{i[u]=d},this.subscribe(({state:u,matchID:d})=>{if(!n)return;const _=_u(u,o);_!==null&&setTimeout(async()=>{const v=await o[_].play(u,_);await this.onUpdate(v.action,u._stateID,d,v.action.payload.playerID)},100)})}}class mu extends rr{constructor({master:e,...n}){super(n),this.master=e}sendChatMessage(e,n){const r=[e,n,this.credentials];this.master.onChatMessage(...r)}sendAction(e,n){this.master.onUpdate(n,e._stateID,this.matchID,this.playerID)}requestSync(){this.master.onSync(this.matchID,this.playerID,this.credentials,this.numPlayers)}connect(){this.setConnectionStatus(!0),this.master.connect(this.playerID,e=>this.notifyClient(e)),this.requestSync()}disconnect(){this.setConnectionStatus(!1)}updateMatchID(e){this.matchID=e,this.connect()}updatePlayerID(e){this.playerID=e,this.connect()}updateCredentials(e){this.credentials=e,this.connect()}}const vs=new Map;function gu({bots:t,persist:e,storageKey:n}={}){return r=>{const{gameKey:s,game:i}=r;let o;const a=vs.get(s);return a&&a.bots===t&&a.storageKey===n&&a.persist===e&&(o=a.master),o||(o=new yu({game:i,bots:t,persist:e,storageKey:n}),vs.set(s,{master:o,bots:t,persist:e,storageKey:n})),new mu({master:o,...r})}}const bs=wt;class vu extends rr{constructor({socket:e,socketOpts:n,server:r,...s}){super(s),this.server=r,this.socket=e,this.socketOpts=n}sendAction(e,n){const r=[n,e._stateID,this.matchID,this.playerID];this.socket.emit("update",...r)}sendChatMessage(e,n){const r=[e,n,this.credentials];this.socket.emit("chat",...r)}connect(){if(!this.socket)if(this.server){let e=this.server;e.search(/^https?:\/\//)==-1&&(e="http://"+this.server),e.slice(-1)!="/"&&(e=e+"/"),this.socket=bs(e+this.gameName,this.socketOpts)}else this.socket=bs("/"+this.gameName,this.socketOpts);this.socket.on("patch",(e,n,r,s,i)=>{this.notifyClient({type:"patch",args:[e,n,r,s,i]})}),this.socket.on("update",(e,n,r)=>{this.notifyClient({type:"update",args:[e,n,r]})}),this.socket.on("sync",(e,n)=>{this.notifyClient({type:"sync",args:[e,n]})}),this.socket.on("matchData",(e,n)=>{this.notifyClient({type:"matchData",args:[e,n]})}),this.socket.on("chat",(e,n)=>{this.notifyClient({type:"chat",args:[e,n]})}),this.socket.on("connect",()=>{this.requestSync(),this.setConnectionStatus(!0)}),this.socket.on("disconnect",()=>{this.setConnectionStatus(!1)})}disconnect(){this.socket.close(),this.socket=null,this.setConnectionStatus(!1)}requestSync(){if(this.socket){const e=[this.matchID,this.playerID,this.credentials,this.numPlayers];this.socket.emit("sync",...e)}}updateMatchID(e){this.matchID=e,this.requestSync()}updatePlayerID(e){this.playerID=e,this.requestSync()}updateCredentials(e){this.credentials=e,this.requestSync()}}function ws({server:t,socketOpts:e}={}){return n=>new vu({server:t,socketOpts:e,...n})}function Wi(t){var e;const{game:n,numPlayers:r,board:s,multiplayer:i,enhancer:o}=t;let{loading:a,debug:c}=t;return a===void 0&&(a=()=>S.createElement("div",{className:"bgio-loading"},"connecting...")),e=class extends S.Component{constructor(h){super(h),c===void 0&&(c=h.debug),this.client=Oa({game:n,debug:c,numPlayers:r,multiplayer:i,matchID:h.matchID,playerID:h.playerID,credentials:h.credentials,enhancer:o})}componentDidMount(){this.unsubscribe=this.client.subscribe(()=>this.forceUpdate()),this.client.start()}componentWillUnmount(){this.client.stop(),this.unsubscribe()}componentDidUpdate(h){this.props.matchID!=h.matchID&&this.client.updateMatchID(this.props.matchID),this.props.playerID!=h.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=h.credentials&&this.client.updateCredentials(this.props.credentials)}render(){const h=this.client.getState();if(h===null)return S.createElement(a);let u=null;return s&&(u=S.createElement(s,{...h,...this.props,isMultiplayer:!!i,moves:this.client.moves,events:this.client.events,matchID:this.client.matchID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,log:this.client.log,matchData:this.client.matchData,sendChatMessage:this.client.sendChatMessage,chatMessages:this.client.chatMessages})),S.createElement("div",{className:"bgio-client"},u)}},e.propTypes={matchID:ue.string,playerID:ue.string,credentials:ue.string,debug:ue.any},e.defaultProps={matchID:"default",playerID:null,credentials:null,debug:!0},e}class bu{constructor({server:e,gameComponents:n,playerName:r,playerCredentials:s}){this.client=new Ia({server:e}),this.gameComponents=n,this.playerName=r||"Visitor",this.playerCredentials=s,this.matches=[]}async refresh(){try{this.matches=[];const e=await this.client.listGames();for(const n of e){if(!this._getGameComponents(n))continue;const{matches:r}=await this.client.listMatches(n);this.matches.push(...r)}}catch(e){throw new Error("failed to retrieve list of matches ("+e+")")}}_getMatchInstance(e){for(const n of this.matches)if(n.matchID===e)return n}_getGameComponents(e){for(const n of this.gameComponents)if(n.game.name===e)return n}_findPlayer(e){for(const n of this.matches)if(n.players.some(r=>r.name===e))return n}async join(e,n,r){try{let s=this._findPlayer(this.playerName);if(s)throw new Error("player has already joined "+s.matchID);if(s=this._getMatchInstance(n),!s)throw new Error("game instance "+n+" not found");const i=await this.client.joinMatch(e,n,{playerID:r,playerName:this.playerName});s.players[Number.parseInt(r)].name=this.playerName,this.playerCredentials=i.playerCredentials}catch(s){throw new Error("failed to join match "+n+" ("+s+")")}}async leave(e,n){try{const r=this._getMatchInstance(n);if(!r)throw new Error("match instance not found");for(const s of r.players)if(s.name===this.playerName){await this.client.leaveMatch(e,n,{playerID:s.id.toString(),credentials:this.playerCredentials}),delete s.name,delete this.playerCredentials;return}throw new Error("player not found in match")}catch(r){throw new Error("failed to leave match "+n+" ("+r+")")}}async disconnect(){const e=this._findPlayer(this.playerName);e&&await this.leave(e.gameName,e.matchID),this.matches=[],this.playerName="Visitor"}async create(e,n){try{const r=this._getGameComponents(e);if(!r)throw new Error("game not found");if(n<r.game.minPlayers||n>r.game.maxPlayers)throw new Error("invalid number of players "+n);await this.client.createMatch(e,{numPlayers:n})}catch(r){throw new Error("failed to create match for "+e+" ("+r+")")}}}function wu(t){return new bu(t)}class zi extends S.Component{constructor(){super(...arguments),this.state={playerName:this.props.playerName,nameErrorMsg:""},this.onClickEnter=()=>{this.state.playerName!==""&&this.props.onEnter(this.state.playerName)},this.onKeyPress=e=>{e.key==="Enter"&&this.onClickEnter()},this.onChangePlayerName=e=>{const n=e.target.value.trim();this.setState({playerName:n,nameErrorMsg:n.length>0?"":"empty player name"})}}render(){return S.createElement("div",null,S.createElement("p",{className:"phase-title"},"Choose a player name:"),S.createElement("input",{type:"text",value:this.state.playerName,onChange:this.onChangePlayerName,onKeyPress:this.onKeyPress}),S.createElement("span",{className:"buttons"},S.createElement("button",{className:"buttons",onClick:this.onClickEnter},"Enter")),S.createElement("br",null),S.createElement("span",{className:"error-msg"},this.state.nameErrorMsg,S.createElement("br",null)))}}zi.defaultProps={playerName:""};class Eu extends S.Component{constructor(){super(...arguments),this._createSeat=e=>e.name||"[free]",this._createButtonJoin=(e,n)=>S.createElement("button",{key:"button-join-"+e.matchID,onClick:()=>this.props.onClickJoin(e.gameName,e.matchID,""+n)},"Join"),this._createButtonLeave=e=>S.createElement("button",{key:"button-leave-"+e.matchID,onClick:()=>this.props.onClickLeave(e.gameName,e.matchID)},"Leave"),this._createButtonPlay=(e,n)=>S.createElement("button",{key:"button-play-"+e.matchID,onClick:()=>this.props.onClickPlay(e.gameName,{matchID:e.matchID,playerID:""+n,numPlayers:e.players.length})},"Play"),this._createButtonSpectate=e=>S.createElement("button",{key:"button-spectate-"+e.matchID,onClick:()=>this.props.onClickPlay(e.gameName,{matchID:e.matchID,numPlayers:e.players.length})},"Spectate"),this._createInstanceButtons=e=>{const n=e.players.find(s=>s.name===this.props.playerName),r=e.players.find(s=>!s.name);return n&&r?this._createButtonLeave(e):r?this._createButtonJoin(e,r.id):n?S.createElement("div",null,[this._createButtonPlay(e,n.id),this._createButtonLeave(e)]):this._createButtonSpectate(e)}}render(){const e=this.props.match;let n="OPEN";return e.players.some(r=>!r.name)||(n="RUNNING"),S.createElement("tr",{key:"line-"+e.matchID},S.createElement("td",{key:"cell-name-"+e.matchID},e.gameName),S.createElement("td",{key:"cell-status-"+e.matchID},n),S.createElement("td",{key:"cell-seats-"+e.matchID},e.players.map(r=>this._createSeat(r)).join(", ")),S.createElement("td",{key:"cell-buttons-"+e.matchID},this._createInstanceButtons(e)))}}class Pu extends S.Component{constructor(e){super(e),this.state={selectedGame:0,numPlayers:2},this._createGameNameOption=(n,r)=>S.createElement("option",{key:"name-option-"+r,value:r},n.game.name),this._createNumPlayersOption=n=>S.createElement("option",{key:"num-option-"+n,value:n},n),this._createNumPlayersRange=n=>Array.from({length:n.maxPlayers+1}).map((r,s)=>s).slice(n.minPlayers),this.onChangeNumPlayers=n=>{this.setState({numPlayers:Number.parseInt(n.target.value)})},this.onChangeSelectedGame=n=>{const r=Number.parseInt(n.target.value);this.setState({selectedGame:r,numPlayers:this.props.games[r].game.minPlayers})},this.onClickCreate=()=>{this.props.createMatch(this.props.games[this.state.selectedGame].game.name,this.state.numPlayers)};for(const n of e.games){const r=n.game;r.minPlayers||(r.minPlayers=1),r.maxPlayers||(r.maxPlayers=4),console.assert(r.maxPlayers>=r.minPlayers)}this.state={selectedGame:0,numPlayers:e.games[0].game.minPlayers}}render(){return S.createElement("div",null,S.createElement("select",{value:this.state.selectedGame,onChange:e=>this.onChangeSelectedGame(e)},this.props.games.map((e,n)=>this._createGameNameOption(e,n))),S.createElement("span",null,"Players:"),S.createElement("select",{value:this.state.numPlayers,onChange:this.onChangeNumPlayers},this._createNumPlayersRange(this.props.games[this.state.selectedGame].game).map(e=>this._createNumPlayersOption(e))),S.createElement("span",{className:"buttons"},S.createElement("button",{onClick:this.onClickCreate},"Create")))}}var X;(function(t){t.ENTER="enter",t.PLAY="play",t.LIST="list"})(X||(X={}));class Ji extends S.Component{constructor(e){super(e),this.state={phase:X.ENTER,playerName:"Visitor",runningMatch:null,errorMsg:"",credentialStore:{}},this._createConnection=n=>{const r=this.state.playerName;this.connection=wu({server:n.lobbyServer,gameComponents:n.gameComponents,playerName:r,playerCredentials:this.state.credentialStore[r]})},this._updateCredentials=(n,r)=>{this.setState(s=>{const i=Object.assign({},s.credentialStore);return i[n]=r,{credentialStore:i}})},this._updateConnection=async()=>{await this.connection.refresh(),this.forceUpdate()},this._enterLobby=n=>{this._startRefreshInterval(),this.setState({playerName:n,phase:X.LIST})},this._exitLobby=async()=>{this._clearRefreshInterval(),await this.connection.disconnect(),this.setState({phase:X.ENTER,errorMsg:""})},this._createMatch=async(n,r)=>{try{await this.connection.create(n,r),await this.connection.refresh(),this.setState({})}catch(s){this.setState({errorMsg:s.message})}},this._joinMatch=async(n,r,s)=>{try{await this.connection.join(n,r,s),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(i){this.setState({errorMsg:i.message})}},this._leaveMatch=async(n,r)=>{try{await this.connection.leave(n,r),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(s){this.setState({errorMsg:s.message})}},this._startMatch=(n,r)=>{const s=this.connection._getGameComponents(n);if(!s){this.setState({errorMsg:"game "+n+" not supported"});return}let i;if(r.numPlayers>1&&(i=this.props.gameServer?ws({server:this.props.gameServer}):ws()),r.numPlayers==1){const c=s.game.maxPlayers,l={};for(let h=1;h<c;h++)l[h+""]=da;i=gu({bots:l})}const a={app:this.props.clientFactory({game:s.game,board:s.board,debug:this.props.debug,multiplayer:i}),matchID:r.matchID,playerID:r.numPlayers>1?r.playerID:"0",credentials:this.connection.playerCredentials};this._clearRefreshInterval(),this.setState({phase:X.PLAY,runningMatch:a})},this._exitMatch=()=>{this._startRefreshInterval(),this.setState({phase:X.LIST,runningMatch:null})},this._getPhaseVisibility=n=>this.state.phase!==n?"hidden":"phase",this.renderMatches=(n,r)=>n.map(s=>{const{matchID:i,gameName:o,players:a}=s;return S.createElement(Eu,{key:"instance-"+i,match:{matchID:i,gameName:o,players:Object.values(a)},playerName:r,onClickJoin:this._joinMatch,onClickLeave:this._leaveMatch,onClickPlay:this._startMatch})}),this._createConnection(this.props)}componentDidMount(){const e=fs.load("lobbyState")||{};e.phase&&e.phase===X.PLAY&&(e.phase=X.LIST),e.phase&&e.phase!==X.ENTER&&this._startRefreshInterval(),this.setState({phase:e.phase||X.ENTER,playerName:e.playerName||"Visitor",credentialStore:e.credentialStore||{}})}componentDidUpdate(e,n){const r=this.state.playerName,s=this.state.credentialStore[r];if(n.phase!==this.state.phase||n.credentialStore[r]!==s||n.playerName!==r){this._createConnection(this.props),this._updateConnection();const i={phase:this.state.phase,playerName:r,credentialStore:this.state.credentialStore};fs.save("lobbyState",i,{path:"/"})}e.refreshInterval!==this.props.refreshInterval&&this._startRefreshInterval()}componentWillUnmount(){this._clearRefreshInterval()}_startRefreshInterval(){this._clearRefreshInterval(),this._currentInterval=setInterval(this._updateConnection,this.props.refreshInterval)}_clearRefreshInterval(){clearInterval(this._currentInterval)}render(){const{gameComponents:e,renderer:n}=this.props,{errorMsg:r,playerName:s,phase:i,runningMatch:o}=this.state;return n?n({errorMsg:r,gameComponents:e,matches:this.connection.matches,phase:i,playerName:s,runningMatch:o,handleEnterLobby:this._enterLobby,handleExitLobby:this._exitLobby,handleCreateMatch:this._createMatch,handleJoinMatch:this._joinMatch,handleLeaveMatch:this._leaveMatch,handleExitMatch:this._exitMatch,handleRefreshMatches:this._updateConnection,handleStartMatch:this._startMatch}):S.createElement("div",{id:"lobby-view",style:{padding:50}},S.createElement("div",{className:this._getPhaseVisibility(X.ENTER)},S.createElement(zi,{key:s,playerName:s,onEnter:this._enterLobby})),S.createElement("div",{className:this._getPhaseVisibility(X.LIST)},S.createElement("p",null,"Welcome, ",s),S.createElement("div",{className:"phase-title",id:"match-creation"},S.createElement("span",null,"Create a match:"),S.createElement(Pu,{games:e,createMatch:this._createMatch})),S.createElement("p",{className:"phase-title"},"Join a match:"),S.createElement("div",{id:"instances"},S.createElement("table",null,S.createElement("tbody",null,this.renderMatches(this.connection.matches,s))),S.createElement("span",{className:"error-msg"},r,S.createElement("br",null))),S.createElement("p",{className:"phase-title"},"Matches that become empty are automatically deleted.")),S.createElement("div",{className:this._getPhaseVisibility(X.PLAY)},o&&S.createElement(o.app,{matchID:o.matchID,playerID:o.playerID,credentials:o.credentials}),S.createElement("div",{className:"buttons",id:"match-exit"},S.createElement("button",{onClick:this._exitMatch},"Exit match"))),S.createElement("div",{className:"buttons",id:"lobby-exit"},S.createElement("button",{onClick:this._exitLobby},"Exit lobby")))}}Ji.propTypes={gameComponents:ue.array.isRequired,lobbyServer:ue.string,gameServer:ue.string,debug:ue.bool,clientFactory:ue.func,refreshInterval:ue.number};Ji.defaultProps={debug:!1,clientFactory:Wi,refreshInterval:2e3};const Su=({triangle:t,fill:e,onClick:n})=>{const r=t.direction==="up"?"#triangle":"#triangle-down";return I("use",{href:r,x:t.col*25,y:t.row*42-100,fill:e,stroke:"#95A5A6",strokeWidth:"0.5","data-selected":"false",onClick:()=>n(t.id)},t.id)},Et={red:"#ff5252",pickedRed:"#ff8a80",blue:"#3d5afe",pickedBlue:"#8c9eff",green:"#00e676",pickedGreen:"#69f0ae",white:"white",grey:"#f5f5f5"},Cu=(t,e,n)=>{const r=["red","blue","green"],s=t.capturedCells[n];if(s!==void 0)return Et[r[s]];const i=["pickedRed","pickedBlue","pickedGreen"],o=parseInt(e.currentPlayer,10),a=i[o];return t.stagedCells.includes(n)?Et[a]:Et.white},Ki=Bs(null),Ou=({children:t,...e})=>{const n=pe(()=>Array.from({length:e.G.boardRows}).flatMap((r,s)=>Array.from({length:e.G.boardCols}).map((i,o)=>ni(s,o,e.G.boardRows,e.G.boardCols))),[]);return I(Ki.Provider,{value:{...e,triangles:n},children:t})},hr=()=>{const t=Zn(Ki);if(!t)throw new Error("useGameContext must be used within a GameProvider");return t},ku=14,Iu=37,xu=[ku,Iu],Au=20,Nu=19,Mu=[Au,Nu],Es=79,Ps=30,Ss=-60,Tu=()=>{const{G:t,ctx:e,moves:n,triangles:r}=hr(),s=pe(()=>si(t.boardRows,t.boardCols),[]),i=At(c=>{s.has(c)||n.pickCell(c)},[]),o=At(c=>s.has(c)?Et.grey:Cu(t,e,c),[t,e]),a=pe(()=>{const c=t.boardRows-2,l=t.boardCols-2,h=Ps,u=Ss,d=l*25+Ps+Es,_=c*42+Ss+Es,v=d-h,E=_-u;return`${h} ${u} ${v} ${E}`},[]);return I("svg",{id:"svgBox",viewBox:a,xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid meet",children:[I("defs",{children:[I("path",{id:"triangle",d:"M31 79 L79 79 L55 37.6 Z"}),I("path",{id:"triangle-down",d:"M31 37.6 L79 37.6 L55 79 Z"})]}),r.filter(c=>!s.has(c.id)).map(c=>I(Su,{triangle:c,fill:o(c.id),onClick:i}))]})},Du=()=>I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3",class:"lucide lucide-check-icon lucide-check",children:I("path",{d:"M20 6 9 17l-5-5"})}),Ru=()=>I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"butt",class:"lucide lucide-undo-icon",children:[I("path",{d:"M 2,4 L 12,22 L 22,4 L 14,4"}),I("path",{d:"M 8,4 L 14,0 L 14,8 Z",strokeWidth:0,fill:"currentColor"})]}),$u=()=>I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-dices-icon lucide-dices",children:[I("rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2"}),I("path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"}),I("path",{d:"M6 18h.01"}),I("path",{d:"M10 14h.01"}),I("path",{d:"M15 6h.01"}),I("path",{d:"M18 9h.01"})]}),Lu=()=>{const{G:t,ctx:e,moves:n}=hr(),r=pe(()=>{const[s,i,o]=Object.values(t.capturedCells).reduce((a,c)=>(a[c]+=1,a),[0,0,0]);return{red:s,blue:i,green:o}},[t.capturedCells]);return I("div",{class:"row",children:[I("div",{className:"counts",children:[I("div",{className:"counter redCount upward",children:r.red}),I("div",{className:"counter blueCount downward",children:r.blue}),I("div",{className:"counter greenCount upward","data-hidden":e.numPlayers===2,children:r.green})]}),e.activePlayers[e.currentPlayer]==="roll"?I("div",{id:"actionBtns",children:I("button",{id:"rollBtn",className:"downward",onClick:n.rollDice,children:I($u,{})})}):null,e.activePlayers[e.currentPlayer]==="pick"?I("div",{id:"actionBtns",children:[I("button",{id:"undoBtn",className:"downward",onClick:n.revertPickCells,children:I(Ru,{})}),I(Bu,{onClick:n.captureCells})]}):null]})},Bu=({onClick:t})=>{const{G:e,ctx:n}=hr(),r=pe(()=>{const i=parseInt(n.currentPlayer,10);return["red","blue","green"][i]},[n.currentPlayer]),s=e.stagedCells.length===e.tries;return I("button",{id:"captureBtn",class:`${r} upward`,onClick:t,disabled:!s,children:s?I(Du,{}):e.tries-e.stagedCells.length})},Uu=t=>{const{boardRows:e,boardCols:n}=t.G;return I(Ou,{...t,children:I("div",{children:[I("header",{children:I(Lu,{})}),I("main",{children:t.ctx.gameover===void 0?I(Tu,{}):I("div",{children:[I("div",{children:I("h4",{children:"THE GAME IS OVER!"})}),I("div",{children:I("h2",{children:["🏆 ",["🟥","🟦","🟩"][t.ctx.gameover?.winner??"-1"]," 👑"]})})]})})]})})},ju=(t,e,n)=>Wi({numPlayers:t,game:ea(e,n),board:Uu}),Gu=()=>{const t=pe(()=>{const e=new URLSearchParams(window.location.search),n=e.get("players")==="3"?3:2,r=e.get("mobile")==="true",[s,i]=r?Mu:xu;return ju(n,s,i)},[window.location.search]);return I(t,{})};De(I(Gu,{}),document.getElementById("app"));
