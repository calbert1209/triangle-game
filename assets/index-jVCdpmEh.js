(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var st,x,Si,Me,_r,Ci,Oi,ki,$n,pn,_n,Ii,et={},Ai=[],oo=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ot=Array.isArray;function le(t,e){for(var n in e)t[n]=e[n];return t}function Ln(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function be(t,e,n){var r,i,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?st.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)o[s]===void 0&&(o[s]=t.defaultProps[s]);return Qe(t,o,r,i,null)}function Qe(t,e,n,r,i){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Si,__i:-1,__u:0};return i==null&&x.vnode!=null&&x.vnode(s),s}function ao(){return{current:null}}function pe(t){return t.children}function he(t,e){this.props=t,this.context=e}function Re(t,e){if(e==null)return t.__?Re(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Re(t):null}function xi(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return xi(t)}}function yn(t){(!t.__d&&(t.__d=!0)&&Me.push(t)&&!Ct.__r++||_r!=x.debounceRendering)&&((_r=x.debounceRendering)||Ci)(Ct)}function Ct(){for(var t,e,n,r,i,s,o,a=1;Me.length;)Me.length>a&&Me.sort(Oi),t=Me.shift(),a=Me.length,t.__d&&(n=void 0,r=void 0,i=(r=(e=t).__v).__e,s=[],o=[],e.__P&&((n=le({},r)).__v=r.__v+1,x.vnode&&x.vnode(n),Bn(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??Re(r),!!(32&r.__u),o),n.__v=r.__v,n.__.__k[n.__i]=n,Ti(s,n,o),r.__e=r.__=null,n.__e!=i&&xi(n)));Ct.__r=0}function Ni(t,e,n,r,i,s,o,a,c,l,h){var u,d,_,v,P,b,m,f=r&&r.__k||Ai,g=e.length;for(c=co(n,e,f,c,g),u=0;u<g;u++)(_=n.__k[u])!=null&&(d=_.__i==-1?et:f[_.__i]||et,_.__i=u,b=Bn(t,_,d,i,s,o,a,c,l,h),v=_.__e,_.ref&&d.ref!=_.ref&&(d.ref&&Un(d.ref,null,_),h.push(_.ref,_.__c||v,_)),P==null&&v!=null&&(P=v),(m=!!(4&_.__u))||d.__k===_.__k?c=Mi(_,c,t,m):typeof _.type=="function"&&b!==void 0?c=b:v&&(c=v.nextSibling),_.__u&=-7);return n.__e=P,c}function co(t,e,n,r,i){var s,o,a,c,l,h=n.length,u=h,d=0;for(t.__k=new Array(i),s=0;s<i;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=t.__k[s]=Qe(null,o,null,null,null):ot(o)?o=t.__k[s]=Qe(pe,{children:o},null,null,null):o.constructor==null&&o.__b>0?o=t.__k[s]=Qe(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):t.__k[s]=o,c=s+d,o.__=t,o.__b=t.__b+1,(l=o.__i=uo(o,n,c,u))!=-1&&(u--,(a=n[l])&&(a.__u|=2)),a==null||a.__v==null?(l==-1&&(i>h?d--:i<h&&d++),typeof o.type!="function"&&(o.__u|=4)):l!=c&&(l==c-1?d--:l==c+1?d++:(l>c?d--:d++,o.__u|=4))):t.__k[s]=null;if(u)for(s=0;s<h;s++)(a=n[s])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=Re(a)),Ri(a,a));return r}function Mi(t,e,n,r){var i,s;if(typeof t.type=="function"){for(i=t.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=t,e=Mi(i[s],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=Re(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function ve(t,e){return e=e||[],t==null||typeof t=="boolean"||(ot(t)?t.some(function(n){ve(n,e)}):e.push(t)),e}function uo(t,e,n,r){var i,s,o,a=t.key,c=t.type,l=e[n],h=l!=null&&(2&l.__u)==0;if(l===null&&a==null||h&&a==l.key&&c==l.type)return n;if(r>(h?1:0)){for(i=n-1,s=n+1;i>=0||s<e.length;)if((l=e[o=i>=0?i--:s++])!=null&&(2&l.__u)==0&&a==l.key&&c==l.type)return o}return-1}function yr(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||oo.test(e)?n:n+"px"}function ht(t,e,n,r,i){var s,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||yr(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||yr(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(ki,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r?n.u=r.u:(n.u=$n,t.addEventListener(e,s?_n:pn,s)):t.removeEventListener(e,s?_n:pn,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function mr(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=$n++;else if(e.t<n.u)return;return n(x.event?x.event(e):e)}}}function Bn(t,e,n,r,i,s,o,a,c,l){var h,u,d,_,v,P,b,m,f,g,E,C,B,q,Y,re,ie,F=e.type;if(e.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),s=[a=e.__e=n.__e]),(h=x.__b)&&h(e);e:if(typeof F=="function")try{if(m=e.props,f="prototype"in F&&F.prototype.render,g=(h=F.contextType)&&r[h.__c],E=h?g?g.props.value:h.__:r,n.__c?b=(u=e.__c=n.__c).__=u.__E:(f?e.__c=u=new F(m,E):(e.__c=u=new he(m,E),u.constructor=F,u.render=ho),g&&g.sub(u),u.state||(u.state={}),u.__n=r,d=u.__d=!0,u.__h=[],u._sb=[]),f&&u.__s==null&&(u.__s=u.state),f&&F.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=le({},u.__s)),le(u.__s,F.getDerivedStateFromProps(m,u.__s))),_=u.props,v=u.state,u.__v=e,d)f&&F.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),f&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(f&&F.getDerivedStateFromProps==null&&m!==_&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(m,E),e.__v==n.__v||!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(m,u.__s,E)===!1){for(e.__v!=n.__v&&(u.props=m,u.state=u.__s,u.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(G){G&&(G.__=e)}),C=0;C<u._sb.length;C++)u.__h.push(u._sb[C]);u._sb=[],u.__h.length&&o.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(m,u.__s,E),f&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(_,v,P)})}if(u.context=E,u.props=m,u.__P=t,u.__e=!1,B=x.__r,q=0,f){for(u.state=u.__s,u.__d=!1,B&&B(e),h=u.render(u.props,u.state,u.context),Y=0;Y<u._sb.length;Y++)u.__h.push(u._sb[Y]);u._sb=[]}else do u.__d=!1,B&&B(e),h=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++q<25);u.state=u.__s,u.getChildContext!=null&&(r=le(le({},r),u.getChildContext())),f&&!d&&u.getSnapshotBeforeUpdate!=null&&(P=u.getSnapshotBeforeUpdate(_,v)),re=h,h!=null&&h.type===pe&&h.key==null&&(re=Di(h.props.children)),a=Ni(t,ot(re)?re:[re],e,n,r,i,s,o,a,c,l),u.base=e.__e,e.__u&=-161,u.__h.length&&o.push(u),b&&(u.__E=u.__=null)}catch(G){if(e.__v=null,c||s!=null)if(G.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else{for(ie=s.length;ie--;)Ln(s[ie]);mn(e)}else e.__e=n.__e,e.__k=n.__k,G.then||mn(e);x.__e(G,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):a=e.__e=lo(n.__e,e,n,r,i,s,o,c,l);return(h=x.diffed)&&h(e),128&e.__u?void 0:a}function mn(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(mn)}function Ti(t,e,n){for(var r=0;r<n.length;r++)Un(n[r],n[++r],n[++r]);x.__c&&x.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(s){s.call(i)})}catch(s){x.__e(s,i.__v)}})}function Di(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:ot(t)?t.map(Di):le({},t)}function lo(t,e,n,r,i,s,o,a,c){var l,h,u,d,_,v,P,b=n.props||et,m=e.props,f=e.type;if(f=="svg"?i="http://www.w3.org/2000/svg":f=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(l=0;l<s.length;l++)if((_=s[l])&&"setAttribute"in _==!!f&&(f?_.localName==f:_.nodeType==3)){t=_,s[l]=null;break}}if(t==null){if(f==null)return document.createTextNode(m);t=document.createElementNS(i,f,m.is&&m),a&&(x.__m&&x.__m(e,s),a=!1),s=null}if(f==null)b===m||a&&t.data==m||(t.data=m);else{if(s=s&&st.call(t.childNodes),!a&&s!=null)for(b={},l=0;l<t.attributes.length;l++)b[(_=t.attributes[l]).name]=_.value;for(l in b)if(_=b[l],l!="children"){if(l=="dangerouslySetInnerHTML")u=_;else if(!(l in m)){if(l=="value"&&"defaultValue"in m||l=="checked"&&"defaultChecked"in m)continue;ht(t,l,null,_,i)}}for(l in m)_=m[l],l=="children"?d=_:l=="dangerouslySetInnerHTML"?h=_:l=="value"?v=_:l=="checked"?P=_:a&&typeof _!="function"||b[l]===_||ht(t,l,_,b[l],i);if(h)a||u&&(h.__html==u.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(u&&(t.innerHTML=""),Ni(e.type=="template"?t.content:t,ot(d)?d:[d],e,n,r,f=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:n.__k&&Re(n,0),a,c),s!=null)for(l=s.length;l--;)Ln(s[l]);a||(l="value",f=="progress"&&v==null?t.removeAttribute("value"):v!=null&&(v!==t[l]||f=="progress"&&!v||f=="option"&&v!=b[l])&&ht(t,l,v,b[l],i),l="checked",P!=null&&P!=t[l]&&ht(t,l,P,b[l],i))}return t}function Un(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(i){x.__e(i,n)}}function Ri(t,e,n){var r,i;if(x.unmount&&x.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||Un(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){x.__e(s,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&Ri(r[i],e,n||typeof t.type!="function");n||Ln(t.__e),t.__c=t.__=t.__e=void 0}function ho(t,e,n){return this.constructor(t,n)}function $e(t,e,n){var r,i,s,o;e==document&&(e=document.documentElement),x.__&&x.__(t,e),i=(r=typeof n=="function")?null:n&&n.__k||e.__k,s=[],o=[],Bn(e,t=(!r&&n||e).__k=be(pe,null,[t]),i||et,et,e.namespaceURI,!r&&n?[n]:i?null:e.firstChild?st.call(e.childNodes):null,s,!r&&n?n:i?i.__e:e.firstChild,r,o),Ti(s,t,o)}function $i(t,e){$e(t,e,$i)}function fo(t,e,n){var r,i,s,o,a=le({},t.props);for(s in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)s=="key"?r=e[s]:s=="ref"?i=e[s]:a[s]=e[s]===void 0&&o!=null?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?st.call(arguments,2):n),Qe(t.type,a,r||t.key,i||t.ref,null)}function po(t){function e(n){var r,i;return this.getChildContext||(r=new Set,(i={})[e.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(s){this.props.value!=s.value&&r.forEach(function(o){o.__e=!0,yn(o)})},this.sub=function(s){r.add(s);var o=s.componentWillUnmount;s.componentWillUnmount=function(){r&&r.delete(s),o&&o.call(s)}}),n.children}return e.__c="__cC"+Ii++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,r){return n.children(r)}).contextType=e,e}st=Ai.slice,x={__e:function(t,e,n,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),o=i.__d),o)return i.__E=i}catch(a){t=a}throw t}},Si=0,he.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=le({},this.state),typeof t=="function"&&(t=t(le({},n),this.props)),t&&le(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),yn(this))},he.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),yn(this))},he.prototype.render=pe,Me=[],Ci=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Oi=function(t,e){return t.__v.__b-e.__v.__b},Ct.__r=0,ki=/(PointerCapture)$|Capture$/i,$n=0,pn=mr(!1),_n=mr(!0),Ii=0;var _o=0;function I(t,e,n,r,i,s){e||(e={});var o,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?o=e[a]:c[a]=e[a];var l={type:t,props:c,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--_o,__i:-1,__u:0,__source:i,__self:s};if(typeof t=="function"&&(o=t.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return x.vnode&&x.vnode(l),l}function ae(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map((function(i){return"'"+i+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Le(t){return!!t&&!!t[Z]}function Te(t){var e;return!!t&&((function(n){if(!n||typeof n!="object")return!1;var r=Object.getPrototypeOf(n);if(r===null)return!0;var i=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===Eo})(t)||Array.isArray(t)||!!t[Cr]||!!(!((e=t.constructor)===null||e===void 0)&&e[Cr])||jn(t)||qn(t))}function tt(t,e,n){n===void 0&&(n=!1),qe(t)===0?(n?Object.keys:Wn)(t).forEach((function(r){n&&typeof r=="symbol"||e(r,t[r],t)})):t.forEach((function(r,i){return e(i,r,t)}))}function qe(t){var e=t[Z];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:jn(t)?2:qn(t)?3:0}function gn(t,e){return qe(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function yo(t,e){return qe(t)===2?t.get(e):t[e]}function Li(t,e,n){var r=qe(t);r===2?t.set(e,n):r===3?t.add(n):t[e]=n}function mo(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function jn(t){return wo&&t instanceof Map}function qn(t){return Po&&t instanceof Set}function Ne(t){return t.o||t.t}function Fn(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=So(t);delete e[Z];for(var n=Wn(e),r=0;r<n.length;r++){var i=n[r],s=e[i];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[i]})}return Object.create(Object.getPrototypeOf(t),e)}function Gn(t,e){return e===void 0&&(e=!1),Vn(t)||Le(t)||!Te(t)||(qe(t)>1&&(t.set=t.add=t.clear=t.delete=go),Object.freeze(t),e&&tt(t,(function(n,r){return Gn(r,!0)}),!0)),t}function go(){ae(2)}function Vn(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function fe(t){var e=Co[t];return e||ae(18,t),e}function gr(){return nt}function Wt(t,e){e&&(fe("Patches"),t.u=[],t.s=[],t.v=e)}function Ot(t){vn(t),t.p.forEach(vo),t.p=null}function vn(t){t===nt&&(nt=t.l)}function vr(t){return nt={p:[],l:nt,h:t,m:!0,_:0}}function vo(t){var e=t[Z];e.i===0||e.i===1?e.j():e.g=!0}function zt(t,e){e._=e.p.length;var n=e.p[0],r=t!==void 0&&t!==n;return e.h.O||fe("ES5").S(e,t,r),r?(n[Z].P&&(Ot(e),ae(4)),Te(t)&&(t=kt(e,t),e.l||It(e,t)),e.u&&fe("Patches").M(n[Z].t,t,e.u,e.s)):t=kt(e,n,[]),Ot(e),e.u&&e.v(e.u,e.s),t!==Bi?t:void 0}function kt(t,e,n){if(Vn(e))return e;var r=e[Z];if(!r)return tt(e,(function(a,c){return br(t,r,e,a,c,n)}),!0),e;if(r.A!==t)return e;if(!r.P)return It(t,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=Fn(r.k):r.o,s=i,o=!1;r.i===3&&(s=new Set(i),i.clear(),o=!0),tt(s,(function(a,c){return br(t,r,i,a,c,n,o)})),It(t,i,!1),n&&t.u&&fe("Patches").N(r,n,t.u,t.s)}return r.o}function br(t,e,n,r,i,s,o){if(Le(i)){var a=kt(t,i,s&&e&&e.i!==3&&!gn(e.R,r)?s.concat(r):void 0);if(Li(n,r,a),!Le(a))return;t.m=!1}else o&&n.add(i);if(Te(i)&&!Vn(i)){if(!t.h.D&&t._<1)return;kt(t,i),e&&e.A.l||It(t,i)}}function It(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&Gn(e,n)}function Jt(t,e){var n=t[Z];return(n?Ne(n):t)[e]}function wr(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Object.getPrototypeOf(n)}}function bn(t){t.P||(t.P=!0,t.l&&bn(t.l))}function Kt(t){t.o||(t.o=Fn(t.t))}function wn(t,e,n){var r=jn(e)?fe("MapSet").F(e,n):qn(e)?fe("MapSet").T(e,n):t.O?(function(i,s){var o=Array.isArray(i),a={i:o?1:0,A:s?s.A:gr(),P:!1,I:!1,R:{},l:s,t:i,k:null,o:null,j:null,C:!1},c=a,l=Pn;o&&(c=[a],l=Ke);var h=Proxy.revocable(c,l),u=h.revoke,d=h.proxy;return a.k=d,a.j=u,d})(e,n):fe("ES5").J(e,n);return(n?n.A:gr()).p.push(r),r}function bo(t){return Le(t)||ae(22,t),(function e(n){if(!Te(n))return n;var r,i=n[Z],s=qe(n);if(i){if(!i.P&&(i.i<4||!fe("ES5").K(i)))return i.t;i.I=!0,r=Pr(n,s),i.I=!1}else r=Pr(n,s);return tt(r,(function(o,a){i&&yo(i.t,o)===a||Li(r,o,e(a))})),s===3?new Set(r):r})(t)}function Pr(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return Fn(t)}var Er,nt,Hn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",wo=typeof Map<"u",Po=typeof Set<"u",Sr=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Bi=Hn?Symbol.for("immer-nothing"):((Er={})["immer-nothing"]=!0,Er),Cr=Hn?Symbol.for("immer-draftable"):"__$immer_draftable",Z=Hn?Symbol.for("immer-state"):"__$immer_state",Eo=""+Object.prototype.constructor,Wn=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,So=Object.getOwnPropertyDescriptors||function(t){var e={};return Wn(t).forEach((function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)})),e},Co={},Pn={get:function(t,e){if(e===Z)return t;var n=Ne(t);if(!gn(n,e))return(function(i,s,o){var a,c=wr(s,o);return c?"value"in c?c.value:(a=c.get)===null||a===void 0?void 0:a.call(i.k):void 0})(t,n,e);var r=n[e];return t.I||!Te(r)?r:r===Jt(t.t,e)?(Kt(t),t.o[e]=wn(t.A.h,r,t)):r},has:function(t,e){return e in Ne(t)},ownKeys:function(t){return Reflect.ownKeys(Ne(t))},set:function(t,e,n){var r=wr(Ne(t),e);if(r?.set)return r.set.call(t.k,n),!0;if(!t.P){var i=Jt(Ne(t),e),s=i?.[Z];if(s&&s.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(mo(n,i)&&(n!==void 0||gn(t.t,e)))return!0;Kt(t),bn(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return Jt(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,Kt(t),bn(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Ne(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty:function(){ae(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){ae(12)}},Ke={};tt(Pn,(function(t,e){Ke[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),Ke.deleteProperty=function(t,e){return Ke.set.call(this,t,e,void 0)},Ke.set=function(t,e,n){return Pn.set.call(this,t[0],e,n,t[0])};var Oo=(function(){function t(n){var r=this;this.O=Sr,this.D=!0,this.produce=function(i,s,o){if(typeof i=="function"&&typeof s!="function"){var a=s;s=i;var c=r;return function(P){var b=this;P===void 0&&(P=a);for(var m=arguments.length,f=Array(m>1?m-1:0),g=1;g<m;g++)f[g-1]=arguments[g];return c.produce(P,(function(E){var C;return(C=s).call.apply(C,[b,E].concat(f))}))}}var l;if(typeof s!="function"&&ae(6),o!==void 0&&typeof o!="function"&&ae(7),Te(i)){var h=vr(r),u=wn(r,i,void 0),d=!0;try{l=s(u),d=!1}finally{d?Ot(h):vn(h)}return typeof Promise<"u"&&l instanceof Promise?l.then((function(P){return Wt(h,o),zt(P,h)}),(function(P){throw Ot(h),P})):(Wt(h,o),zt(l,h))}if(!i||typeof i!="object"){if((l=s(i))===void 0&&(l=i),l===Bi&&(l=void 0),r.D&&Gn(l,!0),o){var _=[],v=[];fe("Patches").M(i,l,_,v),o(_,v)}return l}ae(21,i)},this.produceWithPatches=function(i,s){if(typeof i=="function")return function(l){for(var h=arguments.length,u=Array(h>1?h-1:0),d=1;d<h;d++)u[d-1]=arguments[d];return r.produceWithPatches(l,(function(_){return i.apply(void 0,[_].concat(u))}))};var o,a,c=r.produce(i,s,(function(l,h){o=l,a=h}));return typeof Promise<"u"&&c instanceof Promise?c.then((function(l){return[l,o,a]})):[c,o,a]},typeof n?.useProxies=="boolean"&&this.setUseProxies(n.useProxies),typeof n?.autoFreeze=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Te(n)||ae(8),Le(n)&&(n=bo(n));var r=vr(this),i=wn(this,n,void 0);return i[Z].C=!0,vn(r),i},e.finishDraft=function(n,r){var i=n&&n[Z],s=i.A;return Wt(s,r),zt(void 0,s)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!Sr&&ae(20),this.O=n},e.applyPatches=function(n,r){var i;for(i=r.length-1;i>=0;i--){var s=r[i];if(s.path.length===0&&s.op==="replace"){n=s.value;break}}i>-1&&(r=r.slice(i+1));var o=fe("Patches").$;return Le(n)?o(n,r):this.produce(n,(function(a){return o(a,r)}))},t})(),ee=new Oo,ko=ee.produce;ee.produceWithPatches.bind(ee);ee.setAutoFreeze.bind(ee);ee.setUseProxies.bind(ee);ee.applyPatches.bind(ee);ee.createDraft.bind(ee);ee.finishDraft.bind(ee);class Io{constructor(e){const n=Ao();this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){const e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=Math.trunc(e))}}function Ao(){let t=4022871197;return function(n){const r=n.toString();for(let i=0;i<r.length;i++){t+=r.charCodeAt(i);let s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=s*4294967296}return(t>>>0)*23283064365386963e-26}}function Or(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function Ui(t,e){const n=new Io(t),r=n.next.bind(n);return e&&Or(e,n),r.state=()=>Or(n,{}),r}class kr{constructor(e){this.state=e||{seed:"0"},this.used=!1}static seed(){return Date.now().toString(36).slice(-10)}isUsed(){return this.used}getState(){return this.state}_random(){this.used=!0;const e=this.state,n=e.prngstate?"":e.seed,r=Ui(n,e.prngstate),i=r();return this.state={...e,prngstate:r.state()},i}api(){const e=this._random.bind(this),n={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},r={};for(const s in n){const o=n[s];r[s]=a=>a===void 0?Math.floor(e()*o)+1:Array.from({length:a}).map(()=>Math.floor(e()*o)+1)}function i(s=6,o){return o===void 0?Math.floor(e()*s)+1:Array.from({length:o}).map(()=>Math.floor(e()*s)+1)}return{...r,Die:i,Number:()=>e(),Shuffle:s=>{const o=[...s];let a=s.length,c=0;const l=Array.from({length:a});for(;a;){const h=Math.trunc(a*e());l[c++]=o[h],o[h]=o[--a]}return l},_private:this}}}const xo={name:"random",noClient:({api:t})=>t._private.isUsed(),flush:({api:t})=>t._private.getState(),api:({data:t})=>new kr(t).api(),setup:({game:t})=>{let{seed:e}=t;return e===void 0&&(e=kr.seed()),{seed:e}},playerView:()=>{}};var Ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ji(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Yt,Ar;function No(){if(Ar)return Yt;Ar=1;var t="[object Object]";function e(d){var _=!1;if(d!=null&&typeof d.toString!="function")try{_=!!(d+"")}catch{}return _}function n(d,_){return function(v){return d(_(v))}}var r=Function.prototype,i=Object.prototype,s=r.toString,o=i.hasOwnProperty,a=s.call(Object),c=i.toString,l=n(Object.getPrototypeOf,Object);function h(d){return!!d&&typeof d=="object"}function u(d){if(!h(d)||c.call(d)!=t||e(d))return!1;var _=l(d);if(_===null)return!0;var v=o.call(_,"constructor")&&_.constructor;return typeof v=="function"&&v instanceof v&&s.call(v)==a}return Yt=u,Yt}No();const rt="MAKE_MOVE",Dt="GAME_EVENT",Rt="REDO",zn="RESET",Jn="SYNC",$t="UNDO",Kn="UPDATE",Yn="PATCH",qi="PLUGIN",Lt="STRIP_TRANSIENTS",Fi=(t,e,n,r)=>({type:rt,payload:{type:t,args:e,playerID:n,credentials:r}}),Ze=(t,e,n,r)=>({type:Dt,payload:{type:t,args:e,playerID:n,credentials:r}}),Gi=(t,e,n,r)=>({type:Dt,payload:{type:t,args:e,playerID:n,credentials:r},automatic:!0}),Vi=t=>({type:Jn,state:t.state,log:t.log,initialState:t.initialState,clientOnly:!0}),Hi=(t,e,n,r)=>({type:Yn,prevStateID:t,stateID:e,patch:n,deltalog:r,clientOnly:!0}),Wi=(t,e)=>({type:Kn,state:t,deltalog:e,clientOnly:!0}),zi=t=>({type:zn,state:t,clientOnly:!0}),Ji=(t,e)=>({type:$t,payload:{type:null,args:null,playerID:t,credentials:e}}),Ki=(t,e)=>({type:Rt,payload:{type:null,args:null,playerID:t,credentials:e}}),Mo=(t,e,n,r)=>({type:qi,payload:{type:t,args:e,playerID:n,credentials:r}}),Yi=()=>({type:Lt});var To=Object.freeze({__proto__:null,makeMove:Fi,gameEvent:Ze,automaticGameEvent:Gi,sync:Vi,patch:Hi,update:Wi,reset:zi,undo:Ji,redo:Ki,plugin:Mo,stripTransients:Yi});const Be="INVALID_MOVE",Do={name:"plugin-immer",fnWrap:t=>(e,...n)=>{let r=!1;const i=ko(e.G,s=>{const o=t({...e,G:s},...n);if(o===Be){r=!0;return}return o});return r?Be:i}};var W;(function(t){t.MOVE="MOVE",t.GAME_ON_END="GAME_ON_END",t.PHASE_ON_BEGIN="PHASE_ON_BEGIN",t.PHASE_ON_END="PHASE_ON_END",t.TURN_ON_BEGIN="TURN_ON_BEGIN",t.TURN_ON_MOVE="TURN_ON_MOVE",t.TURN_ON_END="TURN_ON_END"})(W||(W={}));var ge;(function(t){t.CalledOutsideHook="Events must be called from moves or the `onBegin`, `onEnd`, and `onMove` hooks.\nThis error probably means you called an event from other game code, like an `endIf` trigger or one of the `turn.order` methods.",t.EndTurnInOnEnd="`endTurn` is disallowed in `onEnd` hooks — the turn is already ending.",t.MaxTurnEndings=`Maximum number of turn endings exceeded for this update.
This likely means game code is triggering an infinite loop.`,t.PhaseEventInOnEnd="`setPhase` & `endPhase` are disallowed in a phase’s `onEnd` hook — the phase is already ending.\nIf you’re trying to dynamically choose the next phase when a phase ends, use the phase’s `next` trigger.",t.StageEventInOnEnd="`setStage`, `endStage` & `setActivePlayers` are disallowed in `onEnd` hooks.",t.StageEventInPhaseBegin="`setStage`, `endStage` & `setActivePlayers` are disallowed in a phase’s `onBegin` hook.\nUse `setActivePlayers` in a `turn.onBegin` hook or declare stages with `turn.activePlayers` instead.",t.StageEventInTurnBegin="`setStage` & `endStage` are disallowed in `turn.onBegin`.\nUse `setActivePlayers` or declare stages with `turn.activePlayers` instead."})(ge||(ge={}));class Ro{constructor(e,n,r){this.flow=e,this.playerID=r,this.dispatch=[],this.initialTurn=n.turn,this.updateTurnContext(n,void 0),this.maxEndedTurnsPerAction=n.numPlayers*100}api(){const e={_private:this};for(const n of this.flow.eventNames)e[n]=(...r)=>{this.dispatch.push({type:n,args:r,phase:this.currentPhase,turn:this.currentTurn,calledFrom:this.currentMethod,error:new Error("Events Plugin Error")})};return e}isUsed(){return this.dispatch.length>0}updateTurnContext(e,n){this.currentPhase=e.phase,this.currentTurn=e.turn,this.currentMethod=n}unsetCurrentMethod(){this.currentMethod=void 0}update(e){const n=e,r=({stack:i},s)=>({...n,plugins:{...n.plugins,events:{...n.plugins.events,data:{error:s+`
`+i}}}});e:for(let i=0;i<this.dispatch.length;i++){const s=this.dispatch[i],o=s.turn!==e.ctx.turn;if(this.currentTurn-this.initialTurn>=this.maxEndedTurnsPerAction)return r(s.error,ge.MaxTurnEndings);if(s.calledFrom===void 0)return r(s.error,ge.CalledOutsideHook);if(e.ctx.gameover)break e;switch(s.type){case"endStage":case"setStage":case"setActivePlayers":{switch(s.calledFrom){case W.TURN_ON_END:case W.PHASE_ON_END:return r(s.error,ge.StageEventInOnEnd);case W.PHASE_ON_BEGIN:return r(s.error,ge.StageEventInPhaseBegin);case W.TURN_ON_BEGIN:if(s.type==="setActivePlayers")break;return r(s.error,ge.StageEventInTurnBegin)}if(o)continue e;break}case"endTurn":{if(s.calledFrom===W.TURN_ON_END||s.calledFrom===W.PHASE_ON_END)return r(s.error,ge.EndTurnInOnEnd);if(o)continue e;break}case"endPhase":case"setPhase":{if(s.calledFrom===W.PHASE_ON_END)return r(s.error,ge.PhaseEventInOnEnd);if(s.phase!==e.ctx.phase)continue e;break}}const c=Gi(s.type,s.args,this.playerID);e=this.flow.processEvent(e,c)}return e}}const Xn={name:"events",noClient:({api:t})=>t._private.isUsed(),isInvalid:({data:t})=>t.error||!1,fnWrap:(t,e)=>(n,...r)=>{const i=n.events;i&&i._private.updateTurnContext(n.ctx,e);const s=t(n,...r);return i&&i._private.unsetCurrentMethod(),s},dangerouslyFlushRawState:({state:t,api:e})=>e._private.update(t),api:({game:t,ctx:e,playerID:n})=>new Ro(t.flow,e,n).api()},$o={name:"log",flush:()=>({}),api:({data:t})=>({setMetadata:e=>{t.metadata=e}}),setup:()=>({})},Lo={name:"plugin-serializable",fnWrap:t=>(e,...n)=>t(e,...n)},Bo=(...t)=>console.error(...t);function M(t){Bo("ERROR:",t)}const Qn=[Do,xo,$o,Lo],at=[...Qn,Xn],Uo=(t,e,n)=>(n.game.plugins.filter(r=>r.action!==void 0).filter(r=>r.name===e.payload.type).forEach(r=>{const i=r.name,s=t.plugins[i]||{data:{}},o=r.action(s.data,e.payload);t={...t,plugins:{...t.plugins,[i]:{...s,data:o}}}}),t),Ue=({plugins:t})=>Object.entries(t||{}).reduce((e,[n,{api:r}])=>(e[n]=r,e),{}),Xi=(t,e,n)=>[...Qn,...n,Xn].filter(r=>r.fnWrap!==void 0).reduce((r,{fnWrap:i})=>i(r,e),t),jo=(t,e)=>([...at,...e.game.plugins].filter(n=>n.setup!==void 0).forEach(n=>{const r=n.name,i=n.setup({G:t.G,ctx:t.ctx,game:e.game});t={...t,plugins:{...t.plugins,[r]:{data:i}}}}),t),En=(t,e)=>([...at,...e.game.plugins].filter(n=>n.api!==void 0).forEach(n=>{const r=n.name,i=t.plugins[r]||{data:{}},s=n.api({G:t.G,ctx:t.ctx,data:i.data,game:e.game,playerID:e.playerID});t={...t,plugins:{...t.plugins,[r]:{...i,api:s}}}}),t),qo=(t,e)=>([...Qn,...e.game.plugins,Xn].reverse().forEach(n=>{const r=n.name,i=t.plugins[r]||{data:{}};if(n.flush){const s=n.flush({G:t.G,ctx:t.ctx,game:e.game,api:i.api,data:i.data});t={...t,plugins:{...t.plugins,[n.name]:{data:s}}}}else if(n.dangerouslyFlushRawState){t=n.dangerouslyFlushRawState({state:t,game:e.game,api:i.api,data:i.data});const s=t.plugins[r].data;t={...t,plugins:{...t.plugins,[n.name]:{data:s}}}}}),t),Fo=(t,e)=>[...at,...e.game.plugins].filter(n=>n.noClient!==void 0).map(n=>{const r=n.name,i=t.plugins[r];return i?n.noClient({G:t.G,ctx:t.ctx,game:e.game,api:i.api,data:i.data}):!1}).includes(!0),Go=(t,e)=>[...at,...e.game.plugins].filter(r=>r.isInvalid!==void 0).map(r=>{const{name:i}=r,s=t.plugins[i],o=r.isInvalid({G:t.G,ctx:t.ctx,game:e.game,data:s&&s.data});return o?{plugin:i,message:o}:!1}).find(r=>r)||!1,Qi=(t,e)=>{const n=qo(t,e),r=Go(n,e);if(!r)return[n];const{plugin:i,message:s}=r;return M(`${i} plugin declared action invalid:
${s}`),[t,r]},Zi=({G:t,ctx:e,plugins:n={}},{game:r,playerID:i})=>([...at,...r.plugins].forEach(({name:s,playerView:o})=>{if(!o)return;const{data:a}=n[s]||{data:{}},c=o({G:t,ctx:e,game:r,data:a,playerID:i});n={...n,[s]:{data:c}}}),n);function At(t,e=!1){t.moveLimit&&(e&&(t.minMoves=t.moveLimit),t.maxMoves=t.moveLimit,delete t.moveLimit)}function xt(t,e){let n={},r=[],i=null,s={},o={};if(Array.isArray(e)){const c={};e.forEach(l=>c[l]=Nt.NULL),n=c}else{if(At(e),e.next&&(i=e.next),e.revert&&(r=[...t._prevActivePlayers,{activePlayers:t.activePlayers,_activePlayersMinMoves:t._activePlayersMinMoves,_activePlayersMaxMoves:t._activePlayersMaxMoves,_activePlayersNumMoves:t._activePlayersNumMoves}]),e.currentPlayer!==void 0&&ft(n,s,o,t.currentPlayer,e.currentPlayer),e.others!==void 0)for(let c=0;c<t.playOrder.length;c++){const l=t.playOrder[c];l!==t.currentPlayer&&ft(n,s,o,l,e.others)}if(e.all!==void 0)for(let c=0;c<t.playOrder.length;c++){const l=t.playOrder[c];ft(n,s,o,l,e.all)}if(e.value)for(const c in e.value)ft(n,s,o,c,e.value[c]);if(e.minMoves)for(const c in n)s[c]===void 0&&(s[c]=e.minMoves);if(e.maxMoves)for(const c in n)o[c]===void 0&&(o[c]=e.maxMoves)}Object.keys(n).length===0&&(n=null),Object.keys(s).length===0&&(s=null),Object.keys(o).length===0&&(o=null);const a={};for(const c in n)a[c]=0;return{...t,activePlayers:n,_activePlayersMinMoves:s,_activePlayersMaxMoves:o,_activePlayersNumMoves:a,_prevActivePlayers:r,_nextActivePlayers:i}}function Vo(t){let{activePlayers:e,_activePlayersMinMoves:n,_activePlayersMaxMoves:r,_activePlayersNumMoves:i,_prevActivePlayers:s,_nextActivePlayers:o}=t;if(e&&Object.keys(e).length===0)if(o)t=xt(t,o),{activePlayers:e,_activePlayersMinMoves:n,_activePlayersMaxMoves:r,_activePlayersNumMoves:i,_prevActivePlayers:s}=t;else if(s.length>0){const a=s.length-1;({activePlayers:e,_activePlayersMinMoves:n,_activePlayersMaxMoves:r,_activePlayersNumMoves:i}=s[a]),s=s.slice(0,a)}else e=null,n=null,r=null;return{...t,activePlayers:e,_activePlayersMinMoves:n,_activePlayersMaxMoves:r,_activePlayersNumMoves:i,_prevActivePlayers:s}}function ft(t,e,n,r,i){(typeof i!="object"||i===Nt.NULL)&&(i={stage:i}),i.stage!==void 0&&(At(i),t[r]=i.stage,i.minMoves&&(e[r]=i.minMoves),i.maxMoves&&(n[r]=i.maxMoves))}function Sn(t,e){return t[e]+""}function Ho(t,e){let{G:n,ctx:r}=t;const{numPlayers:i}=r,o={...Ue(t),G:n,ctx:r},a=e.order;let c=[...Array.from({length:i})].map((d,_)=>_+"");a.playOrder!==void 0&&(c=a.playOrder(o));const l=a.first(o),h=typeof l;h!=="number"&&M(`invalid value returned by turn.order.first — expected number got ${h} “${l}”.`);const u=Sn(c,l);return r={...r,currentPlayer:u,playOrderPos:l,playOrder:c},r=xt(r,e.activePlayers||{}),r}function Wo(t,e,n,r){const i=n.order;let{G:s,ctx:o}=t,a=o.playOrderPos,c=!1;if(r&&r!==!0)typeof r!="object"&&M(`invalid argument to endTurn: ${r}`),Object.keys(r).forEach(l=>{switch(l){case"remove":e=Sn(o.playOrder,a);break;case"next":a=o.playOrder.indexOf(r.next),e=r.next;break;default:M(`invalid argument to endTurn: ${l}`)}});else{const h={...Ue(t),G:s,ctx:o},u=i.next(h),d=typeof u;u!==void 0&&d!=="number"&&M(`invalid value returned by turn.order.next — expected number or undefined got ${d} “${u}”.`),u===void 0?c=!0:(a=u,e=Sn(o.playOrder,a))}return o={...o,playOrderPos:a,currentPlayer:e},{endPhase:c,ctx:o}}const zo={DEFAULT:{first:({ctx:t})=>t.turn===0?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:({ctx:t})=>(t.playOrderPos+1)%t.playOrder.length}},Nt={NULL:null},we=14,Pe=37,Jo=t=>{const[,e,n]=t.split("-");return[e,n].map(r=>parseInt(r,10))},es=(t,e,n=we,r=Pe)=>{const i=(e+t)%2===0?"up":"down",s=`t-${t}-${e}`,o=(i==="down"?[[t-1,e],[t,e-1],[t,e+1]]:[[t+1,e],[t,e-1],[t,e+1]]).filter(([a,c])=>a>=0&&a<n&&c>=0&&c<r).map(([a,c])=>`t-${a}-${c}`);return{row:t,col:e,direction:i,id:s,neighborIds:o}},Ko=(t,e=we,n=Pe)=>{const[r,i]=Jo(t);return es(r,i,e,n)},ts=(t,e=we,n=Pe)=>{for(let r=0;r<e;r++)for(let i=0;i<n;i++)t(r,i)},ns=(t=we,e=Pe)=>{const n=new Set;return ts((r,i)=>{if(r===0||r===t-1||i===0||i===e-1){const s=`t-${r}-${i}`;n.add(s)}},t,e),n},Yo=(t,e,n=we,r=Pe)=>{const i=new Set,s=new Set,o=ns(n,r),a=Object.entries(t).filter(([l,h])=>h!==e).map(([l,h])=>l),c=Array.from([...o,...a]);for(;c.length>0;){const l=c.shift();if(s.has(l)||(s.add(l),t[l]===e))continue;i.add(l);const u=Ko(l,n,r);for(const d of u.neighborIds){if(s.has(d))continue;t[d]!==e&&(i.add(d),c.push(d))}}return i},Xo=(t,e,n=we,r=Pe)=>{const i=Yo(t,e,n,r),s=new Set;return ts((o,a)=>{const c=`t-${o}-${a}`;!i.has(c)&&t[c]===void 0&&s.add(c)},n,r),s},xr=({G:t,events:e})=>{t.tries=Math.floor(Math.random()*6)+1,e.endStage()},Nr=({G:t,ctx:e},n)=>{const r=t.stagedCells.includes(n);if(t.stagedCells.length>=t.tries&&!r||t.capturedCells[n]!==void 0)return Be;const i=parseInt(e.currentPlayer,10);r?t.stagedCells=t.stagedCells.filter(o=>o!==n):t.stagedCells.push(n);const s=Object.fromEntries(t.stagedCells.map(o=>[o,i]));t.fillableGroup=[...Xo({...t.capturedCells,...s},i)]},Mr=({G:t})=>{t.stagedCells=[],t.fillableGroup=[]},Tr=({G:t,ctx:e,events:n})=>{if(t.stagedCells.length!==t.tries)return Be;const r=parseInt(e.currentPlayer,10);for(;t.stagedCells.length>0;){const i=t.stagedCells.pop();t.capturedCells[i]=r}for(;t.fillableGroup.length>0;){const i=t.fillableGroup.pop();t.capturedCells[i]=r}n.endTurn()},Qo=({capturedCells:t,stagedCells:e,currentPlayer:n})=>{const r={0:0,1:0,2:0};for(const i of Object.values(t))i in r&&(r[i]+=1);return n in r&&(r[n]+=e.length),Object.entries(r).sort(([i,s],[o,a])=>a-s)},Zo=({numPlayers:t,...e})=>{const[n,r,i]=Qo(e),s=Object.fromEntries([n,r,i]);return n[1]===r[1]?{winner:-1,scores:s}:{winner:parseInt(n[0],10),scores:s}},rs={setup:()=>({capturedCells:{},tries:0,stagedCells:[],fillableGroup:[]}),minPlayers:2,maxPlayers:3,moves:{rollDice:xr,pickCell:Nr,revertPickCells:Mr,captureCells:Tr},endIf:({G:t,ctx:e})=>{const{capturedCells:n,stagedCells:r,fillableGroup:i}=t,s=Object.keys(n).length;if((we-2)*(Pe-2)>s+r.length+i.length)return;const{currentPlayer:a,numPlayers:c}=e,l=Zo({capturedCells:n,stagedCells:[...r,...i],currentPlayer:a,numPlayers:c});return l.winner===-1?{draw:!0}:{winner:l.winner.toString()}},onEnd:({G:t,ctx:e})=>{const n=parseInt(e.currentPlayer,10);for(;t.stagedCells.length>0;){const r=t.stagedCells.pop();t.capturedCells[r]=n}for(;t.fillableGroup.length>0;){const r=t.fillableGroup.pop();t.capturedCells[r]=n}},turn:{activePlayers:{currentPlayer:"roll"},stages:{roll:{moves:{rollDice:xr},next:"pick"},pick:{moves:{pickCell:Nr,captureCells:Tr,revertPickCells:Mr}}}}};var Ce,R,Xt,Dr,je=0,is=[],$=x,Rr=$.__b,$r=$.__r,Lr=$.diffed,Br=$.__c,Ur=$.unmount,jr=$.__;function Fe(t,e){$.__h&&$.__h(R,t,je||e),je=0;var n=R.__H||(R.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Zn(t){return je=1,er(ls,t)}function er(t,e,n){var r=Fe(Ce++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):ls(void 0,e),function(a){var c=r.__N?r.__N[0]:r.__[0],l=r.t(c,a);c!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=R,!R.__f)){var i=function(a,c,l){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(d){return!!d.__c});if(h.every(function(d){return!d.__N}))return!s||s.call(this,a,c,l);var u=r.__c.props!==a;return h.forEach(function(d){if(d.__N){var _=d.__[0];d.__=d.__N,d.__N=void 0,_!==d.__[0]&&(u=!0)}}),s&&s.call(this,a,c,l)||u};R.__f=!0;var s=R.shouldComponentUpdate,o=R.componentWillUpdate;R.componentWillUpdate=function(a,c,l){if(this.__e){var h=s;s=void 0,i(a,c,l),s=h}o&&o.call(this,a,c,l)},R.shouldComponentUpdate=i}return r.__N||r.__}function tr(t,e){var n=Fe(Ce++,3);!$.__s&&nr(n.__H,e)&&(n.__=t,n.u=e,R.__H.__h.push(n))}function ct(t,e){var n=Fe(Ce++,4);!$.__s&&nr(n.__H,e)&&(n.__=t,n.u=e,R.__h.push(n))}function ss(t){return je=5,Oe(function(){return{current:t}},[])}function os(t,e,n){je=6,ct(function(){if(typeof t=="function"){var r=t(e());return function(){t(null),r&&typeof r=="function"&&r()}}if(t)return t.current=e(),function(){return t.current=null}},n==null?n:n.concat(t))}function Oe(t,e){var n=Fe(Ce++,7);return nr(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Mt(t,e){return je=8,Oe(function(){return t},e)}function as(t){var e=R.context[t.__c],n=Fe(Ce++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(R)),e.props.value):t.__}function cs(t,e){$.useDebugValue&&$.useDebugValue(e?e(t):t)}function us(){var t=Fe(Ce++,11);if(!t.__){for(var e=R.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function ea(){for(var t;t=is.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(gt),t.__H.__h.forEach(Cn),t.__H.__h=[]}catch(e){t.__H.__h=[],$.__e(e,t.__v)}}$.__b=function(t){R=null,Rr&&Rr(t)},$.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),jr&&jr(t,e)},$.__r=function(t){$r&&$r(t),Ce=0;var e=(R=t.__c).__H;e&&(Xt===R?(e.__h=[],R.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(gt),e.__h.forEach(Cn),e.__h=[],Ce=0)),Xt=R},$.diffed=function(t){Lr&&Lr(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(is.push(e)!==1&&Dr===$.requestAnimationFrame||((Dr=$.requestAnimationFrame)||ta)(ea)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Xt=R=null},$.__c=function(t,e){e.some(function(n){try{n.__h.forEach(gt),n.__h=n.__h.filter(function(r){return!r.__||Cn(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],$.__e(r,n.__v)}}),Br&&Br(t,e)},$.unmount=function(t){Ur&&Ur(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{gt(r)}catch(i){e=i}}),n.__H=void 0,e&&$.__e(e,n.__v))};var qr=typeof requestAnimationFrame=="function";function ta(t){var e,n=function(){clearTimeout(r),qr&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);qr&&(e=requestAnimationFrame(n))}function gt(t){var e=R,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),R=e}function Cn(t){var e=R;t.__c=t.__(),R=e}function nr(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function ls(t,e){return typeof e=="function"?e(t):e}let na="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",ra=(t=21)=>{let e="",n=t|0;for(;n--;)e+=na[Math.random()*64|0];return e};var Qt={},me={},Fr;function hs(){if(Fr)return me;Fr=1,Object.defineProperty(me,"__esModule",{value:!0}),me.Pointer=me.escapeToken=me.unescapeToken=void 0;function t(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}me.unescapeToken=t;function e(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}me.escapeToken=e;var n=(function(){function r(i){i===void 0&&(i=[""]),this.tokens=i}return r.fromJSON=function(i){var s=i.split("/").map(t);if(s[0]!=="")throw new Error("Invalid JSON Pointer: ".concat(i));return new r(s)},r.prototype.toString=function(){return this.tokens.map(e).join("/")},r.prototype.evaluate=function(i){for(var s=null,o="",a=i,c=1,l=this.tokens.length;c<l;c++)s=a,o=this.tokens[c],!(o=="__proto__"||o=="constructor"||o=="prototype")&&(a=(s||{})[o]);return{parent:s,key:o,value:a}},r.prototype.get=function(i){return this.evaluate(i).value},r.prototype.set=function(i,s){var o=this.evaluate(i);o.parent&&(o.parent[o.key]=s)},r.prototype.push=function(i){this.tokens.push(i)},r.prototype.add=function(i){var s=this.tokens.concat(String(i));return new r(s)},r})();return me.Pointer=n,me}var D={},Zt={},Gr;function fs(){return Gr||(Gr=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.clone=t.objectType=t.hasOwnProperty=void 0,t.hasOwnProperty=Object.prototype.hasOwnProperty;function e(i){return i===void 0?"undefined":i===null?"null":Array.isArray(i)?"array":typeof i}t.objectType=e;function n(i){return i!=null&&typeof i=="object"}function r(i){if(!n(i))return i;if(i.constructor==Array){for(var s=i.length,o=new Array(s),a=0;a<s;a++)o[a]=r(i[a]);return o}if(i.constructor==Date){var c=new Date(+i);return c}var l={};for(var h in i)t.hasOwnProperty.call(i,h)&&(l[h]=r(i[h]));return l}t.clone=r})(Zt)),Zt}var J={},Vr;function ds(){if(Vr)return J;Vr=1,Object.defineProperty(J,"__esModule",{value:!0}),J.diffAny=J.diffObjects=J.diffArrays=J.intersection=J.subtract=J.isDestructive=void 0;var t=fs();function e(h){var u=h.op;return u==="remove"||u==="replace"||u==="copy"||u==="move"}J.isDestructive=e;function n(h,u){var d={};for(var _ in h)t.hasOwnProperty.call(h,_)&&h[_]!==void 0&&(d[_]=1);for(var v in u)t.hasOwnProperty.call(u,v)&&u[v]!==void 0&&delete d[v];return Object.keys(d)}J.subtract=n;function r(h){for(var u=h.length,d={},_=0;_<u;_++){var v=h[_];for(var P in v)t.hasOwnProperty.call(v,P)&&v[P]!==void 0&&(d[P]=(d[P]||0)+1)}for(var P in d)d[P]<u&&delete d[P];return Object.keys(d)}J.intersection=r;function i(h){return h.op==="add"}function s(h){return h.op==="remove"}function o(h,u){return{operations:h.operations.concat(u),cost:h.cost+1}}function a(h,u,d,_){_===void 0&&(_=l);var v={"0,0":{operations:[],cost:0}};function P(E,C){var B="".concat(E,",").concat(C),q=v[B];if(q===void 0){if(E>0&&C>0&&!_(h[E-1],u[C-1],d.add(String(E-1))).length)q=P(E-1,C-1);else{var Y=[];if(E>0){var re=P(E-1,C),ie={op:"remove",index:E-1};Y.push(o(re,ie))}if(C>0){var F=P(E,C-1),G={op:"add",index:E-1,value:u[C-1]};Y.push(o(F,G))}if(E>0&&C>0){var De=P(E-1,C-1),Ve={op:"replace",index:E-1,original:h[E-1],value:u[C-1]};Y.push(o(De,Ve))}var ut=Y.sort(function(Ft,Gt){return Ft.cost-Gt.cost})[0];q=ut}v[B]=q}return q}var b=isNaN(h.length)||h.length<=0?0:h.length,m=isNaN(u.length)||u.length<=0?0:u.length,f=P(b,m).operations,g=f.reduce(function(E,C){var B=E[0],q=E[1];if(i(C)){var Y=C.index+1+q,re=Y<b+q?String(Y):"-",ie={op:C.op,path:d.add(re).toString(),value:C.value};return[B.concat(ie),q+1]}else if(s(C)){var ie={op:C.op,path:d.add(String(C.index+q)).toString()};return[B.concat(ie),q-1]}else{var F=d.add(String(C.index+q)),G=_(C.original,C.value,F);return[B.concat.apply(B,G),q]}},[[],0])[0];return g}J.diffArrays=a;function c(h,u,d,_){_===void 0&&(_=l);var v=[];return n(h,u).forEach(function(P){v.push({op:"remove",path:d.add(P).toString()})}),n(u,h).forEach(function(P){v.push({op:"add",path:d.add(P).toString(),value:u[P]})}),r([h,u]).forEach(function(P){v.push.apply(v,_(h[P],u[P],d.add(P)))}),v}J.diffObjects=c;function l(h,u,d,_){if(_===void 0&&(_=l),h===u)return[];var v=(0,t.objectType)(h),P=(0,t.objectType)(u);return v=="array"&&P=="array"?a(h,u,d,_):v=="object"&&P=="object"?c(h,u,d,_):[{op:"replace",path:d.toString(),value:u}]}return J.diffAny=l,J}var Hr;function ia(){if(Hr)return D;Hr=1;var t=D&&D.__extends||(function(){var b=function(m,f){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,E){g.__proto__=E}||function(g,E){for(var C in E)Object.prototype.hasOwnProperty.call(E,C)&&(g[C]=E[C])},b(m,f)};return function(m,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");b(m,f);function g(){this.constructor=m}m.prototype=f===null?Object.create(f):(g.prototype=f.prototype,new g)}})();Object.defineProperty(D,"__esModule",{value:!0}),D.apply=D.InvalidOperationError=D.test=D.copy=D.move=D.replace=D.remove=D.add=D.TestError=D.MissingError=void 0;var e=hs(),n=fs(),r=ds(),i=(function(b){t(m,b);function m(f){var g=b.call(this,"Value required at path: ".concat(f))||this;return g.path=f,g.name="MissingError",g}return m})(Error);D.MissingError=i;var s=(function(b){t(m,b);function m(f,g){var E=b.call(this,"Test failed: ".concat(f," != ").concat(g))||this;return E.actual=f,E.expected=g,E.name="TestError",E}return m})(Error);D.TestError=s;function o(b,m,f){if(Array.isArray(b))if(m=="-")b.push(f);else{var g=parseInt(m,10);b.splice(g,0,f)}else b[m]=f}function a(b,m){if(Array.isArray(b)){var f=parseInt(m,10);b.splice(f,1)}else delete b[m]}function c(b,m){var f=e.Pointer.fromJSON(m.path).evaluate(b);return f.parent===void 0?new i(m.path):(o(f.parent,f.key,(0,n.clone)(m.value)),null)}D.add=c;function l(b,m){var f=e.Pointer.fromJSON(m.path).evaluate(b);return f.value===void 0?new i(m.path):(a(f.parent,f.key),null)}D.remove=l;function h(b,m){var f=e.Pointer.fromJSON(m.path).evaluate(b);if(f.parent===null)return new i(m.path);if(Array.isArray(f.parent)){if(parseInt(f.key,10)>=f.parent.length)return new i(m.path)}else if(f.value===void 0)return new i(m.path);return f.parent[f.key]=(0,n.clone)(m.value),null}D.replace=h;function u(b,m){var f=e.Pointer.fromJSON(m.from).evaluate(b);if(f.value===void 0)return new i(m.from);var g=e.Pointer.fromJSON(m.path).evaluate(b);return g.parent===void 0?new i(m.path):(a(f.parent,f.key),o(g.parent,g.key,f.value),null)}D.move=u;function d(b,m){var f=e.Pointer.fromJSON(m.from).evaluate(b);if(f.value===void 0)return new i(m.from);var g=e.Pointer.fromJSON(m.path).evaluate(b);return g.parent===void 0?new i(m.path):(o(g.parent,g.key,(0,n.clone)(f.value)),null)}D.copy=d;function _(b,m){var f=e.Pointer.fromJSON(m.path).evaluate(b);return(0,r.diffAny)(f.value,m.value,new e.Pointer).length?new s(f.value,m.value):null}D.test=_;var v=(function(b){t(m,b);function m(f){var g=b.call(this,"Invalid operation: ".concat(f.op))||this;return g.operation=f,g.name="InvalidOperationError",g}return m})(Error);D.InvalidOperationError=v;function P(b,m){switch(m.op){case"add":return c(b,m);case"remove":return l(b,m);case"replace":return h(b,m);case"move":return u(b,m);case"copy":return d(b,m);case"test":return _(b,m)}return new v(m)}return D.apply=P,D}var Wr;function sa(){return Wr||(Wr=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createTests=t.createPatch=t.applyPatch=t.Pointer=void 0;var e=hs();Object.defineProperty(t,"Pointer",{enumerable:!0,get:function(){return e.Pointer}});var n=ia(),r=ds();function i(l,h){return h.map(function(u){return(0,n.apply)(l,u)})}t.applyPatch=i;function s(l){function h(u,d,_){var v=l(u,d,_);return Array.isArray(v)?v:(0,r.diffAny)(u,d,_,h)}return h}function o(l,h,u){var d=new e.Pointer;return(u?s(u):r.diffAny)(l,h,d)}t.createPatch=o;function a(l,h){var u=e.Pointer.fromJSON(h).evaluate(l);if(u!==void 0)return{op:"test",path:h,value:u.value}}function c(l,h){var u=new Array;return h.filter(r.isDestructive).forEach(function(d){var _=a(l,d.path);if(_&&u.push(_),"from"in d){var v=a(l,d.from);v&&u.push(v)}}),u}t.createTests=c})(Qt)),Qt}var ps=sa();function oa({moves:t,phases:e,endIf:n,onEnd:r,turn:i,events:s,plugins:o}){t===void 0&&(t={}),s===void 0&&(s={}),o===void 0&&(o=[]),e===void 0&&(e={}),n||(n=()=>{}),r||(r=({G:p})=>p),i||(i={});const a={...e};""in a&&M("cannot specify phase with empty name"),a[""]={};const c={},l=new Set;let h=null;Object.keys(t).forEach(p=>l.add(p));const u=(p,y)=>{const w=Xi(p,y,o);return A=>{const k=Ue(A);return w({...k,G:A.G,ctx:A.ctx,playerID:A.playerID})}},d=p=>y=>{const w=Ue(y);return p({...w,G:y.G,ctx:y.ctx})},_={onEnd:u(r,W.GAME_ON_END),endIf:d(n)};for(const p in a){const y=a[p];if(y.start===!0&&(h=p),y.moves!==void 0)for(const w of Object.keys(y.moves))c[p+"."+w]=y.moves[w],l.add(w);y.endIf===void 0&&(y.endIf=()=>{}),y.onBegin===void 0&&(y.onBegin=({G:w})=>w),y.onEnd===void 0&&(y.onEnd=({G:w})=>w),y.turn===void 0&&(y.turn=i),y.turn.order===void 0&&(y.turn.order=zo.DEFAULT),y.turn.onBegin===void 0&&(y.turn.onBegin=({G:w})=>w),y.turn.onEnd===void 0&&(y.turn.onEnd=({G:w})=>w),y.turn.endIf===void 0&&(y.turn.endIf=()=>!1),y.turn.onMove===void 0&&(y.turn.onMove=({G:w})=>w),y.turn.stages===void 0&&(y.turn.stages={}),At(y.turn,!0);for(const w in y.turn.stages){const k=y.turn.stages[w].moves||{};for(const O of Object.keys(k)){const L=p+"."+w+"."+O;c[L]=k[O],l.add(O)}}if(y.wrapped={onBegin:u(y.onBegin,W.PHASE_ON_BEGIN),onEnd:u(y.onEnd,W.PHASE_ON_END),endIf:d(y.endIf)},y.turn.wrapped={onMove:u(y.turn.onMove,W.TURN_ON_MOVE),onBegin:u(y.turn.onBegin,W.TURN_ON_BEGIN),onEnd:u(y.turn.onEnd,W.TURN_ON_END),endIf:d(y.turn.endIf)},typeof y.next!="function"){const{next:w}=y;y.next=()=>w||null}y.wrapped.next=d(y.next)}function v(p){return p.phase?a[p.phase]:a[""]}function P(p){return p}function b(p,y){const w=new Set,A=new Set;for(let k=0;k<y.length;k++){const{fn:O,arg:L,...T}=y[k];if(O===G){A.clear();const z=p.ctx.phase;if(w.has(z)){const ce={...p.ctx,phase:null};return{...p,ctx:ce}}w.add(z)}const te=[];if(p=O(p,{...T,arg:L,next:te}),O===F)break;const U=Y(p);if(U){y.push({fn:F,arg:U,turn:p.ctx.turn,phase:p.ctx.phase,automatic:!0});continue}const V=re(p);if(V){y.push({fn:G,arg:V,turn:p.ctx.turn,phase:p.ctx.phase,automatic:!0});continue}if([P,B,q].includes(O)){const z=ie(p);if(z){y.push({fn:De,arg:z,turn:p.ctx.turn,phase:p.ctx.phase,automatic:!0});continue}}y.push(...te)}return p}function m(p,{next:y}){return y.push({fn:f}),p}function f(p,{next:y}){let{G:w,ctx:A}=p;return w=v(A).wrapped.onBegin(p),y.push({fn:g}),{...p,G:w,ctx:A}}function g(p,{currentPlayer:y}){let{ctx:w}=p;const A=v(w);y?(w={...w,currentPlayer:y},A.turn.activePlayers&&(w=xt(w,A.turn.activePlayers))):w=Ho(p,A.turn);const k=w.turn+1;w={...w,turn:k,numMoves:0,_prevActivePlayers:[]};const O=A.turn.wrapped.onBegin({...p,ctx:w});return{...p,G:O,ctx:w,_undo:[],_redo:[]}}function E(p,{arg:y,next:w,phase:A}){const k=v({phase:A});let{ctx:O}=p;if(y&&y.next)if(y.next in a)O={...O,phase:y.next};else return M("invalid phase: "+y.next),p;else O={...O,phase:k.wrapped.next(p)||null};return p={...p,ctx:O},w.push({fn:f}),p}function C(p,{arg:y,currentPlayer:w,next:A}){let{G:k,ctx:O}=p;const L=v(O),{endPhase:T,ctx:te}=Wo(p,w,L.turn,y);return O=te,p={...p,G:k,ctx:O},T?A.push({fn:G,turn:O.turn,phase:O.phase}):A.push({fn:g,currentPlayer:O.currentPlayer}),p}function B(p,{arg:y,playerID:w}){if((typeof y=="string"||y===Nt.NULL)&&(y={stage:y}),typeof y!="object")return p;At(y);let{ctx:A}=p,{activePlayers:k,_activePlayersMinMoves:O,_activePlayersMaxMoves:L,_activePlayersNumMoves:T}=A;return y.stage!==void 0&&(k===null&&(k={}),k[w]=y.stage,T[w]=0,y.minMoves&&(O===null&&(O={}),O[w]=y.minMoves),y.maxMoves&&(L===null&&(L={}),L[w]=y.maxMoves)),A={...A,activePlayers:k,_activePlayersMinMoves:O,_activePlayersMaxMoves:L,_activePlayersNumMoves:T},{...p,ctx:A}}function q(p,{arg:y}){return{...p,ctx:xt(p.ctx,y)}}function Y(p){return _.endIf(p)}function re(p){return v(p.ctx).wrapped.endIf(p)}function ie(p){const y=v(p.ctx),w=p.ctx.numMoves||0;return y.turn.maxMoves&&w>=y.turn.maxMoves?!0:y.turn.wrapped.endIf(p)}function F(p,{arg:y,phase:w}){p=G(p,{}),y===void 0&&(y=!0),p={...p,ctx:{...p.ctx,gameover:y}};const A=_.onEnd(p);return{...p,G:A}}function G(p,{arg:y,next:w,turn:A,automatic:k}){p=De(p,{turn:A,force:!0,automatic:!0});const{phase:O,turn:L}=p.ctx;if(w&&w.push({fn:E,arg:y,phase:O}),O===null)return p;const te=v(p.ctx).wrapped.onEnd(p),U={...p.ctx,phase:null},V=Ze("endPhase",y),{_stateID:z}=p,ce={action:V,_stateID:z,turn:L,phase:O};k&&(ce.automatic=!0);const ke=[...p.deltalog||[],ce];return{...p,G:te,ctx:U,deltalog:ke}}function De(p,{arg:y,next:w,turn:A,force:k,automatic:O,playerID:L}){if(A!==p.ctx.turn)return p;const{currentPlayer:T,numMoves:te,phase:U,turn:V}=p.ctx,z=v(p.ctx),ce=te||0;if(!k&&z.turn.minMoves&&ce<z.turn.minMoves)return`${z.turn.minMoves}`,p;const ke=z.turn.wrapped.onEnd(p);w&&w.push({fn:C,arg:y,currentPlayer:T});let Ee={...p.ctx,activePlayers:null};if(y&&y.remove){L=L||T;const Ie=Ee.playOrder.filter(so=>so!=L),io=Ee.playOrderPos>Ie.length-1?0:Ee.playOrderPos;if(Ee={...Ee,playOrder:Ie,playOrderPos:io},Ie.length===0)return w.push({fn:G,turn:V,phase:U}),p}const Vt=Ze("endTurn",y),{_stateID:pr}=p,He={action:Vt,_stateID:pr,turn:V,phase:U};O&&(He.automatic=!0);const Ht=[...p.deltalog||[],He];return{...p,G:ke,ctx:Ee,deltalog:Ht,_undo:[],_redo:[]}}function Ve(p,{arg:y,next:w,automatic:A,playerID:k}){k=k||p.ctx.currentPlayer;let{ctx:O,_stateID:L}=p,{activePlayers:T,_activePlayersNumMoves:te,_activePlayersMinMoves:U,_activePlayersMaxMoves:V,phase:z,turn:ce}=O;const ke=T!==null&&k in T,Ee=v(O);if(!y&&ke){const Ie=Ee.turn.stages[T[k]];Ie&&Ie.next&&(y=Ie.next)}if(w&&w.push({fn:B,arg:y,playerID:k}),!ke)return p;const Vt=te[k]||0;if(U&&U[k]&&Vt<U[k])return`${U[k]}`,p;T={...T},delete T[k],U&&(U={...U},delete U[k]),V&&(V={...V},delete V[k]),O=Vo({...O,activePlayers:T,_activePlayersMinMoves:U,_activePlayersMaxMoves:V});const He={action:Ze("endStage",y),_stateID:L,turn:ce,phase:z};A&&(He.automatic=!0);const Ht=[...p.deltalog||[],He];return{...p,ctx:O,deltalog:Ht}}function ut(p,y,w){const A=v(p),k=A.turn.stages,{activePlayers:O}=p;if(O&&O[w]!==void 0&&O[w]!==Nt.NULL&&k[O[w]]!==void 0&&k[O[w]].moves!==void 0){const T=k[O[w]].moves;if(y in T)return T[y]}else if(A.moves){if(y in A.moves)return A.moves[y]}else if(y in t)return t[y];return null}function Ft(p,y){const{playerID:w,type:A}=y,{currentPlayer:k,activePlayers:O,_activePlayersMaxMoves:L}=p.ctx,T=ut(p.ctx,A,w),te=!T||typeof T=="function"||T.noLimit!==!0;let{numMoves:U,_activePlayersNumMoves:V}=p.ctx;te&&(w===k&&U++,O&&V[w]++),p={...p,ctx:{...p.ctx,numMoves:U,_activePlayersNumMoves:V}},L&&V[w]>=L[w]&&(p=Ve(p,{playerID:w,automatic:!0}));const ce=v(p.ctx).turn.wrapped.onMove({...p,playerID:w});return p={...p,G:ce},b(p,[{fn:P}])}function Gt(p,y,w){return b(p,[{fn:Ve,arg:w,playerID:y}])}function Ks(p,y){return b(p,[{fn:Ve,playerID:y}])}function Ys(p,y,w){return b(p,[{fn:q,arg:w}])}function Xs(p,y,w){return b(p,[{fn:G,phase:p.ctx.phase,turn:p.ctx.turn,arg:{next:w}}])}function Qs(p){return b(p,[{fn:G,phase:p.ctx.phase,turn:p.ctx.turn}])}function Zs(p,y,w){return b(p,[{fn:De,turn:p.ctx.turn,phase:p.ctx.phase,arg:w}])}function eo(p,y,w){return b(p,[{fn:De,turn:p.ctx.turn,phase:p.ctx.phase,force:!0,arg:w}])}function to(p,y,w){return b(p,[{fn:F,turn:p.ctx.turn,phase:p.ctx.phase,arg:w}])}const lt={endStage:Ks,setStage:Gt,endTurn:Zs,pass:eo,endPhase:Qs,setPhase:Xs,endGame:to,setActivePlayers:Ys},ye=[];s.endTurn!==!1&&ye.push("endTurn"),s.pass!==!1&&ye.push("pass"),s.endPhase!==!1&&ye.push("endPhase"),s.setPhase!==!1&&ye.push("setPhase"),s.endGame!==!1&&ye.push("endGame"),s.setActivePlayers!==!1&&ye.push("setActivePlayers"),s.endStage!==!1&&ye.push("endStage"),s.setStage!==!1&&ye.push("setStage");function no(p,y){const{type:w,playerID:A,args:k}=y.payload;return typeof lt[w]!="function"?p:lt[w](p,A,...Array.isArray(k)?k:[k])}function ro(p,y,w){return y.activePlayers?w in y.activePlayers:y.currentPlayer===w}return{ctx:p=>({numPlayers:p,turn:0,currentPlayer:"0",playOrder:[...Array.from({length:p})].map((y,w)=>w+""),playOrderPos:0,phase:h,activePlayers:null}),init:p=>b(p,[{fn:m}]),isPlayerActive:ro,eventHandlers:lt,eventNames:Object.keys(lt),enabledEventNames:ye,moveMap:c,moveNames:[...l.values()],processMove:Ft,processEvent:no,getMove:ut}}function aa(t){return t.processMove!==void 0}function Bt(t){if(aa(t))return t;if(t.name===void 0&&(t.name="default"),t.deltaState===void 0&&(t.deltaState=!1),t.disableUndo===void 0&&(t.disableUndo=!1),t.setup===void 0&&(t.setup=()=>({})),t.moves===void 0&&(t.moves={}),t.playerView===void 0&&(t.playerView=({G:n})=>n),t.plugins===void 0&&(t.plugins=[]),t.plugins.forEach(n=>{if(n.name===void 0)throw new Error("Plugin missing name attribute");if(n.name.includes(" "))throw new Error(n.name+": Plugin name must not include spaces")}),t.name.includes(" "))throw new Error(t.name+": Game name must not include spaces");const e=oa(t);return{...t,flow:e,moveNames:e.moveNames,pluginNames:t.plugins.map(n=>n.name),processMove:(n,r)=>{let i=e.getMove(n.ctx,r.type,r.playerID);if(_s(i)&&(i=i.move),i instanceof Function){const s=Xi(i,W.MOVE,t.plugins);let o=[];r.args!==void 0&&(o=Array.isArray(r.args)?r.args:[r.args]);const a={...Ue(n),G:n.G,ctx:n.ctx,playerID:r.playerID};return s(a,...o)}return M(`invalid move object: ${r.type}`),n.G}}}function _s(t){return t instanceof Object&&t.move!==void 0}var On;(function(t){t.UnauthorizedAction="update/unauthorized_action",t.MatchNotFound="update/match_not_found",t.PatchFailed="update/patch_failed"})(On||(On={}));var H;(function(t){t.StaleStateId="action/stale_state_id",t.UnavailableMove="action/unavailable_move",t.InvalidMove="action/invalid_move",t.InactivePlayer="action/inactive_player",t.GameOver="action/gameover",t.ActionDisabled="action/action_disabled",t.ActionInvalid="action/action_invalid",t.PluginActionInvalid="action/plugin_invalid"})(H||(H={}));const dt=t=>t.payload.playerID!==null&&t.payload.playerID!==void 0,ca=(t,e,n)=>{function r(s){return s.undoable!==void 0}function i(s){return s instanceof Function}return r(n)?i(n.undoable)?n.undoable({G:t,ctx:e}):n.undoable:!0};function zr(t,e){if(e.game.disableUndo)return t;const n={G:t.G,ctx:t.ctx,plugins:t.plugins,playerID:e.action.payload.playerID||t.ctx.currentPlayer};return e.action.type==="MAKE_MOVE"&&(n.moveType=e.action.payload.type),{...t,_undo:[...t._undo,n],_redo:[]}}function en(t,e,n){const r={action:e,_stateID:t._stateID,turn:t.ctx.turn,phase:t.ctx.phase},i=t.plugins.log.data.metadata;return i!==void 0&&(r.metadata=i),typeof n=="object"&&n.redact===!0?r.redact=!0:typeof n=="object"&&n.redact instanceof Function&&(r.redact=n.redact({G:t.G,ctx:t.ctx})),{...t,deltalog:[r]}}function tn(t,e,n){const[r,i]=Qi(t,n);return i?[r,K(e,H.PluginActionInvalid,i)]:[r]}function ys(t){if(!t)return[null,void 0];const{transients:e,...n}=t;return[n,e]}function K(t,e,n){return{...t,transients:{error:{type:e,payload:n}}}}const ms=t=>e=>n=>{const r=e(n);if(n.type===Lt)return r;{const[,i]=ys(t.getState());return typeof i<"u"?(t.dispatch(Yi()),{...r,transients:i}):r}};function rr({game:t,isClient:e}){return t=Bt(t),(n=null,r)=>{let[i]=ys(n);switch(r.type){case Lt:return i;case Dt:{if(i={...i,deltalog:[]},e)return i;if(i.ctx.gameover!==void 0)return M("cannot call event after game end"),K(i,H.GameOver);if(dt(r)&&!t.flow.isPlayerActive(i.G,i.ctx,r.payload.playerID))return M(`disallowed event: ${r.payload.type}`),K(i,H.InactivePlayer);i=En(i,{game:t,playerID:r.payload.playerID});let s=t.flow.processEvent(i,r),o;return[s,o]=tn(s,i,{game:t}),o||(s=zr(s,{game:t,action:r}),{...s,_stateID:i._stateID+1})}case rt:{const s=i={...i,deltalog:[]},o=t.flow.getMove(i.ctx,r.payload.type,r.payload.playerID||i.ctx.currentPlayer);if(o===null)return M(`disallowed move: ${r.payload.type}`),K(i,H.UnavailableMove);if(e&&o.client===!1)return i;if(i.ctx.gameover!==void 0)return M("cannot make move after game end"),K(i,H.GameOver);if(dt(r)&&!t.flow.isPlayerActive(i.G,i.ctx,r.payload.playerID))return M(`disallowed move: ${r.payload.type}`),K(i,H.InactivePlayer);i=En(i,{game:t,playerID:r.payload.playerID});const a=t.processMove(i,r.payload);if(a===Be)return M(`invalid move: ${r.payload.type} args: ${r.payload.args}`),K(i,H.InvalidMove);const c={...i,G:a};if(e&&Fo(c,{game:t}))return i;if(i=c,e){let h;return[i,h]=tn(i,s,{game:t}),h||{...i,_stateID:i._stateID+1}}i=en(i,r,o),i=t.flow.processMove(i,r.payload);let l;return[i,l]=tn(i,s,{game:t}),l||(i=zr(i,{game:t,action:r}),{...i,_stateID:i._stateID+1})}case zn:case Kn:case Jn:return r.state;case $t:{if(i={...i,deltalog:[]},t.disableUndo)return M("Undo is not enabled"),K(i,H.ActionDisabled);const{G:s,ctx:o,_undo:a,_redo:c,_stateID:l}=i;if(a.length<2)return M("No moves to undo"),K(i,H.ActionInvalid);const h=a[a.length-1],u=a[a.length-2];if(dt(r)&&r.payload.playerID!==h.playerID)return M("Cannot undo other players' moves"),K(i,H.ActionInvalid);if(h.moveType){const d=t.flow.getMove(u.ctx,h.moveType,h.playerID);if(!ca(s,o,d))return M("Move cannot be undone"),K(i,H.ActionInvalid)}return i=en(i,r),{...i,G:u.G,ctx:u.ctx,plugins:u.plugins,_stateID:l+1,_undo:a.slice(0,-1),_redo:[h,...c]}}case Rt:{if(i={...i,deltalog:[]},t.disableUndo)return M("Redo is not enabled"),K(i,H.ActionDisabled);const{_undo:s,_redo:o,_stateID:a}=i;if(o.length===0)return M("No moves to redo"),K(i,H.ActionInvalid);const c=o[0];return dt(r)&&r.payload.playerID!==c.playerID?(M("Cannot redo other players' moves"),K(i,H.ActionInvalid)):(i=en(i,r),{...i,G:c.G,ctx:c.ctx,plugins:c.plugins,_stateID:a+1,_undo:[...s,c],_redo:o.slice(1)})}case qi:return Uo(i,r,{game:t});case Yn:{const s=i,o=JSON.parse(JSON.stringify(s)),a=ps.applyPatch(o,r.patch);return a.some(l=>l!==null)?(M(`Patch ${JSON.stringify(r.patch)} apply failed`),K(s,On.PatchFailed,a)):o}default:return i}}}var nn={},Jr;function ua(){return Jr||(Jr=1,(function(t,e){if(t.setImmediate)return;var n=1,r={},i=!1,s=t.document,o;function a(f){typeof f!="function"&&(f=new Function(""+f));for(var g=new Array(arguments.length-1),E=0;E<g.length;E++)g[E]=arguments[E+1];var C={callback:f,args:g};return r[n]=C,o(n),n++}function c(f){delete r[f]}function l(f){var g=f.callback,E=f.args;switch(E.length){case 0:g();break;case 1:g(E[0]);break;case 2:g(E[0],E[1]);break;case 3:g(E[0],E[1],E[2]);break;default:g.apply(e,E);break}}function h(f){if(i)setTimeout(h,0,f);else{var g=r[f];if(g){i=!0;try{l(g)}finally{c(f),i=!1}}}}function u(){o=function(f){process.nextTick(function(){h(f)})}}function d(){if(t.postMessage&&!t.importScripts){var f=!0,g=t.onmessage;return t.onmessage=function(){f=!1},t.postMessage("","*"),t.onmessage=g,f}}function _(){var f="setImmediate$"+Math.random()+"$",g=function(E){E.source===t&&typeof E.data=="string"&&E.data.indexOf(f)===0&&h(+E.data.slice(f.length))};t.addEventListener?t.addEventListener("message",g,!1):t.attachEvent("onmessage",g),o=function(E){t.postMessage(f+E,"*")}}function v(){var f=new MessageChannel;f.port1.onmessage=function(g){var E=g.data;h(E)},o=function(g){f.port2.postMessage(g)}}function P(){var f=s.documentElement;o=function(g){var E=s.createElement("script");E.onreadystatechange=function(){h(g),E.onreadystatechange=null,f.removeChild(E),E=null},f.appendChild(E)}}function b(){o=function(f){setTimeout(h,0,f)}}var m=Object.getPrototypeOf&&Object.getPrototypeOf(t);m=m&&m.setTimeout?m:t,{}.toString.call(t.process)==="[object process]"?u():d()?_():t.MessageChannel?v():s&&"onreadystatechange"in s.createElement("script")?P():b(),m.setImmediate=a,m.clearImmediate=c})(typeof self>"u"?typeof Ir>"u"?nn:Ir:self)),nn}ua();class la{constructor({enumerate:e,seed:n}){this.enumerateFn=e,this.seed=n,this.iterationCounter=0,this._opts={}}addOpt({key:e,range:n,initial:r}){this._opts[e]={range:n,value:r}}getOpt(e){return this._opts[e].value}setOpt(e,n){e in this._opts&&(this._opts[e].value=n)}opts(){return this._opts}enumerate(e,n,r){return this.enumerateFn(e,n,r).map(s=>{if("payload"in s)return s;if("move"in s)return Fi(s.move,s.args,r);if("event"in s)return Ze(s.event,s.args,r)})}random(e){let n;if(this.seed!==void 0){const r=this.prngstate?"":this.seed,i=Ui(r,this.prngstate);n=i(),this.prngstate=i.state()}else n=Math.random();if(e)if(Array.isArray(e)){const r=Math.floor(n*e.length);return e[r]}else return Math.floor(n*e);return n}}const ha=25;class fa extends la{constructor({enumerate:e,seed:n,objectives:r,game:i,iterations:s,playoutDepth:o,iterationCallback:a}){super({enumerate:e,seed:n}),r===void 0&&(r=()=>({})),this.objectives=r,this.iterationCallback=a||(()=>{}),this.reducer=rr({game:i}),this.iterations=s,this.playoutDepth=o,this.addOpt({key:"async",initial:!1}),this.addOpt({key:"iterations",initial:typeof s=="number"?s:1e3,range:{min:1,max:2e3}}),this.addOpt({key:"playoutDepth",initial:typeof o=="number"?o:50,range:{min:1,max:100}})}createNode({state:e,parentAction:n,parent:r,playerID:i}){const{G:s,ctx:o}=e;let a=[],c=[];if(i!==void 0)a=this.enumerate(s,o,i),c=this.objectives(s,o,i);else if(o.activePlayers)for(const l in o.activePlayers)a.push(...this.enumerate(s,o,l)),c.push(this.objectives(s,o,l));else a=this.enumerate(s,o,o.currentPlayer),c=this.objectives(s,o,o.currentPlayer);return{state:e,parent:r,parentAction:n,actions:a,objectives:c,children:[],visits:0,value:0}}select(e){if(e.actions.length>0||e.children.length===0)return e;let n=null,r=0;for(const i of e.children){const s=i.visits+Number.EPSILON,o=i.value/s+Math.sqrt(2*Math.log(e.visits)/s);(n==null||o>r)&&(r=o,n=i)}return this.select(n)}expand(e){const n=e.actions;if(n.length===0||e.state.ctx.gameover!==void 0)return e;const r=this.random(n.length),i=n[r];e.actions.splice(r,1);const s=this.reducer(e.state,i),o=this.createNode({state:s,parentAction:i,parent:e});return e.children.push(o),o}playout({state:e}){let n=this.getOpt("playoutDepth");typeof this.playoutDepth=="function"&&(n=this.playoutDepth(e.G,e.ctx));for(let r=0;r<n&&e.ctx.gameover===void 0;r++){const{G:i,ctx:s}=e;let o=s.currentPlayer;s.activePlayers&&(o=Object.keys(s.activePlayers)[0]);const a=this.enumerate(i,s,o),c=this.objectives(i,s,o),l=Object.keys(c).reduce((d,_)=>{const v=c[_];return v.checker(i,s)?d+v.weight:d},0);if(l>0)return{score:l};if(!a||a.length===0)return;const h=this.random(a.length);e=this.reducer(e,a[h])}return e.ctx.gameover}backpropagate(e,n={}){e.visits++,n.score!==void 0&&(e.value+=n.score),n.draw===!0&&(e.value+=.5),e.parentAction&&n.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,n)}play(e,n){const r=this.createNode({state:e,playerID:n});let i=this.getOpt("iterations");typeof this.iterations=="function"&&(i=this.iterations(e.G,e.ctx));const s=()=>{let o=null;for(const l of r.children)(o==null||l.visits>o.visits)&&(o=l);return{action:o&&o.parentAction,metadata:r}};return new Promise(o=>{const a=()=>{for(let c=0;c<ha&&this.iterationCounter<i;c++){const l=this.select(r),h=this.expand(l),u=this.playout(h);this.backpropagate(h,u),this.iterationCounter++}this.iterationCallback({iterationCounter:this.iterationCounter,numIterations:i,metadata:r})};if(this.iterationCounter=0,this.getOpt("async")){const c=()=>{this.iterationCounter<i?(a(),setImmediate(c)):o(s())};c()}else{for(;this.iterationCounter<i;)a();o(s())}})}}function it(t){"@babel/helpers - typeof";return it=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},it(t)}function da(t,e){if(it(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(it(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function pa(t){var e=da(t,"string");return it(e)=="symbol"?e:e+""}function _a(t,e,n){return(e=pa(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Kr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Yr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Kr(Object(n),!0).forEach(function(r){_a(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Kr(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Q(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}var Xr=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})(),Qr=function(){return Math.random().toString(36).substring(7).split("").join(".")},Zr={INIT:"@@redux/INIT"+Qr(),REPLACE:"@@redux/REPLACE"+Qr()};function ya(t){if(typeof t!="object"||t===null)return!1;for(var e=t;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function ir(t,e,n){var r;if(typeof e=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(Q(0));if(typeof e=="function"&&typeof n>"u"&&(n=e,e=void 0),typeof n<"u"){if(typeof n!="function")throw new Error(Q(1));return n(ir)(t,e)}if(typeof t!="function")throw new Error(Q(2));var i=t,s=e,o=[],a=o,c=!1;function l(){a===o&&(a=o.slice())}function h(){if(c)throw new Error(Q(3));return s}function u(P){if(typeof P!="function")throw new Error(Q(4));if(c)throw new Error(Q(5));var b=!0;return l(),a.push(P),function(){if(b){if(c)throw new Error(Q(6));b=!1,l();var f=a.indexOf(P);a.splice(f,1),o=null}}}function d(P){if(!ya(P))throw new Error(Q(7));if(typeof P.type>"u")throw new Error(Q(8));if(c)throw new Error(Q(9));try{c=!0,s=i(s,P)}finally{c=!1}for(var b=o=a,m=0;m<b.length;m++){var f=b[m];f()}return P}function _(P){if(typeof P!="function")throw new Error(Q(10));i=P,d({type:Zr.REPLACE})}function v(){var P,b=u;return P={subscribe:function(f){if(typeof f!="object"||f===null)throw new Error(Q(11));function g(){f.next&&f.next(h())}g();var E=b(g);return{unsubscribe:E}}},P[Xr]=function(){return this},P}return d({type:Zr.INIT}),r={dispatch:d,subscribe:u,getState:h,replaceReducer:_},r[Xr]=v,r}function gs(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===0?function(r){return r}:e.length===1?e[0]:e.reduce(function(r,i){return function(){return r(i.apply(void 0,arguments))}})}function vs(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){return function(){var i=r.apply(void 0,arguments),s=function(){throw new Error(Q(15))},o={getState:i.getState,dispatch:function(){return s.apply(void 0,arguments)}},a=e.map(function(c){return c(o)});return s=gs.apply(void 0,a)(i.dispatch),Yr(Yr({},i),{},{dispatch:s})}}}function bs({game:t,numPlayers:e,setupData:n}){t=Bt(t),e||(e=2);const r=t.flow.ctx(e);let i={G:{},ctx:r,plugins:{}};i=jo(i,{game:t}),i=En(i,{game:t,playerID:void 0});const s=Ue(i);i.G=t.setup({...s,ctx:i.ctx},n);let o={...i,_undo:[],_redo:[],_stateID:0};return o=t.flow.init(o),[o]=Qi(o,{game:t}),t.disableUndo||(o._undo=[{G:o.G,ctx:o.ctx,plugins:o.plugins}]),o}let sr=class{constructor({transportDataCallback:e,gameName:n,playerID:r,matchID:i,credentials:s,numPlayers:o}){this.connectionStatusCallback=()=>{},this.isConnected=!1,this.transportDataCallback=e,this.gameName=n||"default",this.playerID=r||null,this.matchID=i||"default",this.credentials=s,this.numPlayers=o||2}subscribeToConnectionStatus(e){this.connectionStatusCallback=e}setConnectionStatus(e){this.isConnected=e,this.connectionStatusCallback()}notifyClient(e){this.transportDataCallback(e)}};class ma extends sr{connect(){}disconnect(){}sendAction(){}sendChatMessage(){}requestSync(){}updateCredentials(){}updateMatchID(){}updatePlayerID(){}}const ga=t=>new ma(t);class va{constructor(){this.debugPanel=null,this.currentClient=null,this.clients=new Map,this.subscribers=new Map}register(e){this.clients.set(e,e),this.mountDebug(e),this.notifySubscribers()}unregister(e){if(this.clients.delete(e),this.currentClient===e){this.unmountDebug();for(const[n]of this.clients){if(this.debugPanel)break;this.mountDebug(n)}}this.notifySubscribers()}subscribe(e){const n=Symbol();return this.subscribers.set(n,e),e(this.getState()),()=>{this.subscribers.delete(n)}}switchPlayerID(e){if(this.currentClient.multiplayer){for(const[n]of this.clients)if(n.playerID===e&&n.debugOpt!==!1&&n.multiplayer===this.currentClient.multiplayer){this.switchToClient(n);return}}this.currentClient.updatePlayerID(e),this.notifySubscribers()}switchToClient(e){e!==this.currentClient&&(this.unmountDebug(),this.mountDebug(e),this.notifySubscribers())}notifySubscribers(){const e=this.getState();this.subscribers.forEach(n=>{n(e)})}getState(){return{client:this.currentClient,debuggableClients:this.getDebuggableClients()}}getDebuggableClients(){return[...this.clients.values()].filter(e=>e.debugOpt!==!1)}mountDebug(e){if(e.debugOpt===!1||this.debugPanel!==null||typeof document>"u")return;let n,r=document.body;e.debugOpt&&e.debugOpt!==!0&&(n=e.debugOpt.impl||n,r=e.debugOpt.target||r),n&&(this.currentClient=e,this.debugPanel=new n({target:r,props:{clientManager:this}}))}unmountDebug(){this.debugPanel.$destroy(),this.debugPanel=null,this.currentClient=null}}const ba=new va;function kn(t,e,n){return!n&&t==null&&(t=e.getState().ctx.currentPlayer),t}function or(t,e,n,r,i,s){const o={};for(const a of e)o[a]=(...c)=>{const l=To[t](a,c,kn(r,n,s),i);n.dispatch(l)};return o}const wa=or.bind(null,"makeMove"),Pa=or.bind(null,"gameEvent"),Ea=or.bind(null,"plugin");class Sa{constructor({game:e,debug:n,numPlayers:r,multiplayer:i,matchID:s,playerID:o,credentials:a,enhancer:c}){this.game=Bt(e),this.playerID=o,this.matchID=s||"default",this.credentials=a,this.multiplayer=i,this.debugOpt=n,this.manager=ba,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=rr({game:this.game,isClient:i!==void 0}),this.initialState=null,i||(this.initialState=bs({game:this.game,numPlayers:r})),this.reset=()=>{this.store.dispatch(zi(this.initialState))},this.undo=()=>{const _=Ji(kn(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(_)},this.redo=()=>{const _=Ki(kn(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(_)},this.log=[];const d=vs(ms,()=>_=>v=>{const P=_(v);return this.notifySubscribers(),P},_=>v=>P=>{const b=_.getState(),m=v(P);return!("clientOnly"in P)&&P.type!==Lt&&this.transport.sendAction(b,P),m},_=>v=>P=>{const b=v(P),m=_.getState();switch(P.type){case rt:case Dt:case $t:case Rt:{const f=m.deltalog;this.log=[...this.log,...f];break}case zn:{this.log=[];break}case Yn:case Kn:{let f=-1;this.log.length>0&&(f=this.log[this.log.length-1]._stateID);let g=P.deltalog||[];g=g.filter(E=>E._stateID>f),this.log=[...this.log,...g];break}case Jn:{this.initialState=P.initialState,this.log=P.log||[];break}}return b});c=c!==void 0?gs(d,c):d,this.store=ir(this.reducer,this.initialState,c),i||(i=ga),this.transport=i({transportDataCallback:_=>this.receiveTransportData(_),gameKey:e,game:this.game,matchID:s,playerID:o,credentials:a,gameName:this.game.name,numPlayers:r}),this.createDispatchers(),this.chatMessages=[],this.sendChatMessage=_=>{this.transport.sendChatMessage(this.matchID,{id:ra(7),sender:this.playerID,payload:_})}}receiveMatchData(e){this.matchData=e,this.notifySubscribers()}receiveChatMessage(e){this.chatMessages=[...this.chatMessages,e],this.notifySubscribers()}receiveTransportData(e){const[n]=e.args;if(n===this.matchID)switch(e.type){case"sync":{const[,r]=e.args,i=Vi(r);this.receiveMatchData(r.filteredMetadata),this.store.dispatch(i);break}case"update":{const[,r,i]=e.args,s=this.store.getState();if(r._stateID>=s._stateID){const o=Wi(r,i);this.store.dispatch(o)}break}case"patch":{const[,r,i,s,o]=e.args,a=this.store.getState()._stateID;if(r!==a)break;const c=Hi(r,i,s,o);this.store.dispatch(c),this.store.getState()._stateID===a&&this.transport.requestSync();break}case"matchData":{const[,r]=e.args;this.receiveMatchData(r);break}case"chat":{const[,r]=e.args;this.receiveChatMessage(r);break}}}notifySubscribers(){Object.values(this.subscribers).forEach(e=>e(this.getState()))}overrideGameState(e){this.gameStateOverride=e,this.notifySubscribers()}start(){this.transport.connect(),this._running=!0,this.manager.register(this)}stop(){this.transport.disconnect(),this._running=!1,this.manager.unregister(this)}subscribe(e){const n=Object.keys(this.subscribers).length;return this.subscribers[n]=e,this.transport.subscribeToConnectionStatus(()=>this.notifySubscribers()),(this._running||!this.multiplayer)&&e(this.getState()),()=>{delete this.subscribers[n]}}getInitialState(){return this.initialState}getState(){let e=this.store.getState();if(this.gameStateOverride!==null&&(e=this.gameStateOverride),e===null)return e;let n=!0;const r=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);return this.multiplayer&&!r&&(n=!1),!this.multiplayer&&this.playerID!==null&&this.playerID!==void 0&&!r&&(n=!1),e.ctx.gameover!==void 0&&(n=!1),this.multiplayer||(e={...e,G:this.game.playerView({G:e.G,ctx:e.ctx,playerID:this.playerID}),plugins:Zi(e,this)}),{...e,log:this.log,isActive:n,isConnected:this.transport.isConnected}}createDispatchers(){this.moves=wa(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=Pa(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=Ea(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}updatePlayerID(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}updateMatchID(e){this.matchID=e,this.createDispatchers(),this.transport.updateMatchID(e),this.notifySubscribers()}updateCredentials(e){this.credentials=e,this.createDispatchers(),this.transport.updateCredentials(e),this.notifySubscribers()}}function Ca(t){return new Sa(t)}const ws=(t,e)=>{if(!t||typeof t!="string")throw new Error(`Expected ${e} string, got "${t}".`)},Ae=t=>ws(t,"game name"),We=t=>ws(t,"match ID"),ze=(t,e)=>{if(!t)throw new Error(`Expected body, got “${t}”.`);for(const n in e){const r=e[n],i=Array.isArray(r)?r:[r],s=t[n];if(!i.includes(typeof s)){const o=i.join("|");throw new TypeError(`Expected body.${n} to be of type ${o}, got “${s}”.`)}}};class Oa extends Error{constructor(e,n){super(e),this.details=n}}class ka{constructor({server:e=""}={}){this.server=e.replace(/\/$/,"")}async request(e,n){const r=await fetch(this.server+e,n);if(!r.ok){let i;try{i=await r.clone().json()}catch{try{i=await r.text()}catch(s){i=s.message}}throw new Oa(`HTTP status ${r.status}`,i)}return r.json()}async post(e,n){let r={method:"post",body:JSON.stringify(n.body),headers:{"Content-Type":"application/json"}};return n.init&&(r={...r,...n.init,headers:{...r.headers,...n.init.headers}}),this.request(e,r)}async listGames(e){return this.request("/games",e)}async listMatches(e,n,r){Ae(e);let i="";if(n){const s=[],{isGameover:o,updatedBefore:a,updatedAfter:c}=n;o!==void 0&&s.push(`isGameover=${o}`),a&&s.push(`updatedBefore=${a}`),c&&s.push(`updatedAfter=${c}`),s.length>0&&(i="?"+s.join("&"))}return this.request(`/games/${e}${i}`,r)}async getMatch(e,n,r){return Ae(e),We(n),this.request(`/games/${e}/${n}`,r)}async createMatch(e,n,r){return Ae(e),ze(n,{numPlayers:"number"}),this.post(`/games/${e}/create`,{body:n,init:r})}async joinMatch(e,n,r,i){return Ae(e),We(n),ze(r,{playerID:["string","undefined"],playerName:"string"}),this.post(`/games/${e}/${n}/join`,{body:r,init:i})}async leaveMatch(e,n,r,i){Ae(e),We(n),ze(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${e}/${n}/leave`,{body:r,init:i})}async updatePlayer(e,n,r,i){Ae(e),We(n),ze(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${e}/${n}/update`,{body:r,init:i})}async playAgain(e,n,r,i){return Ae(e),We(n),ze(r,{playerID:"string",credentials:"string"}),this.post(`/games/${e}/${n}/playAgain`,{body:r,init:i})}}function Ps(t,e){for(var n in e)t[n]=e[n];return t}function In(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function Es(t,e){var n=e(),r=Zn({t:{__:n,u:e}}),i=r[0].t,s=r[1];return ct(function(){i.__=n,i.u=e,rn(i)&&s({t:i})},[t,n,e]),tr(function(){return rn(i)&&s({t:i}),t(function(){rn(i)&&s({t:i})})},[t]),n}function rn(t){var e,n,r=t.u,i=t.__;try{var s=r();return!((e=i)===(n=s)&&(e!==0||1/e==1/n)||e!=e&&n!=n)}catch{return!0}}function Ss(t){t()}function Cs(t){return t}function Os(){return[!1,Ss]}var ks=ct;function An(t,e){this.props=t,this.context=e}function Ia(t,e){function n(i){var s=this.props.ref,o=s==i.ref;return!o&&s&&(s.call?s(null):s.current=null),e?!e(this.props,i)||!o:In(this.props,i)}function r(i){return this.shouldComponentUpdate=n,be(t,i)}return r.displayName="Memo("+(t.displayName||t.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r.type=t,r}(An.prototype=new he).isPureReactComponent=!0,An.prototype.shouldComponentUpdate=function(t,e){return In(this.props,t)||In(this.state,e)};var ei=x.__b;x.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),ei&&ei(t)};var Aa=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function xa(t){function e(n){var r=Ps({},n);return delete r.ref,t(r,n.ref||null)}return e.$$typeof=Aa,e.render=t,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var ti=function(t,e){return t==null?null:ve(ve(t).map(e))},Na={map:ti,forEach:ti,count:function(t){return t?ve(t).length:0},only:function(t){var e=ve(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:ve},Ma=x.__e;x.__e=function(t,e,n,r){if(t.then){for(var i,s=e;s=s.__;)if((i=s.__c)&&i.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),i.__c(t,e)}Ma(t,e,n,r)};var ni=x.unmount;function Is(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=Ps({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return Is(r,e,n)})),t}function As(t,e,n){return t&&n&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return As(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=n)),t}function vt(){this.__u=0,this.o=null,this.__b=null}function xs(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function Ta(t){var e,n,r,i=null;function s(o){if(e||(e=t()).then(function(a){a&&(i=a.default||a),r=!0},function(a){n=a,r=!0}),n)throw n;if(!r)throw e;return i?be(i,o):null}return s.displayName="Lazy",s.__f=!0,s}function Ye(){this.i=null,this.l=null}x.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),ni&&ni(t)},(vt.prototype=new he).__c=function(t,e){var n=e.__c,r=this;r.o==null&&(r.o=[]),r.o.push(n);var i=xs(r.__v),s=!1,o=function(){s||(s=!0,n.__R=null,i?i(a):a())};n.__R=o;var a=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=As(c,c.__c.__P,c.__c.__O)}var l;for(r.setState({__a:r.__b=null});l=r.o.pop();)l.forceUpdate()}};r.__u++||32&e.__u||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(o,o)},vt.prototype.componentWillUnmount=function(){this.o=[]},vt.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=Is(this.__b,n,r.__O=r.__P)}this.__b=null}var i=e.__a&&be(pe,null,t.fallback);return i&&(i.__u&=-33),[be(pe,null,e.__a?null:t.children),i]};var ri=function(t,e,n){if(++n[1]===n[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(n=t.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.i=n=n[2]}};function Da(t){return this.getChildContext=function(){return t.context},t.children}function Ra(t){var e=this,n=t.h;if(e.componentWillUnmount=function(){$e(null,e.v),e.v=null,e.h=null},e.h&&e.h!==n&&e.componentWillUnmount(),!e.v){for(var r=e.__v;r!==null&&!r.__m&&r.__!==null;)r=r.__;e.h=n,e.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:r.__m},contains:function(){return!0},insertBefore:function(i,s){this.childNodes.push(i),e.h.insertBefore(i,s)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),e.h.removeChild(i)}}}$e(be(Da,{context:e.context},t.__v),e.v)}function $a(t,e){var n=be(Ra,{__v:t,h:e});return n.containerInfo=e,n}(Ye.prototype=new he).__a=function(t){var e=this,n=xs(e.__v),r=e.l.get(t);return r[0]++,function(i){var s=function(){e.props.revealOrder?(r.push(i),ri(e,t,r)):i()};n?n(s):s()}},Ye.prototype.render=function(t){this.i=null,this.l=new Map;var e=ve(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.l.set(e[n],this.i=[1,0,this.i]);return t.children},Ye.prototype.componentDidUpdate=Ye.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,n){ri(t,n,e)})};var Ns=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,La=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Ba=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Ua=/[A-Z0-9]/g,ja=typeof document<"u",qa=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function Fa(t,e,n){return e.__k==null&&(e.textContent=""),$e(t,e),typeof n=="function"&&n(),t?t.__c:null}function Ga(t,e,n){return $i(t,e),typeof n=="function"&&n(),t?t.__c:null}he.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(he.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var ii=x.event;function Va(){}function Ha(){return this.cancelBubble}function Wa(){return this.defaultPrevented}x.event=function(t){return ii&&(t=ii(t)),t.persist=Va,t.isPropagationStopped=Ha,t.isDefaultPrevented=Wa,t.nativeEvent=t};var ar,za={enumerable:!1,configurable:!0,get:function(){return this.class}},si=x.vnode;x.vnode=function(t){typeof t.type=="string"&&(function(e){var n=e.props,r=e.type,i={},s=r.indexOf("-")===-1;for(var o in n){var a=n[o];if(!(o==="value"&&"defaultValue"in n&&a==null||ja&&o==="children"&&r==="noscript"||o==="class"||o==="className")){var c=o.toLowerCase();o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?o="ondblclick":c!=="onchange"||r!=="input"&&r!=="textarea"||qa(n.type)?c==="onfocus"?o="onfocusin":c==="onblur"?o="onfocusout":Ba.test(o)&&(o=c):c=o="oninput":s&&La.test(o)?o=o.replace(Ua,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&i[o=c]&&(o="oninputCapture"),i[o]=a}}r=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=ve(n.children).forEach(function(l){l.props.selected=i.value.indexOf(l.props.value)!=-1})),r=="select"&&i.defaultValue!=null&&(i.value=ve(n.children).forEach(function(l){l.props.selected=i.multiple?i.defaultValue.indexOf(l.props.value)!=-1:i.defaultValue==l.props.value})),n.class&&!n.className?(i.class=n.class,Object.defineProperty(i,"className",za)):(n.className&&!n.class||n.class&&n.className)&&(i.class=i.className=n.className),e.props=i})(t),t.$$typeof=Ns,si&&si(t)};var oi=x.__r;x.__r=function(t){oi&&oi(t),ar=t.__c};var ai=x.diffed;x.diffed=function(t){ai&&ai(t);var e=t.props,n=t.__e;n!=null&&t.type==="textarea"&&"value"in e&&e.value!==n.value&&(n.value=e.value==null?"":e.value),ar=null};var Ja={ReactCurrentDispatcher:{current:{readContext:function(t){return ar.__n[t.__c].props.value},useCallback:Mt,useContext:as,useDebugValue:cs,useDeferredValue:Cs,useEffect:tr,useId:us,useImperativeHandle:os,useInsertionEffect:ks,useLayoutEffect:ct,useMemo:Oe,useReducer:er,useRef:ss,useState:Zn,useSyncExternalStore:Es,useTransition:Os}}};function Ka(t){return be.bind(null,t)}function Ut(t){return!!t&&t.$$typeof===Ns}function Ya(t){return Ut(t)&&t.type===pe}function Xa(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function Qa(t){return Ut(t)?fo.apply(null,arguments):t}function Za(t){return!!t.__k&&($e(null,t),!0)}function ec(t){return t&&(t.base||t.nodeType===1&&t)||null}var tc=function(t,e){return t(e)},nc=function(t,e){return t(e)},rc=pe,ic=Ut,S={useState:Zn,useId:us,useReducer:er,useEffect:tr,useLayoutEffect:ct,useInsertionEffect:ks,useTransition:Os,useDeferredValue:Cs,useSyncExternalStore:Es,startTransition:Ss,useRef:ss,useImperativeHandle:os,useMemo:Oe,useCallback:Mt,useContext:as,useDebugValue:cs,version:"18.3.1",Children:Na,render:Fa,hydrate:Ga,unmountComponentAtNode:Za,createPortal:$a,createElement:be,createContext:po,createFactory:Ka,cloneElement:Qa,createRef:ao,Fragment:pe,isValidElement:Ut,isElement:ic,isFragment:Ya,isMemo:Xa,findDOMNode:ec,Component:he,PureComponent:An,memo:Ia,forwardRef:xa,flushSync:nc,unstable_batchedUpdates:tc,StrictMode:rc,Suspense:vt,SuspenseList:Ye,lazy:Ta,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ja},sn={exports:{}},on,ci;function sc(){if(ci)return on;ci=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return on=t,on}var an,ui;function oc(){if(ui)return an;ui=1;var t=sc();function e(){}function n(){}return n.resetWarningCache=e,an=function(){function r(o,a,c,l,h,u){if(u!==t){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:e};return s.PropTypes=s,s},an}var li;function ac(){return li||(li=1,sn.exports=oc()()),sn.exports}var cc=ac();const ue=ji(cc);var se={},pt={};var hi;function uc(){if(hi)return pt;hi=1,pt.parse=i,pt.serialize=s;var t=decodeURIComponent,e=encodeURIComponent,n=/; */,r=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function i(a,c){if(typeof a!="string")throw new TypeError("argument str must be a string");for(var l={},h=c||{},u=a.split(n),d=h.decode||t,_=0;_<u.length;_++){var v=u[_],P=v.indexOf("=");if(!(P<0)){var b=v.substr(0,P).trim(),m=v.substr(++P,v.length).trim();m[0]=='"'&&(m=m.slice(1,-1)),l[b]==null&&(l[b]=o(m,d))}}return l}function s(a,c,l){var h=l||{},u=h.encode||e;if(typeof u!="function")throw new TypeError("option encode is invalid");if(!r.test(a))throw new TypeError("argument name is invalid");var d=u(c);if(d&&!r.test(d))throw new TypeError("argument val is invalid");var _=a+"="+d;if(h.maxAge!=null){var v=h.maxAge-0;if(isNaN(v))throw new Error("maxAge should be a Number");_+="; Max-Age="+Math.floor(v)}if(h.domain){if(!r.test(h.domain))throw new TypeError("option domain is invalid");_+="; Domain="+h.domain}if(h.path){if(!r.test(h.path))throw new TypeError("option path is invalid");_+="; Path="+h.path}if(h.expires){if(typeof h.expires.toUTCString!="function")throw new TypeError("option expires is invalid");_+="; Expires="+h.expires.toUTCString()}if(h.httpOnly&&(_+="; HttpOnly"),h.secure&&(_+="; Secure"),h.sameSite){var P=typeof h.sameSite=="string"?h.sameSite.toLowerCase():h.sameSite;switch(P){case!0:_+="; SameSite=Strict";break;case"lax":_+="; SameSite=Lax";break;case"strict":_+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid")}}return _}function o(a,c){try{return c(a)}catch{return a}}return pt}var cn,fi;function lc(){if(fi)return cn;fi=1;var t=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function r(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function i(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var c=Object.getOwnPropertyNames(o).map(function(h){return o[h]});if(c.join("")!=="0123456789")return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach(function(h){l[h]=h}),Object.keys(Object.assign({},l)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return cn=i()?Object.assign:function(s,o){for(var a,c=r(s),l,h=1;h<arguments.length;h++){a=Object(arguments[h]);for(var u in a)e.call(a,u)&&(c[u]=a[u]);if(t){l=t(a);for(var d=0;d<l.length;d++)n.call(a,l[d])&&(c[l[d]]=a[l[d]])}}return c},cn}var di;function hc(){if(di)return se;di=1;var t={};Object.defineProperty(se,"__esModule",{value:!0});var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f};se.load=u,se.loadAll=d,se.select=_,se.save=v,se.remove=P,se.setRawCookie=b,se.plugToRequest=m;var n=uc(),r=o(n),i=lc(),s=o(i);function o(f){return f&&f.__esModule?f:{default:f}}var a=typeof document>"u"||typeof process<"u"&&t&&!1,c={},l=void 0;function h(){return l&&!l.headersSent}function u(f,g){var E=a?c:r.default.parse(document.cookie),C=E&&E[f];if(typeof g>"u"&&(g=!C||C[0]!=="{"&&C[0]!=="["),!g)try{C=JSON.parse(C)}catch{}return C}function d(f){var g=a?c:r.default.parse(document.cookie),E=g;if(typeof f>"u"&&(f=!E||E[0]!=="{"&&E[0]!=="["),!f)try{E=JSON.parse(E)}catch{}return E}function _(f){var g=a?c:r.default.parse(document.cookie);return g?f?Object.keys(g).reduce(function(E,C){if(!f.test(C))return E;var B={};return B[C]=g[C],(0,s.default)({},E,B)},{}):g:{}}function v(f,g,E){c[f]=g,(typeof g>"u"?"undefined":e(g))==="object"&&(c[f]=JSON.stringify(g)),a||(document.cookie=r.default.serialize(f,c[f],E)),h()&&l.cookie&&l.cookie(f,g,E)}function P(f,g){delete c[f],typeof g>"u"?g={}:typeof g=="string"?g={path:g}:g=(0,s.default)({},g),typeof document<"u"&&(g.expires=new Date(1970,1,1,0,0,1),g.maxAge=0,document.cookie=r.default.serialize(f,"",g)),h()&&l.clearCookie&&l.clearCookie(f,g)}function b(f){f?c=r.default.parse(f):c={}}function m(f,g){return f.cookie?c=f.cookie:f.cookies?c=f.cookies:f.headers&&f.headers.cookie?b(f.headers.cookie):c={},l=g,function(){l=null,c={}}}return se.default={setRawCookie:b,load:u,loadAll:d,select:_,save:v,remove:P,plugToRequest:m},se}var fc=hc();const pi=ji(fc);var Tt;(function(t){t[t.SYNC=0]="SYNC",t[t.ASYNC=1]="ASYNC"})(Tt||(Tt={}));function xe(t){return t.type()===Tt.SYNC}class dc{type(){return Tt.SYNC}connect(){}createMatch(e,n){if(this.createGame)return console.warn("The database connector does not implement a createMatch method.",`
Using the deprecated createGame method instead.`),this.createGame(e,n);console.error("The database connector does not implement a createMatch method.")}listMatches(e){if(this.listGames)return console.warn("The database connector does not implement a listMatches method.",`
Using the deprecated listGames method instead.`),this.listGames(e);console.error("The database connector does not implement a listMatches method.")}}const pc=({game:t,unlisted:e,setupData:n,numPlayers:r})=>{const i={gameName:t.name,unlisted:!0,players:{},createdAt:Date.now(),updatedAt:Date.now()};for(let s=0;s<r;s++)i.players[s]={id:s};return i},_c=({game:t,numPlayers:e,setupData:n,unlisted:r})=>{(!e||typeof e!="number")&&(e=2);const i=t.validateSetupData&&t.validateSetupData(n,e);if(i!==void 0)return{setupDataError:i};const s=pc({game:t,numPlayers:e,setupData:n,unlisted:r}),o=bs({game:t,numPlayers:e,setupData:n});return{metadata:s,initialState:o}},_i=t=>Object.values(t.players).map(e=>{const{credentials:n,...r}=e;return r}),yc=t=>{const{credentials:e,...n}=t.payload;return{...t,payload:n}};class mc{constructor(e,n,r,i){this.game=Bt(e),this.storageAPI=n,this.transportAPI=r,this.subscribeCallback=()=>{},this.auth=i}subscribe(e){this.subscribeCallback=e}async onUpdate(e,n,r,i){if(!e||!e.payload)return{error:"missing action or action payload"};let s;if(xe(this.storageAPI)?{metadata:s}=this.storageAPI.fetch(r,{metadata:!0}):{metadata:s}=await this.storageAPI.fetch(r,{metadata:!0}),this.auth&&!await this.auth.authenticateCredentials({playerID:i,credentials:e.payload.credentials,metadata:s}))return{error:"unauthorized action"};const o=yc(e),a=r;let c;if(xe(this.storageAPI)?{state:c}=this.storageAPI.fetch(a,{state:!0}):{state:c}=await this.storageAPI.fetch(a,{state:!0}),c===void 0)return M(`game not found, matchID=[${a}]`),{error:"game not found"};if(c.ctx.gameover!==void 0){M(`game over - matchID=[${a}] - playerID=[${i}] - action[${o.payload.type}]`);return}const l=rr({game:this.game}),h=vs(ms),u=ir(l,c,h);if(o.type==$t||o.type==Rt){const m=c.ctx.activePlayers!==null,f=c.ctx.currentPlayer===i;if(!m&&!f||m&&(c.ctx.activePlayers[i]===void 0||Object.keys(c.ctx.activePlayers).length>1)){M(`playerID=[${i}] cannot undo / redo right now`);return}}if(!this.game.flow.isPlayerActive(c.G,c.ctx,i)){M(`player not active - playerID=[${i}] - action[${o.payload.type}]`);return}const d=o.type==rt?this.game.flow.getMove(c.ctx,o.payload.type,i):null;if(o.type==rt&&!d){M(`move not processed - canPlayerMakeMove=false - playerID=[${i}] - action[${o.payload.type}]`);return}if(c._stateID!==n&&!(d&&_s(d)&&d.ignoreStaleStateID)){M(`invalid stateID, was=[${n}], expected=[${c._stateID}] - playerID=[${i}] - action[${o.payload.type}]`);return}const _=u.getState();u.dispatch(o),c=u.getState(),this.subscribeCallback({state:c,action:o,matchID:r}),this.game.deltaState?this.transportAPI.sendAll({type:"patch",args:[r,n,_,c]}):this.transportAPI.sendAll({type:"update",args:[r,c]});const{deltalog:v,...P}=c;let b;if(s&&(s.gameover===void 0||s.gameover===null)&&(b={...s,updatedAt:Date.now()},c.ctx.gameover!==void 0&&(b.gameover=c.ctx.gameover)),xe(this.storageAPI))this.storageAPI.setState(a,P,v),b&&this.storageAPI.setMetadata(a,b);else{const m=[this.storageAPI.setState(a,P,v)];b&&m.push(this.storageAPI.setMetadata(a,b)),await Promise.all(m)}}async onSync(e,n,r,i=2){const s=e,o={state:!0,metadata:!0,log:!0,initialState:!0},a=xe(this.storageAPI)?this.storageAPI.fetch(s,o):await this.storageAPI.fetch(s,o);let{state:c,initialState:l,log:h,metadata:u}=a;if(this.auth&&n!==void 0&&n!==null&&!await this.auth.authenticateCredentials({playerID:n,credentials:r,metadata:u}))return{error:"unauthorized"};if(c===void 0){const v=_c({game:this.game,unlisted:!0,numPlayers:i,setupData:void 0});if("setupDataError"in v)return{error:"game requires setupData"};l=c=v.initialState,u=v.metadata,this.subscribeCallback({state:c,matchID:e}),xe(this.storageAPI)?this.storageAPI.createMatch(s,{initialState:l,metadata:u}):await this.storageAPI.createMatch(s,{initialState:l,metadata:u})}const d=u?_i(u):void 0,_={state:c,log:h,filteredMetadata:d,initialState:l};this.transportAPI.send({playerID:n,type:"sync",args:[e,_]})}async onConnectionChange(e,n,r,i){const s=e;if(n==null)return;let o;if(xe(this.storageAPI)?{metadata:o}=this.storageAPI.fetch(s,{metadata:!0}):{metadata:o}=await this.storageAPI.fetch(s,{metadata:!0}),o===void 0)return M(`metadata not found for matchID=[${s}]`),{error:"metadata not found"};if(o.players[n]===void 0)return M(`Player not in the match, matchID=[${s}] playerID=[${n}]`),{error:"player not in the match"};if(this.auth&&!await this.auth.authenticateCredentials({playerID:n,credentials:r,metadata:o}))return{error:"unauthorized"};o.players[n].isConnected=i;const a=_i(o);this.transportAPI.sendAll({type:"matchData",args:[e,a]}),xe(this.storageAPI)?this.storageAPI.setMetadata(s,o):await this.storageAPI.setMetadata(s,o)}async onChatMessage(e,n,r){const i=e;if(this.auth){const{metadata:s}=await this.storageAPI.fetch(i,{metadata:!0});if(!(n&&typeof n.sender=="string"))return{error:"unauthorized"};if(!await this.auth.authenticateCredentials({playerID:n.sender,credentials:r,metadata:s}))return{error:"unauthorized"}}this.transportAPI.sendAll({type:"chat",args:[e,n]})}}const _t=(t,e,n)=>({...n,G:t.playerView({G:n.G,ctx:n.ctx,playerID:e}),plugins:Zi(n,{playerID:e,game:t}),deltalog:void 0,_undo:[],_redo:[]}),gc=t=>(e,n)=>{switch(n.type){case"patch":{const[r,i,s,o]=n.args,a=un(o.deltalog,e),c=_t(t,e,o),l=o._stateID,h=_t(t,e,s),u=ps.createPatch(h,c);return{type:"patch",args:[r,i,l,u,a]}}case"update":{const[r,i]=n.args,s=un(i.deltalog,e),o=_t(t,e,i);return{type:"update",args:[r,o,s]}}case"sync":{const[r,i]=n.args,s=_t(t,e,i.state),o=un(i.log,e),a={...i,state:s,log:o};return{type:"sync",args:[r,a]}}default:return n}};function un(t,e){return t===void 0?t:t.map(n=>{if(e!==null&&+e==+n.action.payload.playerID||n.redact!==!0)return n;const r={...n.action.payload,args:null},i={...n,action:{...n.action,payload:r}},{redact:s,...o}=i;return o})}const _e=Object.create(null);_e.open="0";_e.close="1";_e.ping="2";_e.pong="3";_e.message="4";_e.upgrade="5";_e.noop="6";const bt=Object.create(null);Object.keys(_e).forEach(t=>{bt[_e[t]]=t});const xn={type:"error",data:"parser error"},Ms=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ts=typeof ArrayBuffer=="function",Ds=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,cr=({type:t,data:e},n,r)=>Ms&&e instanceof Blob?n?r(e):yi(e,r):Ts&&(e instanceof ArrayBuffer||Ds(e))?n?r(e):yi(new Blob([e]),r):r(_e[t]+(e||"")),yi=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+(r||""))},n.readAsDataURL(t)};function mi(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let ln;function vc(t,e){if(Ms&&t.data instanceof Blob)return t.data.arrayBuffer().then(mi).then(e);if(Ts&&(t.data instanceof ArrayBuffer||Ds(t.data)))return e(mi(t.data));cr(t,!1,n=>{ln||(ln=new TextEncoder),e(ln.encode(n))})}const gi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Xe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<gi.length;t++)Xe[gi.charCodeAt(t)]=t;const bc=t=>{let e=t.length*.75,n=t.length,r,i=0,s,o,a,c;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const l=new ArrayBuffer(e),h=new Uint8Array(l);for(r=0;r<n;r+=4)s=Xe[t.charCodeAt(r)],o=Xe[t.charCodeAt(r+1)],a=Xe[t.charCodeAt(r+2)],c=Xe[t.charCodeAt(r+3)],h[i++]=s<<2|o>>4,h[i++]=(o&15)<<4|a>>2,h[i++]=(a&3)<<6|c&63;return l},wc=typeof ArrayBuffer=="function",ur=(t,e)=>{if(typeof t!="string")return{type:"message",data:Rs(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:Pc(t.substring(1),e)}:bt[n]?t.length>1?{type:bt[n],data:t.substring(1)}:{type:bt[n]}:xn},Pc=(t,e)=>{if(wc){const n=bc(t);return Rs(n,e)}else return{base64:!0,data:t}},Rs=(t,e)=>e==="blob"?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,$s="",Ec=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach((s,o)=>{cr(s,!1,a=>{r[o]=a,++i===n&&e(r.join($s))})})},Sc=(t,e)=>{const n=t.split($s),r=[];for(let i=0;i<n.length;i++){const s=ur(n[i],e);if(r.push(s),s.type==="error")break}return r};function Cc(){return new TransformStream({transform(t,e){vc(t,n=>{const r=n.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const s=new DataView(i.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{i=new Uint8Array(9);const s=new DataView(i.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}t.data&&typeof t.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(n)})}})}let hn;function yt(t){return t.reduce((e,n)=>e+n.length,0)}function mt(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let r=0;for(let i=0;i<e;i++)n[i]=t[0][r++],r===t[0].length&&(t.shift(),r=0);return t.length&&r<t[0].length&&(t[0]=t[0].slice(r)),n}function Oc(t,e){hn||(hn=new TextDecoder);const n=[];let r=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(r===0){if(yt(n)<1)break;const c=mt(n,1);s=(c[0]&128)===128,i=c[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(yt(n)<2)break;const c=mt(n,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(r===2){if(yt(n)<8)break;const c=mt(n,8),l=new DataView(c.buffer,c.byteOffset,c.length),h=l.getUint32(0);if(h>Math.pow(2,21)-1){a.enqueue(xn);break}i=h*Math.pow(2,32)+l.getUint32(4),r=3}else{if(yt(n)<i)break;const c=mt(n,i);a.enqueue(ur(s?c:hn.decode(c),e)),r=0}if(i===0||i>t){a.enqueue(xn);break}}}})}const Ls=4;function j(t){if(t)return kc(t)}function kc(t){for(var e in j.prototype)t[e]=j.prototype[e];return t}j.prototype.on=j.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};j.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};j.prototype.off=j.prototype.removeListener=j.prototype.removeAllListeners=j.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r,i=0;i<n.length;i++)if(r=n[i],r===e||r.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};j.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,e)}return this};j.prototype.emitReserved=j.prototype.emit;j.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};j.prototype.hasListeners=function(t){return!!this.listeners(t).length};const jt=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0),ne=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Ic="arraybuffer";function Bs(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const Ac=ne.setTimeout,xc=ne.clearTimeout;function qt(t,e){e.useNativeTimers?(t.setTimeoutFn=Ac.bind(ne),t.clearTimeoutFn=xc.bind(ne)):(t.setTimeoutFn=ne.setTimeout.bind(ne),t.clearTimeoutFn=ne.clearTimeout.bind(ne))}const Nc=1.33;function Mc(t){return typeof t=="string"?Tc(t):Math.ceil((t.byteLength||t.size)*Nc)}function Tc(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function Us(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Dc(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function Rc(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let s=n[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class $c extends Error{constructor(e,n,r){super(e),this.description=n,this.context=r,this.type="TransportError"}}class lr extends j{constructor(e){super(),this.writable=!1,qt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,n,r){return super.emitReserved("error",new $c(e,n,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=ur(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=Dc(e);return n.length?"?"+n:""}}class Lc extends lr{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Sc(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Ec(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Us()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}}let js=!1;try{js=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Bc=js;function Uc(){}class jc extends Lc{constructor(e){if(super(e),typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,r)=>{this.onError("xhr poll error",n,r)}),this.pollXhr=e}}class de extends j{constructor(e,n,r){super(),this.createRequest=e,qt(this,r),this._opts=r,this._method=r.method||"GET",this._uri=n,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const n=Bs(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(n);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=de.requestsCount++,de.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Uc,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete de.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}de.requestsCount=0;de.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",vi);else if(typeof addEventListener=="function"){const t="onpagehide"in ne?"pagehide":"unload";addEventListener(t,vi,!1)}}function vi(){for(let t in de.requests)de.requests.hasOwnProperty(t)&&de.requests[t].abort()}const qc=(function(){const t=qs({xdomain:!1});return t&&t.responseType!==null})();class Fc extends jc{constructor(e){super(e);const n=e&&e.forceBase64;this.supportsBinary=qc&&!n}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new de(qs,this.uri(),e)}}function qs(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Bc))return new XMLHttpRequest}catch{}if(!e)try{return new ne[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Fs=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Gc extends lr{get name(){return"websocket"}doOpen(){const e=this.uri(),n=this.opts.protocols,r=Fs?{}:Bs(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,n,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;cr(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}i&&jt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Us()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}}const fn=ne.WebSocket||ne.MozWebSocket;class Vc extends Gc{createSocket(e,n,r){return Fs?new fn(e,n,r):n?new fn(e,n):new fn(e)}doWrite(e,n){this.ws.send(n)}}class Hc extends lr{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const n=Oc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(n).getReader(),i=Cc();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const s=()=>{r.read().then(({done:a,value:c})=>{a||(this.onPacket(c),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const r=e[n],i=n===e.length-1;this._writer.write(r).then(()=>{i&&jt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Wc={websocket:Vc,webtransport:Hc,polling:Fc},zc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Jc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Nn(t){if(t.length>8e3)throw"URI too long";const e=t,n=t.indexOf("["),r=t.indexOf("]");n!=-1&&r!=-1&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=zc.exec(t||""),s={},o=14;for(;o--;)s[Jc[o]]=i[o]||"";return n!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Kc(s,s.path),s.queryKey=Yc(s,s.query),s}function Kc(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Yc(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,s){i&&(n[i]=s)}),n}const Mn=typeof addEventListener=="function"&&typeof removeEventListener=="function",wt=[];Mn&&addEventListener("offline",()=>{wt.forEach(t=>t())},!1);class Se extends j{constructor(e,n){if(super(),this.binaryType=Ic,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){const r=Nn(e);n.hostname=r.host,n.secure=r.protocol==="https"||r.protocol==="wss",n.port=r.port,r.query&&(n.query=r.query)}else n.host&&(n.hostname=Nn(n.host).host);qt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(r=>{const i=r.prototype.name;this.transports.push(i),this._transportsByName[i]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Rc(this.opts.query)),Mn&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},wt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Ls,n.transport=e,this.id&&(n.sid=this.id);const r=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Se.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Se.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(n+=Mc(i)),r>0&&n>this._maxPayload)return this.writeBuffer.slice(0,r);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,jt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,r){return this._sendPacket("message",e,n,r),this}send(e,n,r){return this._sendPacket("message",e,n,r),this}_sendPacket(e,n,r,i){if(typeof n=="function"&&(i=n,n=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:n,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},r=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(Se.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Mn&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=wt.indexOf(this._offlineEventListener);r!==-1&&wt.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}Se.protocol=Ls;class Xc extends Se{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let n=this.createTransport(e),r=!1;Se.priorWebsocketSuccess=!1;const i=()=>{r||(n.send([{type:"ping",data:"probe"}]),n.once("packet",u=>{if(!r)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Se.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=n.name,this.emitReserved("upgradeError",d)}}))};function s(){r||(r=!0,h(),n.close(),n=null)}const o=u=>{const d=new Error("probe error: "+u);d.transport=n.name,s(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function c(){o("socket closed")}function l(u){n&&u.name!==n.name&&s()}const h=()=>{n.removeListener("open",i),n.removeListener("error",o),n.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};n.once("open",i),n.once("error",o),n.once("close",a),this.once("close",c),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||n.open()},200):n.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const n=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&n.push(e[r]);return n}}let Qc=class extends Xc{constructor(e,n={}){const r=typeof e=="object"?e:n;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(i=>Wc[i]).filter(i=>!!i)),super(e,r)}};function Zc(t,e="",n){let r=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),r=Nn(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(n&&n.port===r.port?"":":"+r.port),r}const eu=typeof ArrayBuffer=="function",tu=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Gs=Object.prototype.toString,nu=typeof Blob=="function"||typeof Blob<"u"&&Gs.call(Blob)==="[object BlobConstructor]",ru=typeof File=="function"||typeof File<"u"&&Gs.call(File)==="[object FileConstructor]";function hr(t){return eu&&(t instanceof ArrayBuffer||tu(t))||nu&&t instanceof Blob||ru&&t instanceof File}function Pt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(Pt(t[n]))return!0;return!1}if(hr(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return Pt(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&Pt(t[n]))return!0;return!1}function iu(t){const e=[],n=t.data,r=t;return r.data=Tn(n,e),r.attachments=e.length,{packet:r,buffers:e}}function Tn(t,e){if(!t)return t;if(hr(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=Tn(t[r],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=Tn(t[r],e));return n}return t}function su(t,e){return t.data=Dn(t.data,e),delete t.attachments,t}function Dn(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Dn(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Dn(t[n],e));return t}const ou=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],au=5;var N;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(N||(N={}));class cu{constructor(e){this.replacer=e}encode(e){return(e.type===N.EVENT||e.type===N.ACK)&&Pt(e)?this.encodeAsBinary({type:e.type===N.EVENT?N.BINARY_EVENT:N.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===N.BINARY_EVENT||e.type===N.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=iu(e),r=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(r),i}}function bi(t){return Object.prototype.toString.call(t)==="[object Object]"}class fr extends j{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const r=n.type===N.BINARY_EVENT;r||n.type===N.BINARY_ACK?(n.type=r?N.EVENT:N.ACK,this.reconstructor=new uu(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(hr(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(N[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===N.BINARY_EVENT||r.type===N.BINARY_ACK){const s=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const o=e.substring(s,n);if(o!=Number(o)||e.charAt(n)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(n+1)==="/"){const s=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););r.nsp=e.substring(s,n)}else r.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const s=n+1;for(;++n;){const o=e.charAt(n);if(o==null||Number(o)!=o){--n;break}if(n===e.length)break}r.id=Number(e.substring(s,n+1))}if(e.charAt(++n)){const s=this.tryParse(e.substr(n));if(fr.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case N.CONNECT:return bi(n);case N.DISCONNECT:return n===void 0;case N.CONNECT_ERROR:return typeof n=="string"||bi(n);case N.EVENT:case N.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&ou.indexOf(n[0])===-1);case N.ACK:case N.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class uu{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=su(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const lu=Object.freeze(Object.defineProperty({__proto__:null,Decoder:fr,Encoder:cu,get PacketType(){return N},protocol:au},Symbol.toStringTag,{value:"Module"}));function oe(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const hu=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Vs extends j{constructor(e,n,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[oe(e,"open",this.onopen.bind(this)),oe(e,"packet",this.onpacket.bind(this)),oe(e,"error",this.onerror.bind(this)),oe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){var r,i,s;if(hu.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const o={type:N.EVENT,data:n};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const h=this.ids++,u=n.pop();this._registerAckCallback(h,u),o.id=h}const a=(i=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,n){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=n;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);n.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(s),n.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...n){return new Promise((r,i)=>{const s=(o,a)=>o?i(o):r(a);s.withError=!0,n.push(s),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:N.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case N.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case N.EVENT:case N.BINARY_EVENT:this.onevent(e);break;case N.ACK:case N.BINARY_ACK:this.onack(e);break;case N.DISCONNECT:this.ondisconnect();break;case N.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let r=!1;return function(...i){r||(r=!0,n.packet({type:N.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(delete this.acks[e.id],n.withError&&e.data.unshift(null),n.apply(this,e.data))}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:N.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const r of n)r.apply(this,e.data)}}}function Ge(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Ge.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-n:t+n}return Math.min(t,this.max)|0};Ge.prototype.reset=function(){this.attempts=0};Ge.prototype.setMin=function(t){this.ms=t};Ge.prototype.setMax=function(t){this.max=t};Ge.prototype.setJitter=function(t){this.jitter=t};class Rn extends j{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,qt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((r=n.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Ge({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||lu;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Qc(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=oe(n,"open",function(){r.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=oe(n,"error",s);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),n.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(oe(e,"ping",this.onping.bind(this)),oe(e,"data",this.ondata.bind(this)),oe(e,"error",this.onerror.bind(this)),oe(e,"close",this.onclose.bind(this)),oe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){jt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Vs(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,n){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Je={};function Et(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=Zc(t,e.path||"/socket.io"),r=n.source,i=n.id,s=n.path,o=Je[i]&&s in Je[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new Rn(r,e):(Je[i]||(Je[i]=new Rn(r,e)),c=Je[i]),n.query&&!e.query&&(e.query=n.queryKey),c.socket(n.path,e)}Object.assign(Et,{Manager:Rn,Socket:Vs,io:Et,connect:Et});class Hs extends dc{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createMatch(e,n){this.initial.set(e,n.initialState),this.setState(e,n.initialState),this.setMetadata(e,n.metadata)}setMetadata(e,n){this.metadata.set(e,n)}setState(e,n,r){if(r&&r.length>0){const i=this.log.get(e)||[];this.log.set(e,[...i,...r])}this.state.set(e,n)}fetch(e,n){const r={};return n.state&&(r.state=this.state.get(e)),n.metadata&&(r.metadata=this.metadata.get(e)),n.log&&(r.log=this.log.get(e)||[]),n.initialState&&(r.initialState=this.initial.get(e)),r}wipe(e){this.state.delete(e),this.metadata.delete(e)}listMatches(e){return[...this.metadata.entries()].filter(([,n])=>e?!(e.gameName!==void 0&&n.gameName!==e.gameName||e.where!==void 0&&(e.where.isGameover!==void 0&&n.gameover!==void 0!==e.where.isGameover||e.where.updatedBefore!==void 0&&n.updatedAt>=e.where.updatedBefore||e.where.updatedAfter!==void 0&&n.updatedAt<=e.where.updatedAfter)):!0).map(([n])=>n)}}class fu extends Map{constructor(e){super(),this.key=e,(JSON.parse(localStorage.getItem(this.key))||[]).forEach(r=>this.set(...r))}sync(){const e=[...this.entries()];localStorage.setItem(this.key,JSON.stringify(e))}set(e,n){return super.set(e,n),this.sync(),this}delete(e){const n=super.delete(e);return this.sync(),n}}class du extends Hs{constructor(e="bgio"){super();const n=r=>new fu(`${e}_${r}`);this.state=n("state"),this.initial=n("initial"),this.metadata=n("metadata"),this.log=n("log")}}function pu(t,e){if(t.ctx.gameover!==void 0)return null;if(t.ctx.activePlayers){for(const n of Object.keys(e))if(n in t.ctx.activePlayers)return n}else if(t.ctx.currentPlayer in e)return t.ctx.currentPlayer;return null}class _u extends mc{constructor({game:e,bots:n,storageKey:r,persist:i}){const s={},o={};if(e&&e.ai&&n)for(const u in n){const d=n[u];o[u]=new d({game:e,enumerate:e.ai.enumerate,seed:e.seed})}const a=({playerID:u,...d})=>{const _=s[u];_!==void 0&&_(c(u,d))},c=gc(e),l={send:a,sendAll:u=>{for(const d in s)a({playerID:d,...u})}},h=i?new du(r):new Hs;super(e,h,l),this.connect=(u,d)=>{s[u]=d},this.subscribe(({state:u,matchID:d})=>{if(!n)return;const _=pu(u,o);_!==null&&setTimeout(async()=>{const v=await o[_].play(u,_);await this.onUpdate(v.action,u._stateID,d,v.action.payload.playerID)},100)})}}class yu extends sr{constructor({master:e,...n}){super(n),this.master=e}sendChatMessage(e,n){const r=[e,n,this.credentials];this.master.onChatMessage(...r)}sendAction(e,n){this.master.onUpdate(n,e._stateID,this.matchID,this.playerID)}requestSync(){this.master.onSync(this.matchID,this.playerID,this.credentials,this.numPlayers)}connect(){this.setConnectionStatus(!0),this.master.connect(this.playerID,e=>this.notifyClient(e)),this.requestSync()}disconnect(){this.setConnectionStatus(!1)}updateMatchID(e){this.matchID=e,this.connect()}updatePlayerID(e){this.playerID=e,this.connect()}updateCredentials(e){this.credentials=e,this.connect()}}const wi=new Map;function mu({bots:t,persist:e,storageKey:n}={}){return r=>{const{gameKey:i,game:s}=r;let o;const a=wi.get(i);return a&&a.bots===t&&a.storageKey===n&&a.persist===e&&(o=a.master),o||(o=new _u({game:s,bots:t,persist:e,storageKey:n}),wi.set(i,{master:o,bots:t,persist:e,storageKey:n})),new yu({master:o,...r})}}const Pi=Et;class gu extends sr{constructor({socket:e,socketOpts:n,server:r,...i}){super(i),this.server=r,this.socket=e,this.socketOpts=n}sendAction(e,n){const r=[n,e._stateID,this.matchID,this.playerID];this.socket.emit("update",...r)}sendChatMessage(e,n){const r=[e,n,this.credentials];this.socket.emit("chat",...r)}connect(){if(!this.socket)if(this.server){let e=this.server;e.search(/^https?:\/\//)==-1&&(e="http://"+this.server),e.slice(-1)!="/"&&(e=e+"/"),this.socket=Pi(e+this.gameName,this.socketOpts)}else this.socket=Pi("/"+this.gameName,this.socketOpts);this.socket.on("patch",(e,n,r,i,s)=>{this.notifyClient({type:"patch",args:[e,n,r,i,s]})}),this.socket.on("update",(e,n,r)=>{this.notifyClient({type:"update",args:[e,n,r]})}),this.socket.on("sync",(e,n)=>{this.notifyClient({type:"sync",args:[e,n]})}),this.socket.on("matchData",(e,n)=>{this.notifyClient({type:"matchData",args:[e,n]})}),this.socket.on("chat",(e,n)=>{this.notifyClient({type:"chat",args:[e,n]})}),this.socket.on("connect",()=>{this.requestSync(),this.setConnectionStatus(!0)}),this.socket.on("disconnect",()=>{this.setConnectionStatus(!1)})}disconnect(){this.socket.close(),this.socket=null,this.setConnectionStatus(!1)}requestSync(){if(this.socket){const e=[this.matchID,this.playerID,this.credentials,this.numPlayers];this.socket.emit("sync",...e)}}updateMatchID(e){this.matchID=e,this.requestSync()}updatePlayerID(e){this.playerID=e,this.requestSync()}updateCredentials(e){this.credentials=e,this.requestSync()}}function Ei({server:t,socketOpts:e}={}){return n=>new gu({server:t,socketOpts:e,...n})}function dr(t){var e;const{game:n,numPlayers:r,board:i,multiplayer:s,enhancer:o}=t;let{loading:a,debug:c}=t;return a===void 0&&(a=()=>S.createElement("div",{className:"bgio-loading"},"connecting...")),e=class extends S.Component{constructor(h){super(h),c===void 0&&(c=h.debug),this.client=Ca({game:n,debug:c,numPlayers:r,multiplayer:s,matchID:h.matchID,playerID:h.playerID,credentials:h.credentials,enhancer:o})}componentDidMount(){this.unsubscribe=this.client.subscribe(()=>this.forceUpdate()),this.client.start()}componentWillUnmount(){this.client.stop(),this.unsubscribe()}componentDidUpdate(h){this.props.matchID!=h.matchID&&this.client.updateMatchID(this.props.matchID),this.props.playerID!=h.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=h.credentials&&this.client.updateCredentials(this.props.credentials)}render(){const h=this.client.getState();if(h===null)return S.createElement(a);let u=null;return i&&(u=S.createElement(i,{...h,...this.props,isMultiplayer:!!s,moves:this.client.moves,events:this.client.events,matchID:this.client.matchID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,log:this.client.log,matchData:this.client.matchData,sendChatMessage:this.client.sendChatMessage,chatMessages:this.client.chatMessages})),S.createElement("div",{className:"bgio-client"},u)}},e.propTypes={matchID:ue.string,playerID:ue.string,credentials:ue.string,debug:ue.any},e.defaultProps={matchID:"default",playerID:null,credentials:null,debug:!0},e}class vu{constructor({server:e,gameComponents:n,playerName:r,playerCredentials:i}){this.client=new ka({server:e}),this.gameComponents=n,this.playerName=r||"Visitor",this.playerCredentials=i,this.matches=[]}async refresh(){try{this.matches=[];const e=await this.client.listGames();for(const n of e){if(!this._getGameComponents(n))continue;const{matches:r}=await this.client.listMatches(n);this.matches.push(...r)}}catch(e){throw new Error("failed to retrieve list of matches ("+e+")")}}_getMatchInstance(e){for(const n of this.matches)if(n.matchID===e)return n}_getGameComponents(e){for(const n of this.gameComponents)if(n.game.name===e)return n}_findPlayer(e){for(const n of this.matches)if(n.players.some(r=>r.name===e))return n}async join(e,n,r){try{let i=this._findPlayer(this.playerName);if(i)throw new Error("player has already joined "+i.matchID);if(i=this._getMatchInstance(n),!i)throw new Error("game instance "+n+" not found");const s=await this.client.joinMatch(e,n,{playerID:r,playerName:this.playerName});i.players[Number.parseInt(r)].name=this.playerName,this.playerCredentials=s.playerCredentials}catch(i){throw new Error("failed to join match "+n+" ("+i+")")}}async leave(e,n){try{const r=this._getMatchInstance(n);if(!r)throw new Error("match instance not found");for(const i of r.players)if(i.name===this.playerName){await this.client.leaveMatch(e,n,{playerID:i.id.toString(),credentials:this.playerCredentials}),delete i.name,delete this.playerCredentials;return}throw new Error("player not found in match")}catch(r){throw new Error("failed to leave match "+n+" ("+r+")")}}async disconnect(){const e=this._findPlayer(this.playerName);e&&await this.leave(e.gameName,e.matchID),this.matches=[],this.playerName="Visitor"}async create(e,n){try{const r=this._getGameComponents(e);if(!r)throw new Error("game not found");if(n<r.game.minPlayers||n>r.game.maxPlayers)throw new Error("invalid number of players "+n);await this.client.createMatch(e,{numPlayers:n})}catch(r){throw new Error("failed to create match for "+e+" ("+r+")")}}}function bu(t){return new vu(t)}class Ws extends S.Component{constructor(){super(...arguments),this.state={playerName:this.props.playerName,nameErrorMsg:""},this.onClickEnter=()=>{this.state.playerName!==""&&this.props.onEnter(this.state.playerName)},this.onKeyPress=e=>{e.key==="Enter"&&this.onClickEnter()},this.onChangePlayerName=e=>{const n=e.target.value.trim();this.setState({playerName:n,nameErrorMsg:n.length>0?"":"empty player name"})}}render(){return S.createElement("div",null,S.createElement("p",{className:"phase-title"},"Choose a player name:"),S.createElement("input",{type:"text",value:this.state.playerName,onChange:this.onChangePlayerName,onKeyPress:this.onKeyPress}),S.createElement("span",{className:"buttons"},S.createElement("button",{className:"buttons",onClick:this.onClickEnter},"Enter")),S.createElement("br",null),S.createElement("span",{className:"error-msg"},this.state.nameErrorMsg,S.createElement("br",null)))}}Ws.defaultProps={playerName:""};class wu extends S.Component{constructor(){super(...arguments),this._createSeat=e=>e.name||"[free]",this._createButtonJoin=(e,n)=>S.createElement("button",{key:"button-join-"+e.matchID,onClick:()=>this.props.onClickJoin(e.gameName,e.matchID,""+n)},"Join"),this._createButtonLeave=e=>S.createElement("button",{key:"button-leave-"+e.matchID,onClick:()=>this.props.onClickLeave(e.gameName,e.matchID)},"Leave"),this._createButtonPlay=(e,n)=>S.createElement("button",{key:"button-play-"+e.matchID,onClick:()=>this.props.onClickPlay(e.gameName,{matchID:e.matchID,playerID:""+n,numPlayers:e.players.length})},"Play"),this._createButtonSpectate=e=>S.createElement("button",{key:"button-spectate-"+e.matchID,onClick:()=>this.props.onClickPlay(e.gameName,{matchID:e.matchID,numPlayers:e.players.length})},"Spectate"),this._createInstanceButtons=e=>{const n=e.players.find(i=>i.name===this.props.playerName),r=e.players.find(i=>!i.name);return n&&r?this._createButtonLeave(e):r?this._createButtonJoin(e,r.id):n?S.createElement("div",null,[this._createButtonPlay(e,n.id),this._createButtonLeave(e)]):this._createButtonSpectate(e)}}render(){const e=this.props.match;let n="OPEN";return e.players.some(r=>!r.name)||(n="RUNNING"),S.createElement("tr",{key:"line-"+e.matchID},S.createElement("td",{key:"cell-name-"+e.matchID},e.gameName),S.createElement("td",{key:"cell-status-"+e.matchID},n),S.createElement("td",{key:"cell-seats-"+e.matchID},e.players.map(r=>this._createSeat(r)).join(", ")),S.createElement("td",{key:"cell-buttons-"+e.matchID},this._createInstanceButtons(e)))}}class Pu extends S.Component{constructor(e){super(e),this.state={selectedGame:0,numPlayers:2},this._createGameNameOption=(n,r)=>S.createElement("option",{key:"name-option-"+r,value:r},n.game.name),this._createNumPlayersOption=n=>S.createElement("option",{key:"num-option-"+n,value:n},n),this._createNumPlayersRange=n=>Array.from({length:n.maxPlayers+1}).map((r,i)=>i).slice(n.minPlayers),this.onChangeNumPlayers=n=>{this.setState({numPlayers:Number.parseInt(n.target.value)})},this.onChangeSelectedGame=n=>{const r=Number.parseInt(n.target.value);this.setState({selectedGame:r,numPlayers:this.props.games[r].game.minPlayers})},this.onClickCreate=()=>{this.props.createMatch(this.props.games[this.state.selectedGame].game.name,this.state.numPlayers)};for(const n of e.games){const r=n.game;r.minPlayers||(r.minPlayers=1),r.maxPlayers||(r.maxPlayers=4),console.assert(r.maxPlayers>=r.minPlayers)}this.state={selectedGame:0,numPlayers:e.games[0].game.minPlayers}}render(){return S.createElement("div",null,S.createElement("select",{value:this.state.selectedGame,onChange:e=>this.onChangeSelectedGame(e)},this.props.games.map((e,n)=>this._createGameNameOption(e,n))),S.createElement("span",null,"Players:"),S.createElement("select",{value:this.state.numPlayers,onChange:this.onChangeNumPlayers},this._createNumPlayersRange(this.props.games[this.state.selectedGame].game).map(e=>this._createNumPlayersOption(e))),S.createElement("span",{className:"buttons"},S.createElement("button",{onClick:this.onClickCreate},"Create")))}}var X;(function(t){t.ENTER="enter",t.PLAY="play",t.LIST="list"})(X||(X={}));class zs extends S.Component{constructor(e){super(e),this.state={phase:X.ENTER,playerName:"Visitor",runningMatch:null,errorMsg:"",credentialStore:{}},this._createConnection=n=>{const r=this.state.playerName;this.connection=bu({server:n.lobbyServer,gameComponents:n.gameComponents,playerName:r,playerCredentials:this.state.credentialStore[r]})},this._updateCredentials=(n,r)=>{this.setState(i=>{const s=Object.assign({},i.credentialStore);return s[n]=r,{credentialStore:s}})},this._updateConnection=async()=>{await this.connection.refresh(),this.forceUpdate()},this._enterLobby=n=>{this._startRefreshInterval(),this.setState({playerName:n,phase:X.LIST})},this._exitLobby=async()=>{this._clearRefreshInterval(),await this.connection.disconnect(),this.setState({phase:X.ENTER,errorMsg:""})},this._createMatch=async(n,r)=>{try{await this.connection.create(n,r),await this.connection.refresh(),this.setState({})}catch(i){this.setState({errorMsg:i.message})}},this._joinMatch=async(n,r,i)=>{try{await this.connection.join(n,r,i),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(s){this.setState({errorMsg:s.message})}},this._leaveMatch=async(n,r)=>{try{await this.connection.leave(n,r),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(i){this.setState({errorMsg:i.message})}},this._startMatch=(n,r)=>{const i=this.connection._getGameComponents(n);if(!i){this.setState({errorMsg:"game "+n+" not supported"});return}let s;if(r.numPlayers>1&&(s=this.props.gameServer?Ei({server:this.props.gameServer}):Ei()),r.numPlayers==1){const c=i.game.maxPlayers,l={};for(let h=1;h<c;h++)l[h+""]=fa;s=mu({bots:l})}const a={app:this.props.clientFactory({game:i.game,board:i.board,debug:this.props.debug,multiplayer:s}),matchID:r.matchID,playerID:r.numPlayers>1?r.playerID:"0",credentials:this.connection.playerCredentials};this._clearRefreshInterval(),this.setState({phase:X.PLAY,runningMatch:a})},this._exitMatch=()=>{this._startRefreshInterval(),this.setState({phase:X.LIST,runningMatch:null})},this._getPhaseVisibility=n=>this.state.phase!==n?"hidden":"phase",this.renderMatches=(n,r)=>n.map(i=>{const{matchID:s,gameName:o,players:a}=i;return S.createElement(wu,{key:"instance-"+s,match:{matchID:s,gameName:o,players:Object.values(a)},playerName:r,onClickJoin:this._joinMatch,onClickLeave:this._leaveMatch,onClickPlay:this._startMatch})}),this._createConnection(this.props)}componentDidMount(){const e=pi.load("lobbyState")||{};e.phase&&e.phase===X.PLAY&&(e.phase=X.LIST),e.phase&&e.phase!==X.ENTER&&this._startRefreshInterval(),this.setState({phase:e.phase||X.ENTER,playerName:e.playerName||"Visitor",credentialStore:e.credentialStore||{}})}componentDidUpdate(e,n){const r=this.state.playerName,i=this.state.credentialStore[r];if(n.phase!==this.state.phase||n.credentialStore[r]!==i||n.playerName!==r){this._createConnection(this.props),this._updateConnection();const s={phase:this.state.phase,playerName:r,credentialStore:this.state.credentialStore};pi.save("lobbyState",s,{path:"/"})}e.refreshInterval!==this.props.refreshInterval&&this._startRefreshInterval()}componentWillUnmount(){this._clearRefreshInterval()}_startRefreshInterval(){this._clearRefreshInterval(),this._currentInterval=setInterval(this._updateConnection,this.props.refreshInterval)}_clearRefreshInterval(){clearInterval(this._currentInterval)}render(){const{gameComponents:e,renderer:n}=this.props,{errorMsg:r,playerName:i,phase:s,runningMatch:o}=this.state;return n?n({errorMsg:r,gameComponents:e,matches:this.connection.matches,phase:s,playerName:i,runningMatch:o,handleEnterLobby:this._enterLobby,handleExitLobby:this._exitLobby,handleCreateMatch:this._createMatch,handleJoinMatch:this._joinMatch,handleLeaveMatch:this._leaveMatch,handleExitMatch:this._exitMatch,handleRefreshMatches:this._updateConnection,handleStartMatch:this._startMatch}):S.createElement("div",{id:"lobby-view",style:{padding:50}},S.createElement("div",{className:this._getPhaseVisibility(X.ENTER)},S.createElement(Ws,{key:i,playerName:i,onEnter:this._enterLobby})),S.createElement("div",{className:this._getPhaseVisibility(X.LIST)},S.createElement("p",null,"Welcome, ",i),S.createElement("div",{className:"phase-title",id:"match-creation"},S.createElement("span",null,"Create a match:"),S.createElement(Pu,{games:e,createMatch:this._createMatch})),S.createElement("p",{className:"phase-title"},"Join a match:"),S.createElement("div",{id:"instances"},S.createElement("table",null,S.createElement("tbody",null,this.renderMatches(this.connection.matches,i))),S.createElement("span",{className:"error-msg"},r,S.createElement("br",null))),S.createElement("p",{className:"phase-title"},"Matches that become empty are automatically deleted.")),S.createElement("div",{className:this._getPhaseVisibility(X.PLAY)},o&&S.createElement(o.app,{matchID:o.matchID,playerID:o.playerID,credentials:o.credentials}),S.createElement("div",{className:"buttons",id:"match-exit"},S.createElement("button",{onClick:this._exitMatch},"Exit match"))),S.createElement("div",{className:"buttons",id:"lobby-exit"},S.createElement("button",{onClick:this._exitLobby},"Exit lobby")))}}zs.propTypes={gameComponents:ue.array.isRequired,lobbyServer:ue.string,gameServer:ue.string,debug:ue.bool,clientFactory:ue.func,refreshInterval:ue.number};zs.defaultProps={debug:!1,clientFactory:dr,refreshInterval:2e3};const Eu=({triangle:t,fill:e,onClick:n})=>{const r=t.direction==="up"?"#triangle":"#triangle-down";return I("use",{href:r,x:t.col*25,y:t.row*42-100,fill:e,stroke:"#95A5A6",strokeWidth:"0.5","data-selected":"false",onClick:()=>n(t.id)},t.id)},St={red:"#ff5252",pickedRed:"#ff8a80",blue:"#3d5afe",pickedBlue:"#8c9eff",green:"#00e676",pickedGreen:"#69f0ae",white:"white",grey:"#f5f5f5"},Su=(t,e,n)=>{const r=["red","blue","green"],i=t.capturedCells[n];if(i!==void 0)return St[r[i]];const s=["pickedRed","pickedBlue","pickedGreen"],o=parseInt(e.currentPlayer,10),a=s[o];return t.stagedCells.includes(n)?St[a]:St.white},dn=ns(),Cu=({G:t,ctx:e,triangles:n,moves:r})=>{const i=Mt(a=>{dn.has(a)||r.pickCell(a)},[]),s=Mt(a=>dn.has(a)?St.grey:Su(t,e,a),[t,e]),o=Oe(()=>{const a=Pe-2,c=we-2,l=15,h=-60,u=a*25+15+79,d=c*42-60+79,_=u-l,v=d-h;return`${l} ${h} ${_} ${v}`},[]);return I("svg",{id:"svgBox",viewBox:o,xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid meet",children:[I("defs",{children:[I("path",{id:"triangle",d:"M31 79 L79 79 L55 37.6 Z"}),I("path",{id:"triangle-down",d:"M31 37.6 L79 37.6 L55 79 Z"})]}),n.filter(a=>!dn.has(a.id)).map(a=>I(Eu,{triangle:a,fill:s(a.id),onClick:i}))]})},Ou=()=>I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3",class:"lucide lucide-check-icon lucide-check",children:I("path",{d:"M20 6 9 17l-5-5"})}),ku=()=>I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"butt",class:"lucide lucide-undo-icon",children:[I("path",{d:"M 2,4 L 12,22 L 22,4 L 14,4"}),I("path",{d:"M 8,4 L 14,0 L 14,8 Z",strokeWidth:0,fill:"currentColor"})]}),Iu=()=>I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-dices-icon lucide-dices",children:[I("rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2"}),I("path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6"}),I("path",{d:"M6 18h.01"}),I("path",{d:"M10 14h.01"}),I("path",{d:"M15 6h.01"}),I("path",{d:"M18 9h.01"})]}),Au=({G:t,ctx:e,moves:n,...r})=>{const i=Oe(()=>{const[s,o,a]=Object.values(t.capturedCells).reduce((c,l)=>(c[l]+=1,c),[0,0,0]);return{red:s,blue:o,green:a}},[t.capturedCells]);return I("div",{class:"row",children:[I("div",{className:"counts",children:[I("div",{className:"counter redCount upward",children:i.red}),I("div",{className:"counter blueCount downward",children:i.blue}),I("div",{className:"counter greenCount upward","data-hidden":e.numPlayers===2,children:i.green})]}),e.activePlayers[e.currentPlayer]==="roll"?I("div",{id:"actionBtns",children:I("button",{id:"rollBtn",className:"downward",onClick:n.rollDice,children:I(Iu,{})})}):null,e.activePlayers[e.currentPlayer]==="pick"?I("div",{id:"actionBtns",children:[I("button",{id:"undoBtn",className:"downward",onClick:n.revertPickCells,children:I(ku,{})}),I(xu,{onClick:n.captureCells,G:t,ctx:e,moves:n,...r})]}):null]})},xu=({G:t,ctx:e,onClick:n})=>{const r=Oe(()=>{const s=parseInt(e.currentPlayer,10);return["red","blue","green"][s]},[e.currentPlayer]),i=t.stagedCells.length===t.tries;return I("button",{id:"captureBtn",class:`${r} upward`,onClick:n,disabled:!i,children:i?I(Ou,{}):t.tries-t.stagedCells.length})},Nu=Array.from({length:we}).flatMap((t,e)=>Array.from({length:Pe}).map((n,r)=>es(e,r))),Js=t=>I("div",{children:[I("header",{children:I(Au,{...t})}),I("main",{children:t.ctx.gameover===void 0?I(Cu,{...t,triangles:Nu}):I("div",{children:[I("div",{children:I("h4",{children:"THE GAME IS OVER!"})}),I("div",{children:I("h2",{children:["🏆 ",["🟥","🟦","🟩"][t.ctx.gameover?.winner??"-1"]," 👑"]})})]})})]}),Mu=dr({numPlayers:2,game:rs,board:Js}),Tu=dr({numPlayers:3,game:rs,board:Js}),Du=()=>{const t=Oe(()=>{const n=new URLSearchParams(window.location.search).get("players")==="3";return console.log("searchValue",n),n},[window.location.search]);return I(pe,{children:t?I(Tu,{}):I(Mu,{})},t)};$e(I(Du,{}),document.getElementById("app"));
